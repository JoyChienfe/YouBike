import{i as y,r as i,o as g,c as $,e as n,n as A,d as u,x as T,w as V,m as z,k as x,b as J}from"./index-e760d64d.js";import{r as R,u as L}from"./xlsx-bd534488.js";import{C as P}from"./index-b5488d74.js";import{N as U}from"./DataTable-243f741d.js";import{N as W}from"./Watermark-7376882c.js";import"./get-slot-1efb97e5.js";const q={class:"container-fluid px-0"},F=n("div",{class:"row mx-0"},[n("h1",{class:"report-h1 fw-bold"},"黑名單")],-1),G={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Z={__name:"BlacklistView",setup(H){const d=y("ischange"),h=i(null);let s=[];const m=i([]),c=i([]),b=i("請選擇"),f=y("$swal");async function w(t){f({icon:"error",title:`${t}`,showConfirmButton:!1})}async function k(t){f({icon:"success",title:`${t}`,showConfirmButton:!1})}function _(t,e){var o=JSON.stringify(t),a=P.AES.encrypt(o,e);return a.toString()}async function v(){try{const t=s[0].indexOf("手機號碼"),e=s[0].indexOf("卡片號碼");let o=[];s.forEach((r,O)=>{O!==0&&o.push({mobile:_(r[t],"CryptoJS_PASSWORD"),cardno:r[e]})});const a=[...o],l="https://report.youbike.com.tw";await x.put(`${l}/lottery/blacklist`,a)}catch(t){console.log(t)}}function p(){h.value.value="",c.value=[],m.value=[],b.value="請選擇"}async function C(){(await f({title:"確定送出嗎?",text:"送出後，將會覆蓋原本的表格",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"})).isConfirmed&&(v(),p(),k("成功上傳"))}const S=()=>{const t=s[0];let e=[];t.forEach((o,a)=>{e.push({key:`item${a}`,align:"center",title:o})}),m.value=[...e]},B=()=>{const t=s,e=[];t.forEach((o,a)=>{if(a===0)return;let l={};for(let r=0;r<s[0].length;r++)l[`item${r}`]=o[r];e.push(l)}),c.value=[...e]},N=async t=>{const e=t.target.files[0],o=URL.createObjectURL(e);await E(o),S(),B()},E=async t=>{try{const e=await x.get(t,{responseType:"arraybuffer"});s=[...j(e.data)]}catch(e){console.log(e)}};function j(t){const e=R(t,{type:"array",codepage:65001}),o=e.Sheets[e.SheetNames[0]];return L.sheet_to_json(o,{header:1,defval:"",blankrows:!0})}const D=async()=>{if(c.value.length===0){w("請選擇檔案");return}C()};return(t,e)=>(g(),$("div",q,[F,n("form",{class:A(["row mx-0",{"report-header":!u(d),"report-header-dark":u(d)}])},[n("div",G,[n("input",{type:"file",class:"form-control",onChange:N,ref_key:"file",ref:h},null,544)]),n("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[n("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:D}," 送出 "),n("button",{type:"button",class:"btn btn-secondary text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:p}," 清除 ")])],2),c.value.length?(g(),T(u(W),{key:0,content:"預覽圖",cross:"",selectable:"","font-size":16,"line-height":16,width:192,height:128,"x-offset":12,"y-offset":28,rotate:-15},{default:V(()=>[J(u(U),{data:c.value,columns:m.value,pagination:{pageSize:20},"max-height":500,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"])]),_:1})):z("",!0)]))}};export{Z as default};
