import{i as $,r as n,o as m,c as v,b as k,d as c,e,n as U,k as p,bp as h,v as L,F as j,aU as M,l as S,j as f,b8 as A}from"./index-9437428c.js";import{L as D}from"./index-181255ed.js";import{N as E}from"./Mention-68fb1e6c.js";import"./Input-3a828f95.js";const F={class:"container-fluid px-0"},z=e("div",{class:"row mx-0"},[e("h1",{class:"report-h1 fw-bold"},"帳號角色管理")],-1),T=e("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[e("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"帳號資料:")],-1),q={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12 px-0"},G=e("hr",null,null,-1),H={class:"row mx-auto px-0"},I={class:"col-md-3"},J=e("label",{for:"labelname",class:"form-label fw-bolder"},"姓名",-1),K={class:"col-md-3 mt-2 mt-md-0"},O=e("label",{for:"labelid",class:"form-label fw-bolder"},"公號",-1),P={class:"col-md-3 mt-2 mt-md-0"},Q=e("label",{for:"labelid",class:"form-label fw-bolder"},"目前角色",-1),R={class:"col-md-3 mt-2 mt-md-0"},W=e("label",{for:"",class:"form-label fw-bolder"},"修改成的角色",-1),X=e("option",{selected:"",disabled:""},"請選擇",-1),Y=["value"],ae={__name:"UsersView",setup(Z){const w=$("$swal");async function _(t){w({icon:"error",title:`${t}`,showConfirmButton:!1})}async function V(t){w({icon:"success",title:`${t}`,showConfirmButton:!1})}const d=$("ischange"),a=n(!1),o=n(null),b=n([]),u=n("請選擇"),y=n(null),C=async()=>{const t="https://report.youbike.com.tw/isauth/roles",l=(await f.get(t)).data.rows;y.value=[...l]},x=n([]);async function g(){a.value=!0,await C();const t=[],s="https://report.youbike.com.tw/isauth/userrole",l=await f.get(s);a.value=!1,x.value=[...l.data.rows],x.value.forEach(r=>{t.push({label:`${r.name}_${r.users_id}_${r.role_name}`,value:`${r.name}_${r.users_id}_${r.role_name}`})}),b.value=[...t],console.log(b.value)}(async function(){await g()})();const i=n(),N=async()=>{try{a.value=!0;let t="";i.value.includes("@")&&(t=i.value.replace("@",""));const l=`https://report.youbike.com.tw/isauth/role/${{name:t.split("_")[0],id:t.split("_")[1],role_name:t.split("_")[2]}.id}`,r=await f.get(l);o.value=r.data.rows[0],a.value=!1}catch{return a.value=!1,_("格式不正確")}},B=async()=>{try{if(a.value=!0,u.value=="請選擇")return a.value=!1,_("請選擇修正成的角色");const t=o.value.users_id,s={role:u.value},l=`https://report.youbike.com.tw/isauth/role/${t}`;await f.patch(l,s),await g(),o.value=null,u.value="請選擇",a.value=!1,i.value="@",V("修正成功")}catch{return a.value=!1,_("修正失敗")}};return(t,s)=>(m(),v("div",F,[k(c(D),{active:a.value,"onUpdate:active":s[0]||(s[0]=l=>a.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),z,e("form",{class:U(["row mx-0",{"report-header":!c(d),"report-header-dark":c(d)}])},[T,e("div",q,[k(c(E),{options:b.value,"default-value":"@",value:i.value,"onUpdate:value":s[1]||(s[1]=l=>i.value=l)},null,8,["options","value"])]),e("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[e("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:N}," 確定 ")])],2),G,o.value?(m(),v("form",{key:0,class:U(["row mx-0",{"report-header":!c(d),"report-header-dark":c(d)}])},[e("div",H,[e("div",I,[J,p(e("input",{type:"text",class:"form-control",id:"labelname","onUpdate:modelValue":s[2]||(s[2]=l=>o.value.name=l),disabled:""},null,512),[[h,o.value.name]])]),e("div",K,[O,p(e("input",{type:"text",class:"form-control",id:"labelid","onUpdate:modelValue":s[3]||(s[3]=l=>o.value.users_id=l),disabled:""},null,512),[[h,o.value.users_id]])]),e("div",P,[Q,p(e("input",{type:"text",class:"form-control",id:"labelid","onUpdate:modelValue":s[4]||(s[4]=l=>o.value.role_name=l),disabled:""},null,512),[[h,o.value.role_name]])]),e("div",R,[W,p(e("select",{class:"form-select","onUpdate:modelValue":s[5]||(s[5]=l=>u.value=l)},[X,(m(!0),v(j,null,M(y.value,l=>(m(),v("option",{key:l.role_name,value:l.role_id},A(l.role_name),9,Y))),128))],512),[[L,u.value]])]),e("div",{class:"col col-md-auto mt-3 d-flex flex-column justify-content-end"},[e("button",{type:"button",class:"btn btn-success",onClick:B}," 送出 ")])])],2)):S("",!0)]))}};export{ae as default};
