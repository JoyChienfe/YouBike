import{r as p,i as Y,o as w,c as x,e as l,l as v,b2 as E,F as U,b3 as D,p as q,m as z,b as O,w as G,d as N,j as V,v as H,b4 as K,k as Q}from"./index-986760c3.js";import{V as Z,L as ee,r as te}from"./Animation - 1690257463274-3124a192.js";import{r as se,u as _,w as le}from"./xlsx-bd534488.js";import{C as T}from"./index-a831502f.js";import{N as oe}from"./Modal-edc4629b.js";import"./Warning-54fae089.js";const ae={class:"container-fluid p-md-4 pt-5",style:{"background-color":"#efefef"}},ne=l("h1",{class:"fw-bold fs-1 text-center"},"天天YB抽獎網站",-1),re=l("div",{class:"row"},null,-1),ie={class:"row mb-md-5"},ce={class:"col-md-6 gx-md-5 mb-3 mb-md-0"},ue=l("label",{for:"name",class:"form-label fw-bolder fs-3"},[l("i",{class:"bi bi-star-fill me-1",style:{color:"#a09518"}}),V("名稱:")],-1),fe={class:"col-md-6 gx-md-5 mb-3 mb-md-0"},de={class:"row"},pe=l("div",{class:"col-12"},[l("label",{for:"gift",class:"form-label fw-bolder fs-3"},[l("i",{class:"bi bi-sliders me-1",style:{color:"#a09518"}}),V("獎品設定:")])],-1),he={class:"input-group"},me=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ve=["value"],_e={class:"col-auto"},ge={class:"row"},ye={class:"mb-md-5 gx-md-5 mb-3 mb-md-0"},we={class:"row"},xe=l("div",{class:"col-auto"},[l("label",{for:"userlist",class:"form-label fw-bolder fs-3"},[l("i",{class:"bi bi-person-fill-up me-1",style:{color:"#a09518"}}),V("抽獎名單:")])],-1),ke={class:"col-auto"},Se={key:0,class:"gx-md-5 mb-3 mb-md-0"},Ee=l("label",{for:"giftlist",class:"form-label fw-bolder fs-3"},[l("i",{class:"bi bi-cash-coin me-1",style:{color:"#18a058"}}),V("中獎結果:")],-1),Oe={__name:"DaydaylotteryView",setup(Ve){const k=p(!1),g=p(),$=p(),S=p(),f=p([]),B=Y("$swal"),A=p();async function m(t){B({icon:"error",title:`${t}`,showConfirmButton:!1})}let C=null;const h=p([]),I=t=>{const o=t.target.files[0],a=new FileReader;a.readAsArrayBuffer(o),a.onload=s=>{const u=s.target.result,y=se(u,{type:"binary",codepage:65001,raw:!0}),r=y.SheetNames[0],i=y.Sheets[r],c=_.sheet_to_json(i,{header:1,blankrows:!1});h.value=[...c];let e="";c.forEach((n,b)=>{b===0&&(C=n,C=[...n,"區域"]),e+=`${n}
`}),$.value=e}};function J(t,o){var a=T.AES.decrypt(t,o),s=a.toString(T.enc.Utf8);return JSON.parse(s)}const L=async()=>{const t="https://report.youbike.com.tw/lottery/blacklist",a=(await Q.get(t)).data.data;let s={mobile:[],cardno:[]};return a.forEach(u=>{s.mobile.push(J(u.mobile,"CryptoJS_PASSWORD")),s.cardno.push(u.cardno)}),s},d=p([{name:null,value:1,key:1}]),M=()=>{const t=d.value.length+1;d.value.push({name:null,value:1,key:t})},j=()=>{d.value.length>1&&d.value.pop()},R=async()=>{const t=await L();let o=[];f.value=[],o=[...h.value];let a=[];if(d.value.forEach(e=>{for(let n=1;n<=e.value;n++)a.push(e.name)}),o.length<a.length)return m("抽獎人小於獎品");const s=h.value[0].indexOf("外觀卡號"),u=h.value[0].indexOf("手機號碼"),y=h.value[0].indexOf("借車場站代號");if(u===-1||s===-1||y===-1)return m("excel格式錯誤");let r=[],i=0;for(;r.length!==a.length;){let e=!0;const n=te.int(0,o.length);if(t.cardno.indexOf(o[n][s].toString())!==-1||t.mobile.indexOf(o[n][u].toString())!==-1){if(e=!1,i++,i===100)return m("抽獎失敗")}else i=0;r.forEach(b=>{(b[u]===o[n][u]||b[s]===o[n][s])&&(e=!1)}),e&&r.push(o[n])}r.forEach((e,n)=>{f.value.push({name:a[n],value:r[n]})});let c=`${g.value}
========================================
`;f.value.forEach((e,n)=>{n===0?c+=`${e.name}
${e.value}`:e.name===f.value[n-1].name?c+=`
${e.name}
${e.value}`:c+=`


${e.name}
${e.value}`}),S.value=c},P=()=>{if(g.value)if(d.value[0].name){if(h.value.length<1)return m("抽獎名單不能為空")}else return m("請輸入獎品設定");else return m("請輸入名稱");k.value=!0,setTimeout(function(){R(),k.value=!1},4e3)};function F(t){if(typeof t!="number")throw new Error("Input must be a number");const o=t.toString();return o.length>5?parseInt(o.substring(0,4)):t}function W(t){if(t>=1&&t<=900)return"台北";if(t>=1001&&t<=1900)return"新北";if(t>=2001&&t<=2900)return"桃園";if(t>=3001&&t<=3900)return"台中";if(t>=6101&&t<=6290)return"竹市";if(t>=6601&&t<=6990)return"苗栗";if(t>=7001&&t<=7290)return"彰化";if(t>=9601&&t<=9696)return"竹科";if(t==5001)return"台北2.0";if(t==5002)return"新北2.0";if(t==5003)return"桃園2.0";if(t==5004)return"竹市2.0";if(t==5005)return"竹縣2.0";if(t==5006)return"台中2.0";if(t==5007)return"苗栗2.0";if(t==5008)return"彰化2.0";if(t==5010)return"嘉義2.0";if(t==5012)return"高雄2.0";if(t==5013)return"台南2.0";if(t==5014)return"屏東2.0";if(t==5082)return"竹科2.0"}const X=()=>{let t=[];f.value.forEach((r,i)=>{i===0?(t.push([]),t[0].push(r)):(f.value[i].name===f.value[i-1].name||t.push([]),t[t.length-1].push(r))});const o=h.value[0].indexOf("借車場站代號"),a=_.book_new();t.forEach(r=>{let i=[];i.push(C),r.forEach(e=>{const n=F(parseInt(e.value[o])),b=[...e.value,W(n)];i.push(b)});const c=_.aoa_to_sheet(i);_.book_append_sheet(a,c,`${r[0].name}`)});const s={台北:[],"台北2.0":[],新北:[],"新北2.0":[],桃園:[],"桃園2.0":[],竹市:[],"竹市2.0":[],"竹縣2.0":[],竹科:[],"竹科2.0":[],苗栗:[],"苗栗2.0":[],台中:[],"台中2.0":[],彰化:[],"彰化2.0":[],"嘉義2.0":[],"台南2.0":[],"高雄2.0":[],"屏東2.0":[]};if(o>0){f.value.forEach(c=>{const e=F(parseInt(c.value[o]));e>=1&&e<=900?s.台北.push(e):e>=1001&&e<=1900?s.新北.push(e):e>=2001&&e<=2900?s.桃園.push(e):e>=3001&&e<=3900?s.台中.push(e):e>=6101&&e<=6290?s.竹市.push(e):e>=6601&&e<=6990?s.苗栗.push(e):e>=7001&&e<=7290?s.彰化.push(e):e>=9601&&e<=9696?s.竹科.push(e):e==5001?s["台北2.0"].push(e):e==5002?s["新北2.0"].push(e):e==5003?s["桃園2.0"].push(e):e==5004?s["竹市2.0"].push(e):e==5005?s["竹縣2.0"].push(e):e==5006?s["台中2.0"].push(e):e==5007?s["苗栗2.0"].push(e):e==5008?s["彰化2.0"].push(e):e==5010?s["嘉義2.0"].push(e):e==5012?s["高雄2.0"].push(e):e==5013?s["台南2.0"].push(e):e==5014?s["屏東2.0"].push(e):e==5082&&s["竹科2.0"].push(e)});const r=[["贈品區域","配送數量"]];for(const c in s){let e=[c,s[c].length];r.push(e)}const i=_.aoa_to_sheet(r);_.book_append_sheet(a,i,"城市分類")}const u=`${g.value}.xlsx`;le(a,u,{bookType:"xlsx"})};return(t,o)=>(w(),x("div",ae,[ne,re,l("div",ie,[l("div",ce,[ue,v(l("input",{type:"email","onUpdate:modelValue":o[0]||(o[0]=a=>g.value=a),class:"form-control",id:"name",placeholder:"請輸入名稱"},null,512),[[E,g.value]])]),l("div",fe,[l("div",de,[pe,(w(!0),x(U,null,D(d.value,a=>(w(),x("div",{class:"mb-2 col-lg-6 col-xxl-4",key:a.key},[l("div",he,[v(l("input",{type:"input",class:"form-control","onUpdate:modelValue":s=>a.name=s,placeholder:"請輸入名稱"},null,8,me),[[E,a.name]]),v(l("select",{class:"form-select","onUpdate:modelValue":s=>a.value=s},[(w(),x(U,null,D(700,s=>l("option",{key:`${s}12`,value:s},K(s),9,ve)),64))],8,be),[[H,a.value]])])]))),128)),l("div",{class:"col-auto"},[l("button",{type:"button",class:"btn btn-outline-primary",onClick:M}," 新增 ")]),v(l("div",_e,[l("button",{type:"button",class:"btn btn-outline-danger",onClick:j}," 刪除 ")],512),[[q,d.value.length>1]])])])]),l("div",ge,[l("div",ye,[l("div",we,[xe,l("div",ke,[l("input",{type:"file",id:"excelFileInput",onChange:I,ref_key:"file",ref:A,class:"form-control"},null,544)])]),v(l("textarea",{class:"form-control",id:"userlist",rows:"10","onUpdate:modelValue":o[1]||(o[1]=a=>$.value=a),readonly:"",placeholder:`得獎限制: 手機號碼和外觀卡號均不能重複\r
EXCEL格式必填項目 <手機號碼> <外觀卡號> <借車場站代號>`},null,512),[[E,$.value]])]),l("div",{class:"row"},[l("div",{class:"gx-md-5 mb-3 mb-md-0 text-center"},[l("button",{type:"button",class:"btn btn-lg btn-danger fw-bold px-4 me-3 mb-3 mb-md-0",onClick:P}," 抽獎 ")])]),S.value?(w(),x("div",Se,[Ee,v(l("textarea",{class:"form-control",readonly:"",id:"giftlist",rows:"10","onUpdate:modelValue":o[2]||(o[2]=a=>S.value=a)},null,512),[[E,S.value]]),l("div",{class:"gx-md-5 mb-3 mb-md-0 text-center mt-5"},[l("button",{type:"button",class:"btn btn-lg btn-primary fw-bold px-4 me-3",onClick:X}," 導出Excel ")])])):z("",!0)]),O(N(oe),{show:k.value,"onUpdate:show":o[3]||(o[3]=a=>k.value=a),"mask-closable":!1},{default:G(()=>[O(N(Z),{animationData:N(ee),height:400,width:400,speed:1},null,8,["animationData"])]),_:1},8,["show"])]))}};export{Oe as default};
