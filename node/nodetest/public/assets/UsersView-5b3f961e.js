import{i as $,r as n,o as m,c as v,b as k,d as c,e,n as V,l as f,b2 as h,v as L,F as M,b3 as S,m as j,k as p,L as A,b4 as D}from"./index-e7986d38.js";import{N as E}from"./Mention-c90af411.js";const F={class:"container-fluid px-0"},z=e("div",{class:"row mx-0"},[e("h1",{class:"report-h1 fw-bold"},"帳號角色管理")],-1),T=e("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[e("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"帳號資料:")],-1),q={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12 px-0"},G=e("hr",null,null,-1),H={class:"row mx-auto px-0"},I={class:"col-md-3"},J=e("label",{for:"labelname",class:"form-label fw-bolder"},"姓名",-1),K={class:"col-md-3 mt-2 mt-md-0"},O=e("label",{for:"labelid",class:"form-label fw-bolder"},"公號",-1),P={class:"col-md-3 mt-2 mt-md-0"},Q=e("label",{for:"labelid",class:"form-label fw-bolder"},"目前角色",-1),R={class:"col-md-3 mt-2 mt-md-0"},W=e("label",{for:"",class:"form-label fw-bolder"},"修改成的角色",-1),X=e("option",{selected:"",disabled:""},"請選擇",-1),Y=["value"],se={__name:"UsersView",setup(Z){const w=$("$swal");async function _(s){w({icon:"error",title:`${s}`,showConfirmButton:!1})}async function U(s){w({icon:"success",title:`${s}`,showConfirmButton:!1})}const d=$("ischange"),a=n(!1),o=n(null),b=n([]),u=n("請選擇"),y=n(null),C=async()=>{const s="https://report.youbike.com.tw/isauth/roles",l=(await p.get(s)).data.rows;y.value=[...l]},x=n([]);async function g(){a.value=!0,await C();const s=[],t="https://report.youbike.com.tw/isauth/userrole",l=await p.get(t);a.value=!1,x.value=[...l.data.rows],x.value.forEach(r=>{s.push({label:`${r.name}_${r.users_id}_${r.role_name}`,value:`${r.name}_${r.users_id}_${r.role_name}`})}),b.value=[...s],console.log(b.value)}(async function(){await g()})();const i=n(),N=async()=>{try{a.value=!0;let s="";i.value.includes("@")&&(s=i.value.replace("@",""));const l=`https://report.youbike.com.tw/isauth/role/${{name:s.split("_")[0],id:s.split("_")[1],role_name:s.split("_")[2]}.id}`,r=await p.get(l);o.value=r.data.rows[0],a.value=!1}catch{return a.value=!1,_("格式不正確")}},B=async()=>{try{if(a.value=!0,u.value=="請選擇")return a.value=!1,_("請選擇修正成的角色");const s=o.value.users_id,t={role:u.value},l=`https://report.youbike.com.tw/isauth/role/${s}`;await p.patch(l,t),await g(),o.value=null,u.value="請選擇",a.value=!1,i.value="@",U("修正成功")}catch{return a.value=!1,_("修正失敗")}};return(s,t)=>(m(),v("div",F,[k(c(A),{active:a.value,"onUpdate:active":t[0]||(t[0]=l=>a.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),z,e("form",{class:V(["row mx-0",{"report-header":!c(d),"report-header-dark":c(d)}])},[T,e("div",q,[k(c(E),{options:b.value,"default-value":"@",value:i.value,"onUpdate:value":t[1]||(t[1]=l=>i.value=l)},null,8,["options","value"])]),e("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[e("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:N}," 確定 ")])],2),G,o.value?(m(),v("form",{key:0,class:V(["row mx-0",{"report-header":!c(d),"report-header-dark":c(d)}])},[e("div",H,[e("div",I,[J,f(e("input",{type:"text",class:"form-control",id:"labelname","onUpdate:modelValue":t[2]||(t[2]=l=>o.value.name=l),disabled:""},null,512),[[h,o.value.name]])]),e("div",K,[O,f(e("input",{type:"text",class:"form-control",id:"labelid","onUpdate:modelValue":t[3]||(t[3]=l=>o.value.users_id=l),disabled:""},null,512),[[h,o.value.users_id]])]),e("div",P,[Q,f(e("input",{type:"text",class:"form-control",id:"labelid","onUpdate:modelValue":t[4]||(t[4]=l=>o.value.role_name=l),disabled:""},null,512),[[h,o.value.role_name]])]),e("div",R,[W,f(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=l=>u.value=l)},[X,(m(!0),v(M,null,S(y.value,l=>(m(),v("option",{key:l.role_name,value:l.role_id},D(l.role_name),9,Y))),128))],512),[[L,u.value]])]),e("div",{class:"col col-md-auto mt-3 d-flex flex-column justify-content-end"},[e("button",{type:"button",class:"btn btn-success",onClick:B}," 送出 ")])])],2)):j("",!0)]))}};export{se as default};
