import{_ as J,i as E,u as Q,r as m,z as X,o as n,c as i,b as N,d as s,e as a,l as g,v as C,F as I,m as r,p as O,n as Z,L as ee,q as te,s as ae,t as oe,B as se,k as W}from"./index-9c026bac.js";import{_ as le}from"./OutputExcel-850e7656.js";import{N as ne}from"./DataTable-a8e5321a.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const d=w=>(ae("data-v-1506b38f"),w=w(),oe(),w),ie={class:"container-fluid px-0"},ce=d(()=>a("div",{class:"row mx-0"},[a("h1",{class:"report-h1 fw-bold"},"調度週報")],-1)),re={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},de=d(()=>a("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"表別:",-1)),ue={class:"col-md-auto px-0"},me=d(()=>a("option",{selected:"",disabled:""},"請選擇",-1)),pe=d(()=>a("option",{value:"調度週報"},"調度週報",-1)),_e=d(()=>a("option",{value:"調度排名週報"},"調度排名週報",-1)),ve=[me,pe,_e],fe={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},he=d(()=>a("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1)),ge={class:"col-md-auto px-0"},ye=d(()=>a("option",{selected:"",disabled:""},"請選擇",-1)),be=d(()=>a("option",{value:"1"},"1.0",-1)),ke=d(()=>a("option",{value:"2"},"2.0+2.0E",-1)),xe=[ye,be,ke],we={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},De=d(()=>a("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:",-1)),Se={class:"col-md-auto px-0"},Ne=d(()=>a("option",{selected:"",disabled:""},"請選擇",-1)),Ce={key:0,value:"Newtaipei"},Me={key:1,value:"Taoyuan"},Ve={key:2,value:"Miaoli"},$e={key:0,value:"TaipeiNewtaipei2"},ze={key:1,value:"Taipei2"},Te={key:2,value:"Newtaipei2"},Ue={key:3,value:"Taoyuan"},Fe={key:4,value:"Hsinchu2"},Be={key:5,value:"Hsinchu_Country2"},Ee={key:6,value:"Miaoli2"},Ie={key:7,value:"Taichung2"},Oe={key:8,value:"Chiayi2"},We={key:9,value:"Tainan2"},Ye={key:10,value:"Kaohsiung2"},je={key:11,value:"Pingtung2"},Le={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Re={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},qe=d(()=>a("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"項目:",-1)),He={class:"col-md-auto px-0"},Pe=se('<option selected disabled data-v-1506b38f>請選擇</option><option value="無位可還5分鐘以上次數" data-v-1506b38f>無位可還5分鐘以上次數</option><option value="無位可還10分鐘以上次數" data-v-1506b38f> 無位可還10分鐘以上次數 </option><option value="無車可借10分鐘以上次數" data-v-1506b38f> 無車可借10分鐘以上次數 </option><option value="無車綁車10分鐘以上次數" data-v-1506b38f> 無車綁車10分鐘以上次數 </option>',5),Ae=[Pe],Ke={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Ge={__name:"SchedulingweekReport",setup(w){const F=E("ischange"),Y=E("$swal"),c=Q().citys;async function y(o){Y({icon:"error",title:`${o}`,showConfirmButton:!1})}const v=m(),D=m(!1),f=m([]),_=m("請選擇"),b=m([]),h=m("請選擇"),p=m("請選擇"),S=m("請選擇");let M=[],V="",$=[];const B=(o,e,t)=>{M=[],V="",$=[],M=[...o],V=t,e.forEach(l=>{$.push(l.title)})},j=o=>{const e=new Date(o),t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),u=new Date(l);u.setDate(l.getDate()-(l.getDay()||7)+1);const T=e.getDay();if(e>=u||T!==1)return!0;const k=e.getFullYear(),x=e.getMonth()+1,U=e.getDate();return k<2023||k===2023&&(x<9||x===9&&U<4)},L=o=>{const e=new Date(o),t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),u=new Date(l);u.setDate(l.getDate()-(l.getDay()||7)+1);const T=e.getDay();if(e>=u||T!==1)return!0;const k=e.getFullYear(),x=e.getMonth()+1,U=e.getDate();return k<2023||k===2023&&(x<9||x===9&&U<11)},R=o=>{let e=[];e=o.map((t,l)=>({key:`item${l+1}`,align:"center",title:t[2]})),e[0].fixed="left",b.value=[...e]},q=o=>{let e=[];for(let t=0;t<o[0].length;t++){if(t===0||t===1||t===2)continue;const l={};for(let u=1;u<=o.length;u++)l[`item${u}`]=o[u-1][t];e.push(l),l.item1==="溫度"?e.push({item1:"基本資訊"}):l.item1==="週/日達成率"?e.push({item1:"無位可還"}):l.item1==="10分鐘無位可還每萬次發生率"&&e.push({item1:"無車可借"})}f.value=[...e]},H=()=>{let o=[{key:"item1",align:"center",title:"排名"},{key:"item2",align:"center",title:"場站名稱"},{key:"item3",align:"center",title:"分區"},{key:"item4",align:"center",title:"次數"},{key:"item5",align:"center",title:"上週次數"}];b.value=[...o]},P=o=>{let e=[];o.forEach(t=>{e.push({item1:t.rank,item2:t.station_name,item3:t.responsible_area,item4:t.times,item5:t.times_last_week})}),f.value=[...e]},z=m({pageSize:0}),A=async()=>{try{D.value=!0;const o="https://report.youbike.com.tw/isauth/gcpfun";if(p.value==="調度週報"){const e={dataset_id:"report",table_id:`weekly_report_maintain_query${_.value}`,date:v.value,city:h.value},l=(await W.get(o,{params:e})).data.data;R(l),q(l),z.value={pageSize:100},B(f.value,b.value,"調度週報")}else{const e={dataset_id:"report",table_id:`weekly_report_maintain_rank${_.value}`,date:v.value,city:h.value,item:[S.value]},l=(await W.get(o,{params:e})).data.data;H(),P(l),z.value={pageSize:10},B(f.value,b.value,"調度排名週報")}D.value=!1}catch(o){console.log(o)}};X(p,()=>v.value=null);const K=o=>{if(o.item1==="基本資訊"||o.item1==="無位可還"||o.item1==="無車可借")return"too-old"},G=()=>{if(p.value==="請選擇")return y("請選擇表別");if(_.value==="請選擇")return y("請選擇系統別");if(h.value==="請選擇")return y("請選擇城市");if(!v.value)return y("請選擇日期");if(p.value==="調度排名週報"&&S.value==="請選擇")return y("請選擇項目");A()};return(o,e)=>(n(),i("div",ie,[N(s(ee),{active:D.value,"onUpdate:active":e[0]||(e[0]=t=>D.value=t),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),ce,a("form",{class:Z(["row mx-0",{"report-header":!s(F),"report-header-dark":s(F)}])},[a("div",re,[de,a("div",ue,[g(a("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t)},ve,512),[[C,p.value]])])]),a("div",fe,[he,a("div",ge,[g(a("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),onChange:e[3]||(e[3]=t=>h.value="請選擇")},xe,544),[[C,_.value]])])]),a("div",we,[De,a("div",Se,[g(a("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[4]||(e[4]=t=>h.value=t)},[Ne,_.value==1?(n(),i(I,{key:0},[s(c).includes(3)?(n(),i("option",Ce," 新北市 ")):r("",!0),s(c).includes(4)?(n(),i("option",Me," 桃園市 ")):r("",!0),s(c).includes(7)?(n(),i("option",Ve," 苗栗縣 ")):r("",!0)],64)):_.value=="2"?(n(),i(I,{key:1},[s(c).includes(2)&&s(c).includes(3)?(n(),i("option",$e," 雙北 ")):r("",!0),s(c).includes(2)?(n(),i("option",ze," 台北市 ")):r("",!0),s(c).includes(3)?(n(),i("option",Te," 新北市 ")):r("",!0),s(c).includes(4)?(n(),i("option",Ue," 桃園市 ")):r("",!0),s(c).includes(5)?(n(),i("option",Fe," 新竹市 ")):r("",!0),s(c).includes(6)?(n(),i("option",Be," 新竹縣 ")):r("",!0),s(c).includes(7)?(n(),i("option",Ee," 苗栗縣 ")):r("",!0),s(c).includes(8)?(n(),i("option",Ie," 台中市 ")):r("",!0),s(c).includes(12)?(n(),i("option",Oe," 嘉義市 ")):r("",!0),s(c).includes(14)?(n(),i("option",We," 台南市 ")):r("",!0),s(c).includes(15)?(n(),i("option",Ye," 高雄市 ")):r("",!0),s(c).includes(16)?(n(),i("option",je," 屏東縣 ")):r("",!0)],64)):r("",!0)],512),[[C,h.value]])]),a("div",Le,[N(s(te),{class:"px-0","formatted-value":v.value,"onUpdate:formattedValue":e[5]||(e[5]=t=>v.value=t),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":p.value==="調度週報"?j:L,"update-value-on-close":!0,placeholder:"請選擇日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value","is-date-disabled"])])]),g(a("div",Re,[qe,a("div",He,[g(a("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[6]||(e[6]=t=>S.value=t)},Ae,512),[[C,S.value]])])],512),[[O,p.value==="調度排名週報"]]),a("div",Ke,[a("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:G}," 搜尋 "),N(le,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:s(M),name:s(V),header:s($)},null,8,["data","name","header"])])],2),g(N(s(ne),{size:"small",data:f.value,"row-class-name":K,pagination:z.value,columns:b.value,"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["data","pagination","columns"]),[[O,f.value.length>1]])]))}},at=J(Ge,[["__scopeId","data-v-1506b38f"]]);export{at as default};
