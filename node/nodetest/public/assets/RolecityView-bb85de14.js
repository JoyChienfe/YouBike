import{i as x,r as l,o as p,c as h,b as $,d as f,e,n as M,b4 as C,F as z,b3 as P,m as R,k as i,L as S,l as q,bi as G}from"./index-b68f8f3e.js";import{N as H}from"./Mention-9bf2459c.js";const I={class:"container-fluid px-0"},J=e("div",{class:"row mx-0"},[e("h1",{class:"report-h1 fw-bold"},"帳號城市權限管理")],-1),K=e("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[e("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"帳號資料:")],-1),O={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12 px-0"},Q=e("hr",null,null,-1),T={key:0},W={class:"mt-2 fw-bold"},X=e("h3",{class:"mt-2 fw-bold"},"城市:",-1),Y=["id","onUpdate:modelValue"],Z=["for"],at={__name:"RolecityView",setup(tt){const _=x("ischange"),c=l(!1),n=l(),y=l([]),w=x("$swal");async function N(t){w({icon:"error",title:`${t}`,showConfirmButton:!1})}async function V(t){w({icon:"success",title:`${t}`,showConfirmButton:!1})}const B=l(null),E=async()=>{const t="https://report.youbike.com.tw/isauth/roles",s=(await i.get(t)).data.rows;B.value=[...s]},b=l([]);async function L(){c.value=!0,await E();const t=[],a="https://report.youbike.com.tw/isauth/userrole",s=await i.get(a);c.value=!1,b.value=[...s.data.rows],b.value.forEach(o=>{t.push({label:`${o.name}_${o.users_id}`,value:`${o.name}_${o.users_id}`})}),y.value=[...t]}(async function(){await L()})();const r=l([]),v=l(""),U=async()=>{try{let t="";n.value.includes("@")&&(t=n.value.replace("@","")),v.value=t;const s=`https://report.youbike.com.tw/isauth/usercity/${t.split("_")[1]}`,o="https://report.youbike.com.tw/isauth/citys";c.value=!0;const u=await Promise.all([await i.get(s),await i.get(o)]);c.value=!1;const A=u[0].data.rows,D=u[1].data.rows,F=A.map(m=>m.city_id),d=[];D.forEach((m,g)=>{d.push(m),F.includes(m.city_id)?d[g].isselect=!0:d[g].isselect=!1}),r.value=[...d]}catch{return c.value=!1,N("格式不正確")}},k=()=>{r.value=[]},j=async()=>{try{const t=v.value.split("_")[1].trim(),a=[];r.value.forEach(o=>{o.isselect&&a.push({users_id:t,city_id:o.city_id})});const s=`https://report.youbike.com.tw/isauth/role_citys/${t}`;k(),n.value="@",await V("成功修改"),await i.put(s,a)}catch(t){console.log(t)}};return(t,a)=>(p(),h("div",I,[$(f(S),{active:c.value,"onUpdate:active":a[0]||(a[0]=s=>c.value=s),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),J,e("form",{class:M(["row mx-0",{"report-header":!f(_),"report-header-dark":f(_)}])},[K,e("div",O,[$(f(H),{options:y.value,"default-value":"@",value:n.value,"onUpdate:value":a[1]||(a[1]=s=>n.value=s)},null,8,["options","value"])]),e("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[e("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:U}," 確定 ")])],2),Q,r.value.length>0?(p(),h("div",T,[e("h2",W,C(v.value),1),X,(p(!0),h(z,null,P(r.value,(s,o)=>(p(),h("div",{key:`${o}111`,class:"form-check form-check-inline"},[q(e("input",{class:"form-check-input",type:"checkbox",id:s.city_name,"onUpdate:modelValue":u=>s.isselect=u},null,8,Y),[[G,s.isselect]]),e("label",{class:"form-check-label fw-bold",for:s.city_name},C(s.city_name),9,Z)]))),128)),e("div",{style:{display:"flex","justify-content":"flex-start"},class:"mt-3"},[e("button",{type:"buttno",class:"btn btn-secondary me-3",onClick:k}," 取消 "),e("button",{type:"button",class:"btn btn-success",onClick:j}," 確定 ")])])):R("",!0)]))}};export{at as default};
