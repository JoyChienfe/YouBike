import{u as H,r as u,i as E,o as P,c as S,b as d,d as n,e as t,n as $,l as L,p as O,L as V,y as T,q as F,k as K}from"./index-e760d64d.js";import{_ as W}from"./OutputExcel-db8b34cf.js";import{N as Y}from"./DataTable-243f741d.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const j={class:"container-fluid px-0"},q=t("div",{class:"row mx-0"},[t("h1",{class:"report-h1 fw-bold"},"TOP50 排名週報")],-1),A=t("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[t("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),R={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},G=t("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[t("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"借/還:")],-1),I={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12 mb-3 mb-md-0"},J={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},Q={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ne={__name:"TopReport",setup(X){const e=H().citys,m=u(!1),x=E("ischange"),h=u(null),b=u(),D=E("$swal");async function f(s){D({icon:"error",title:`${s}`,showConfirmButton:!1})}const k=u([{key:"item1",align:"center",title:"借/還"},{key:"item2",align:"center",title:"城市"},{key:"item3",align:"center",title:"場站名稱",width:300},{key:"item4",align:"center",title:"開站時間"},{key:"item5",align:"center",title:"本週次數"},{key:"item6",align:"center",title:"本週排名"},{key:"item7",align:"center",title:"上週次數"},{key:"item8",align:"center",title:"上週排名"},{key:"item9",align:"center",title:"與上週比較次數成長率"}]),v=u([]),c=u([]);let p=[{label:"台北市2.0",value:"Taipei2",disabled:!e.includes(2)},{label:"新北市1.0",value:"Newtaipei",disabled:!e.includes(3)},{label:"新北市2.0",value:"Newtaipei2",disabled:!e.includes(3)},{label:"桃園市1.0",value:"Taoyuan",disabled:!e.includes(4)},{label:"桃園市2.0",value:"Taoyuan2",disabled:!e.includes(4)},{label:"桃園市2.0E",value:"Taoyuan2E",disabled:!e.includes(4)},{label:"新竹縣2.0",value:"Hsinchu_Country2",disabled:!e.includes(6)},{label:"新竹縣2.0E",value:"Hsinchu_Country2E",disabled:!e.includes(6)},{label:"新竹市2.0",value:"Hsinchu2",disabled:!e.includes(5)},{label:"新竹市2.0E",value:"Hsinchu2E",disabled:!e.includes(5)},{label:"苗栗縣1.0",value:"Miaoli",disabled:!e.includes(7)},{label:"苗栗縣2.0",value:"Miaoli2",disabled:!e.includes(7)},{label:"苗栗縣2.0E",value:"Miaoli2E",disabled:!e.includes(7)},{label:"台中市1.0",value:"Taichung",disabled:!e.includes(8)},{label:"台中市2.0",value:"Taichung2",disabled:!e.includes(8)},{label:"台中市2.0E",value:"Taichung2E",disabled:!e.includes(8)},{label:"嘉義市2.0",value:"Chiayi2",disabled:!e.includes(12)},{label:"嘉義市2.0E",value:"Chiayi2E",disabled:!e.includes(12)},{label:"台南市2.0",value:"Tainan2",disabled:!e.includes(14)},{label:"台南市2.0E",value:"Tainan2E",disabled:!e.includes(14)},{label:"高雄市2.0",value:"Kaohsiung2",disabled:!e.includes(15)},{label:"高雄市2.0E",value:"Kaohsiung2E",disabled:!e.includes(15)},{label:"屏東縣2.0",value:"Pingtung2",disabled:!e.includes(16)},{label:"屏東縣2.0E",value:"Pingtung2E",disabled:!e.includes(16)}];const C=s=>{const a=new Date(s),l=new Date,o=new Date(l.getFullYear(),l.getMonth(),l.getDate()),r=new Date(o);r.setDate(o.getDate()-(o.getDay()||7)+1);const i=a.getDay();return a>=r||i!==1||a.getFullYear()<2023};(function(){let a=[];p.forEach(l=>{l.disabled||a.push(l)}),p=[...a]})();const g=u([]),N=[{label:"借",value:"rent"},{label:"還",value:"return"}],M=()=>{let s=[];p.forEach(a=>{s.push(a.value)}),c.value=s};let y=[],_="",w=[];const z=(s,a,l)=>{y=[],w=[],_="",y=[...s],_=l,a.forEach(o=>{w.push(o.title)})},U=async()=>{const s={dataset_id:"report",table_id:"weekly_rank",item:g.value,city:c.value,date:b.value};m.value=!0;const a="https://report.youbike.com.tw/isauth/gcpfun",o=(await K.get(a,{params:s})).data.data,r=[];o.forEach(i=>{r.push({item1:i.item_ch,item2:i.city_ch,item3:i.station_name,item4:i.start_time,item5:i.times_this_week,item6:i.rank_this_week,item7:i.times_last_week,item8:i.rank_last_week,item9:i.growth_rate})}),h.value.page&&h.value.page(1),v.value=[...r],z(v.value,k.value,"Top50 排名週報"),m.value=!1},B=async()=>{if(g.value.length==0)return f("請選擇借/還");if(c.value.length==0)return f("請選擇城市");if(!b.value)return f("請選擇日期");await U()};return(s,a)=>(P(),S("div",j,[d(n(V),{active:m.value,"onUpdate:active":a[0]||(a[0]=l=>m.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),q,t("form",{class:$(["row mx-0",{"report-header":!n(x),"report-header-dark":n(x)}])},[A,t("div",R,[d(n(T),{class:"px-0",value:c.value,"onUpdate:value":a[1]||(a[1]=l=>c.value=l),placeholder:"請選擇",multiple:"",options:n(p),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),t("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[t("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:M}," 城市全選 ")]),G,t("div",I,[d(n(T),{class:"px-0",value:g.value,"onUpdate:value":a[2]||(a[2]=l=>g.value=l),placeholder:"請選擇",multiple:"",options:N,"max-tag-count":1,size:"medium"},null,8,["value"])]),t("div",J,[d(n(F),{class:"px-0","formatted-value":b.value,"onUpdate:formattedValue":a[3]||(a[3]=l=>b.value=l),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"請選每週一日期","value-format":"yyyy-MM-dd","is-date-disabled":C},null,8,["formatted-value"])]),t("div",Q,[t("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:B}," 搜尋 "),d(W,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:n(y),name:n(_),header:n(w)},null,8,["data","name","header"])])],2),L(d(n(Y),{size:"small",data:v.value,ref_key:"dataTable",ref:h,columns:k.value,pagination:{pageSize:17},"max-height":600,"scroll-x":700,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"]),[[O,v.value.length>1]])]))}};export{ne as default};
