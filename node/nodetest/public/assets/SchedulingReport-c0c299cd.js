import{i as M,u as K,r as m,o,c as l,b as g,d as e,e as n,l as V,v as E,F as S,m as u,n as R,p as G,L as I,q as U,k as J}from"./index-2bed0a42.js";import{_ as O}from"./OutputExcel-3a33b057.js";import{N as Q}from"./DataTable-04116403.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const W={class:"container-fluid px-0"},X=n("div",{class:"row mx-0"},[n("h1",{class:"report-h1 fw-bold"},"調度日報")],-1),Y={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Z=n("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1),ee={class:"col-md-auto px-0"},te=n("option",{selected:"",disabled:""},"請選擇",-1),ae=n("option",{value:"1"},"1.0",-1),se=n("option",{value:"2"},"2.0+2.0E",-1),oe=[te,ae,se],le={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ne=n("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:",-1),ie={class:"col-md-auto px-0"},ue=n("option",{selected:"",disabled:""},"請選擇",-1),ce={key:0,value:"Newtaipei"},de={key:1,value:"Taoyuan"},re={key:2,value:"Miaoli"},me={key:0,value:"TaipeiNewtaipei2"},pe={key:1,value:"Taipei2"},ve={key:2,value:"Newtaipei2"},_e={key:3,value:"Taoyuan2"},he={key:4,value:"Hsinchu2"},fe={key:5,value:"Hsinchu_Country2"},ye={key:6,value:"HsinchuScience2"},ge={key:7,value:"Miaoli2"},xe={key:8,value:"Taichung2"},be={key:9,value:"Chiayi2"},ke={key:10,value:"Chiayi_Country2"},De={key:11,value:"Tainan2"},we={key:12,value:"Kaohsiung2"},Ce={key:13,value:"Pingtung2"},He={key:14,value:"Taitung2"},Ne={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Te={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Ve={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Le={__name:"SchedulingReport",setup($e){const $=M("ischange"),B=M("$swal"),i=K().citys;async function x(c){B({icon:"error",title:`${c}`,showConfirmButton:!1})}const _=m(),h=m(),b=m(!1),k=m([]),f=m("請選擇"),D=m(null),w=m([]),y=m("請選擇");let C=[],H="",N=[];const z=(c,t,a)=>{C=[],H="",N=[],C=[...c],H=a,t.forEach(s=>{N.push(s.title)})},L=c=>{const t=h.value,a=new Date;if(a.setHours(0,0,0,0),t){const s=new Date(t);s.setHours(0,0,0,0);const d=new Date(s);d.setDate(d.getDate()-30);const r=new Date(c);if(r.setHours(0,0,0,0),r<d||r>s||r>=a)return!0}else{const s=new Date(c);if(s.setHours(0,0,0,0),s>=a)return!0}},j=c=>{const t=_.value,a=new Date;if(a.setHours(0,0,0,0),t){const s=new Date(t);if(s.setHours(0,0,0,0),s>a)return!0;const d=new Date(s);d.setDate(d.getDate()+30);const r=new Date(c);if(r.setHours(0,0,0,0),r<s||r>d||r>=a)return!0}else{const s=new Date(c);if(s.setHours(0,0,0,0),s>=a)return!0}},q=async()=>{const c="https://report.youbike.com.tw/isauth/gcpfun",t={dataset_id:"report",table_id:`daily_report_maintain_query${f.value}`,begin_date:_.value,end_date:h.value,city:y.value};b.value=!0;const s=(await J.get(c,{params:t})).data.data;let d=[];s.forEach((p,v)=>{d.length===0?d.push({key:`item${v+1}`,align:"center",fixed:"left",title:p[2],width:150}):d.push({key:`item${v+1}`,align:"center",title:p[2]})});const r=s[0].length-3,A=s.length;let T=[];for(let p=0;p<r;p++){T.push({});for(let v=1;v<=A;v++)T[p][`item${v}`]=s[v-1][p+3]}w.value=[...d],k.value=[...T],D.value.page&&D.value.page(1),z(k.value,w.value,"調度日報"),b.value=!1},F=()=>{if(f.value==="請選擇"){x("請選擇系統別");return}else if(y.value==="請選擇"){x("請選擇城市");return}else if(_.value){if(!h.value)return x("請選擇結束時間")}else return x("請選擇開始時間");q()},P=()=>{_.value=null,h.value=null};return(c,t)=>(o(),l("div",W,[g(e(I),{active:b.value,"onUpdate:active":t[0]||(t[0]=a=>b.value=a),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),X,n("form",{class:R(["row mx-0",{"report-header":!e($),"report-header-dark":e($)}])},[n("div",Y,[Z,n("div",ee,[V(n("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),onChange:t[2]||(t[2]=a=>y.value="請選擇")},oe,544),[[E,f.value]])])]),n("div",le,[ne,n("div",ie,[V(n("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a)},[ue,f.value==1?(o(),l(S,{key:0},[e(i).includes(3)?(o(),l("option",ce," 新北市 ")):u("",!0),e(i).includes(4)?(o(),l("option",de," 桃園市 ")):u("",!0),e(i).includes(7)?(o(),l("option",re," 苗栗縣 ")):u("",!0)],64)):f.value=="2"?(o(),l(S,{key:1},[e(i).includes(2)&&e(i).includes(3)?(o(),l("option",me,"雙北")):u("",!0),e(i).includes(2)?(o(),l("option",pe,"台北市")):u("",!0),e(i).includes(3)?(o(),l("option",ve,"新北市")):u("",!0),e(i).includes(4)?(o(),l("option",_e,"桃園市")):u("",!0),e(i).includes(5)?(o(),l("option",he,"新竹市")):u("",!0),e(i).includes(6)?(o(),l("option",fe,"新竹縣")):u("",!0),e(i).includes(20)?(o(),l("option",ye,"竹科")):u("",!0),e(i).includes(7)?(o(),l("option",ge,"苗栗縣")):u("",!0),e(i).includes(8)?(o(),l("option",xe,"台中市")):u("",!0),e(i).includes(12)?(o(),l("option",be,"嘉義市")):u("",!0),e(i).includes(13)?(o(),l("option",ke,"嘉義縣")):u("",!0),e(i).includes(14)?(o(),l("option",De,"台南市")):u("",!0),e(i).includes(15)?(o(),l("option",we,"高雄市")):u("",!0),e(i).includes(16)?(o(),l("option",Ce,"屏東縣")):u("",!0),e(i).includes(19)?(o(),l("option",He,"台東縣")):u("",!0)],64)):u("",!0)],512),[[E,y.value]])])]),n("div",Ne,[g(e(U),{class:"px-0","formatted-value":_.value,"onUpdate:formattedValue":t[4]||(t[4]=a=>_.value=a),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":L},null,8,["formatted-value"])]),n("div",Te,[g(e(U),{class:"px-0","formatted-value":h.value,"onUpdate:formattedValue":t[5]||(t[5]=a=>h.value=a),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":j,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])]),n("div",Ve,[n("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:P}," 清空日期 "),n("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:F}," 搜尋 "),g(O,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:e(C),name:e(H),header:e(N)},null,8,["data","name","header"])])],2),V(g(e(Q),{size:"small",data:k.value,ref_key:"dataTable",ref:D,columns:w.value,pagination:{pageSize:18},"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"]),[[G,k.value.length>1]])]))}};export{Le as default};
