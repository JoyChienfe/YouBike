import{i as w,r as u,u as T,o as L,c as I,b as m,d as i,e as o,n as O,l as R,p as V,L as j,y as S,k as H}from"./index-51f79bed.js";import{_ as P}from"./OutputExcel-c7156f1d.js";import{N as q}from"./DataTable-69ff6a12.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const G={class:"container-fluid px-0"},J=o("div",{class:"row mx-0"},[o("h1",{class:"report-h1 fw-bold"},"Email投保分類")],-1),K=o("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[o("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),Q={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},W=o("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[o("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"日期:")],-1),X={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},Z={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ie={__name:"PutsearchReportemail",setup(ee){const _=w("ischange"),D=w("$swal");async function k(t){D({icon:"error",title:`${t}`,showConfirmButton:!1})}const p=u(!1),E=u(),s=T().citys,b=u([]),r=u([]),d=u([]);let v=[],g="",f=[];const $=(t,e,l)=>{v=[],g="",f=[],v=[...t],g=l,e.forEach(n=>{f.push(n.title)})};function M(){const t=new Date("2018-01-01"),e=new Date,l=[];let n=new Date(t);for(;n<e;){const c=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),B=`${c}-${a}`,F=`${c}-${a}`;l.push({label:B,value:F}),n.setMonth(n.getMonth()+1)}if(l.length>0){const c=l[l.length-1].value,a=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");c===a&&l.reverse()}return l}let h=[{label:"全公司",value:"全公司"},{label:"台北市",value:"台北市",disabled:!s.includes(2)},{label:"新北市",value:"新北市",disabled:!s.includes(3)},{label:"桃園市",value:"桃園市",disabled:!s.includes(4)},{label:"新竹市+竹科",value:"新竹市+竹科",disabled:!s.includes(5)||!s.includes(20)},{label:"新竹市",value:"新竹市",disabled:!s.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!s.includes(6)},{label:"竹科",value:"竹科",disabled:!s.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!s.includes(7)},{label:"台中市",value:"台中市",disabled:!s.includes(8)},{label:"彰化縣",value:"彰化縣",disabled:!s.includes(9)},{label:"嘉義市",value:"嘉義市",disabled:!s.includes(12)},{label:"台南市",value:"台南市",disabled:!s.includes(14)},{label:"高雄市",value:"高雄市",disabled:!s.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!s.includes(16)}],y=[];(function(){let e=[];h.forEach(n=>{n.disabled||e.push(n)}),h=[...e];const l=M();l.shift(),y=[...l]})();const N=()=>{let t=[];h.forEach(e=>{t.push(e.value)}),d.value=t},Y=()=>{let t=[];y.forEach(e=>{t.push(e.value)}),r.value=[...t]},x=[{key:"item1",align:"center",fixed:"left",title:"月份"},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"未投保卡片",children:[{key:"item3",align:"center",title:"app"},{key:"item4",align:"center",title:"kiosk"},{key:"item5",align:"center",title:"web"},{key:"item6",align:"center",title:"合計"}]},{key:"item7",align:"center",title:"投保卡片",children:[{key:"item7",align:"center",title:"app"},{key:"item8",align:"center",title:"kiosk"},{key:"item9",align:"center",title:"web"},{key:"item10",align:"center",title:"合計"}]},{key:"item10",align:"center",title:"總計"}];function z(t){return t.map(e=>e.replace(/-/g,""))}function C(t){if(typeof t!="number")throw new Error("Input must be a number.");const e=Math.floor(t/100),l=t%100;return`${e}年${l.toString().padStart(2,"0")}月`}const U=async()=>{try{const t="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"report",table_id:"monthly_report_email_INSUR_count",date:z(r.value),city:d.value};p.value=!0;const l=await H.get(t,{params:e});p.value=!1;const n=l.data.data;let c=[];n.forEach(a=>{c.push({item1:C(a.date),item2:a.city,item3:a.N_app,item4:a.N_kiosk,item5:a.N_web,item6:a.N_total,item7:a.Y_app,item8:a.Y_kiosk,item9:a.Y_web,item10:a.Y_total,item11:a.total})}),b.value=[...c],$(b.value,x,"Email投保分類")}catch(t){console.log(t)}},A=()=>{if(d.value.length===0)return k("請選擇城市");if(r.value.length===0)return k("請選擇日期");U()};return(t,e)=>(L(),I("div",G,[m(i(j),{active:p.value,"onUpdate:active":e[0]||(e[0]=l=>p.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),J,o("form",{class:O(["row mx-0",{"report-header":!i(_),"report-header-dark":i(_)}])},[K,o("div",Q,[m(i(S),{value:d.value,"onUpdate:value":e[1]||(e[1]=l=>d.value=l),placeholder:"請選擇",multiple:"",options:i(h),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),o("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:N}," 城市全選 ")]),W,o("div",X,[m(i(S),{value:r.value,"onUpdate:value":e[2]||(e[2]=l=>r.value=l),placeholder:"請選擇",multiple:"",options:i(y),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),o("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:Y}," 日期全選 ")]),o("div",Z,[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:A}," 搜尋 "),m(P,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:i(v),name:i(g),header:i(f)},null,8,["data","name","header"])])],2),R(m(i(q),{ref_key:"dataTable",ref:E,data:b.value,columns:x,pagination:{pageSize:17},"max-height":600,"scroll-x":1e3,bordered:!1,size:"small","single-line":!1,striped:""},null,8,["data"]),[[V,b.value.length>0]])]))}};export{ie as default};
