import{i as D,r,u as L,o as M,c as O,b as u,d as o,e as s,n as T,l as F,p as G,L as V,y as S,k as W}from"./index-9fc17187.js";import{_ as j}from"./OutputExcel-293e323a.js";import{N as H}from"./DataTable-61e71186.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const P={class:"container-fluid px-0"},Y=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"投保率分析週報")],-1),q=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),J={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},K=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"日期:")],-1),Q={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},X={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ne={__name:"PutsearchReportweek",setup(Z){const y=D("ischange"),N=D("$swal");async function x(a){N({icon:"error",title:`${a}`,showConfirmButton:!1})}const m=r(!1),E=r(),t=L().citys,p=r([]),c=r([]),d=r([]);let v=[],g="",_=[];const U=(a,e,l)=>{v=[],g="",_=[],v=[...a],g=l,e.forEach(i=>{_.push(i.title)})};function C(){const a=new Date("2018-01-01"),e=new Date,l=[];let i=new Date(a);for(;i<=e;){if(i.getDay()===1){const n=i.getFullYear(),A=String(i.getMonth()+1).padStart(2,"0"),I=String(i.getDate()).padStart(2,"0"),w=`${n}-${A}-${I}`;l.push({label:w,value:w})}i.setDate(i.getDate()+1)}return l.reverse(),l}let b=[{label:"全公司",value:"全公司"},{label:"台北市",value:"台北市",disabled:!t.includes(2)},{label:"新北市",value:"新北市",disabled:!t.includes(3)},{label:"桃園市",value:"桃園市",disabled:!t.includes(4)},{label:"新竹市+竹科",value:"新竹市+竹科",disabled:!t.includes(5)||!t.includes(20)},{label:"新竹市",value:"新竹市",disabled:!t.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!t.includes(6)},{label:"竹科",value:"竹科",disabled:!t.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!t.includes(7)},{label:"台中市",value:"台中市",disabled:!t.includes(8)},{label:"彰化縣",value:"彰化縣",disabled:!t.includes(9)},{label:"嘉義市",value:"嘉義市",disabled:!t.includes(12)},{label:"嘉義縣",value:"嘉義縣",disabled:!t.includes(13)},{label:"台南市",value:"台南市",disabled:!t.includes(14)},{label:"高雄市",value:"高雄市",disabled:!t.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!t.includes(16)},{label:"台東縣",value:"台東縣",disabled:!t.includes(19)}],h=[];(function(){let e=[];b.forEach(i=>{i.disabled||e.push(i)}),b=[...e];const l=C();l.shift(),h=[...l]})();const $=()=>{let a=[];b.forEach(e=>{a.push(e.value)}),d.value=a},B=()=>{let a=[];h.forEach(e=>{a.push(e.value)}),c.value=[...a]},k=[{key:"item1",align:"center",fixed:"left",title:"週次",width:150},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"總會員卡數(A)"},{key:"item4",align:"center",title:"總騎乘次數(B)"},{key:"item5",align:"center",title:"有使用紀錄會員卡數(C)"},{key:"item6",align:"center",title:"註冊地卡數"},{key:"item7",align:"center",title:"非註冊地卡數"},{key:"item8",align:"center",title:"有使用記錄卡片占比(D=C/A)"},{key:"item9",align:"center",title:"有使用記錄卡片加保張數(E)"},{key:"item10",align:"center",title:"保險涵蓋率_卡片數(F=E/C)"},{key:"item11",align:"center",title:"有加保卡片的騎乘次數(G)"},{key:"item12",align:"center",title:"保險涵蓋率_使用次數(H=G/B)"}],R=async()=>{try{const a="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"report",table_id:"weekly_report_ride_INSUR",date:c.value,city:d.value};m.value=!0;const l=await W.get(a,{params:e});m.value=!1;const i=l.data.data;let f=[];i.forEach(n=>{f.push({item1:n.week_range,item2:n.city,item3:n.total_card,item4:n.ride_times,item5:n.ride_card,item6:n.ride_card_incity,item7:n.ride_card_nocity,item8:n.active_per,item9:n.ride_card_INSUR,item10:n.ride_card_INSUR_per,item11:n.ride_times_INSUR,item12:n.ride_times_INSUR_per})}),p.value=[...f],U(p.value,k,"投保率分析週報")}catch(a){console.log(a)}},z=()=>{if(d.value.length===0)return x("請選擇城市");if(c.value.length===0)return x("請選擇每周一日期");R()};return(a,e)=>(M(),O("div",P,[u(o(V),{active:m.value,"onUpdate:active":e[0]||(e[0]=l=>m.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),Y,s("form",{class:T(["row mx-0",{"report-header":!o(y),"report-header-dark":o(y)}])},[q,s("div",J,[u(o(S),{value:d.value,"onUpdate:value":e[1]||(e[1]=l=>d.value=l),placeholder:"請選擇",multiple:"",options:o(b),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:$}," 城市全選 ")]),K,s("div",Q,[u(o(S),{value:c.value,"onUpdate:value":e[2]||(e[2]=l=>c.value=l),placeholder:"請選擇日期",multiple:"",options:o(h),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:B}," 日期全選 ")]),s("div",X,[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:z}," 搜尋 "),u(j,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:o(v),name:o(g),header:o(_)},null,8,["data","name","header"])])],2),F(u(o(H),{ref_key:"dataTable",ref:E,data:p.value,columns:k,pagination:{pageSize:17},"max-height":600,"scroll-x":1e3,bordered:!1,size:"small","single-line":!1,striped:""},null,8,["data"]),[[G,p.value.length>0]])]))}};export{ne as default};
