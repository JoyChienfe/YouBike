import{i as g,r as u,o as w,c as D,e as o,l as V,v as j,n as T,d as m,x as U,w as z,m as A,k as _,b as G,B as L}from"./index-e7986d38.js";import{r as R,u as F}from"./xlsx-bd534488.js";import{N as I}from"./Watermark-0c3a3ae7.js";import{N as M}from"./DataTable-8fcca231.js";import"./get-slot-1efb97e5.js";const O={class:"container-fluid px-0"},P=o("div",{class:"row mx-0"},[o("h1",{class:"report-h1 fw-bold"},"上傳檔案")],-1),W={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},q={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},H=o("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"表格:",-1),J={class:"col-md-auto px-0"},K=L('<option selected disabled>請選擇</option><option value="engine">工程</option><option value="FourG">1.0 4G場站</option><option value="officetel">辦公室電話</option><option value="officeinternet">辦公室網路</option><option value="IpadTotal">平板統計</option>',6),Q=[K],at={__name:"UpexcelView",setup(X){const x=g("ischange"),v=u(null);let c=[];const d=u([]),s=u([]),n=u("請選擇"),f=g("$swal");async function p(e){f({icon:"error",title:`${e}`,showConfirmButton:!1})}async function b(e){f({icon:"success",title:`${e}`,showConfirmButton:!1})}async function y(){try{const e={data:s.value},t="https://report.youbike.com.tw";await _.put(`${t}/toexcel/${n.value}`,e)}catch(e){console.log(e)}}function h(){v.value.value="",s.value=[],d.value=[],n.value="請選擇"}async function k(){(await f({title:"確定送出嗎?",text:"送出後，將會覆蓋原本的表格",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"})).isConfirmed&&(y(),h(),b("成功上傳"))}const B=()=>{const e=c[0];let t=[];e.forEach((a,l)=>{t.push({key:`item${l}`,align:"center",title:a})}),d.value=[...t]},C=()=>{const e=c,t=[];e.forEach((a,l)=>{if(l===0)return;let r={};for(let i=0;i<c[0].length;i++)r[`item${i}`]=a[i];t.push(r)}),s.value=[...t]},N=async e=>{const t=e.target.files[0];if(t.name.split(".").pop()!=="csv"){p("格式不正確"),h();return}const r=URL.createObjectURL(t);await E(r),B(),C()},E=async e=>{try{const t=await _.get(e,{responseType:"arraybuffer"});c=[...S(t.data)]}catch(t){console.log(t)}};function S(e){const t=R(e,{type:"array",codepage:65001}),a=t.Sheets[t.SheetNames[0]];return F.sheet_to_json(a,{header:1,defval:"",blankrows:!0})}const $=async()=>{if(n.value==="請選擇"){p("請選擇表格");return}else if(s.value.length===0){p("請選擇檔案");return}k()};return(e,t)=>(w(),D("div",O,[P,o("form",{class:T(["row mx-0",{"report-header":!m(x),"report-header-dark":m(x)}])},[o("div",W,[o("input",{type:"file",class:"form-control",onChange:N,ref_key:"file",ref:v},null,544)]),o("div",q,[H,o("div",J,[V(o("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a)},Q,512),[[j,n.value]])])]),o("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:$}," 送出 "),o("button",{type:"button",class:"btn btn-secondary text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:h}," 清除 ")])],2),s.value.length?(w(),U(m(I),{key:0,content:"預覽圖",cross:"",selectable:"","font-size":16,"line-height":16,width:192,height:128,"x-offset":12,"y-offset":28,rotate:-15},{default:z(()=>[G(m(M),{data:s.value,columns:d.value,pagination:{pageSize:20},"max-height":500,"scroll-x":800,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"])]),_:1})):A("",!0)]))}};export{at as default};
