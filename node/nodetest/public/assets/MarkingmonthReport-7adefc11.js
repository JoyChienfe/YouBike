import{r,i as w,o as V,c as z,b as p,d as s,e as l,l as y,v as L,n as S,p as T,L as U,q as F,k as P}from"./index-7b4e55c1.js";import{_ as Y}from"./OutputExcel-bdbd0611.js";import{N as j}from"./DataTable-48a84b8a.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const q={class:"container-fluid px-0"},A=l("div",{class:"row mx-0"},[l("h1",{class:"report-h1 fw-bold"},"行銷月報(每月10號更新資料)")],-1),R={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},G=l("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1),H={class:"col-md-auto px-0"},I=l("option",{selected:"",disabled:""},"請選擇",-1),J=l("option",{value:"1"},"1.0",-1),K=l("option",{value:"2_E"},"2.0+2.0E",-1),O=[I,J,K],Q={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},W={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},le={__name:"MarkingmonthReport",setup(X){const i=r(),x=w("ischange"),m=r(!1),c=r("請選擇"),d=r([]),f=r([]),v=r(null),k=w("$swal");function b(a){k({icon:"error",title:`${a}`,showConfirmButton:!1})}const E=a=>{const e=new Date(a),t=e.getFullYear(),o=e.getMonth()+1,u=new Date,n=u.getFullYear(),C=u.getMonth()+1;return t<2023||t>n||t===n&&o>=C},$=a=>{let e=[];a[0].forEach((t,o)=>{o===0||o===1||e.push({})}),a.forEach((t,o)=>{t.forEach((u,n)=>{n===0||n===1||n===2||(e[n-3][`item${o+1}`]=u)})}),d.value=[...e]},D=a=>{let e=[];e=a.map((t,o)=>({key:`item${o+1}`,align:"center",title:t[2]})),e[0].fixed="left",c.value!="1"&&(e[0].width="100px"),f.value=[...e]};let h=[],_="",g=[];const M=(a,e,t)=>{h=[],_="",g=[],h=[...a],_=t,e.forEach(o=>{g.push(o.title)})},N=async()=>{try{const a="https://report.youbike.com.tw/isauth/gcpfun";let e={dataset_id:"marketing_report",table_id:`monthly_report${c.value}`,date:`${i.value}-01`};m.value=!0;const t=await P.get(a,{params:e});m.value=!1;const o=t.data.data;$(o),D(o),v.value.page&&v.value.page(1),M(d.value,f.value,"行銷月報")}catch(a){console.log(a)}},B=()=>{if(c.value=="請選擇")return b("請選擇系統別");if(!i.value)return b("請選擇日期");N()};return(a,e)=>(V(),z("div",q,[p(s(U),{active:m.value,"onUpdate:active":e[0]||(e[0]=t=>m.value=t),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),A,l("form",{class:S(["row mx-0",{"report-header":!s(x),"report-header-dark":s(x)}])},[l("div",R,[G,l("div",H,[y(l("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t)},O,512),[[L,c.value]])]),l("div",Q,[p(s(F),{class:"px-0","formatted-value":i.value,"onUpdate:formattedValue":e[2]||(e[2]=t=>i.value=t),type:"month",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"請選擇日期","value-format":"yyyy-MM","is-date-disabled":E},null,8,["formatted-value"])])]),l("div",W,[l("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:B}," 搜尋 "),p(Y,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:s(h),name:s(_),header:s(g)},null,8,["data","name","header"])])],2),y(p(s(j),{size:"small",data:d.value,ref_key:"dataTable",ref:v,columns:f.value,pagination:{pageSize:17},"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"]),[[T,d.value.length>1]])]))}};export{le as default};
