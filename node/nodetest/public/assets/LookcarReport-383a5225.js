/* empty css                     */import{u as J,r as m,i as T,z as K,o as i,c,b as y,d as s,e as a,l as j,v as z,m as r,w as Q,n as Z,k as B,E as X,L as ee,j as te,A as ae,y as oe,q as se}from"./index-1377d8f9.js";import{u as D,w as le}from"./xlsx-bd534488.js";import{N as ne}from"./Result-67a0b242.js";import"./Warning-13e93ea2.js";const ie={class:"container-fluid px-0"},ce=a("div",{class:"row mx-0"},[a("h1",{class:"report-h1 fw-bold"},"見車率統計週報")],-1),ue={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},re=a("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:",-1),de={class:"col-md-auto px-0"},me=a("option",{selected:"",disabled:""},"請選擇",-1),_e={key:0,value:"台北市"},ve={key:1,value:"新北市"},pe={key:2,value:"桃園市"},ye={key:3,value:"新竹市"},fe={key:4,value:"新竹縣"},he={key:5,value:"竹科"},ge={key:6,value:"苗栗縣"},xe={key:7,value:"台中市"},be={key:8,value:"嘉義市"},we={key:9,value:"嘉義縣"},ke={key:10,value:"台南市"},De={key:11,value:"高雄市"},Ve={key:12,value:"屏東縣"},Ue={key:13,value:"台東縣"},Ce={class:"row col-md-auto col-12 my-auto pt-2"},Ne={class:"row col-md-auto col-12 mx-auto mx-md-0"},Ee={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},$e=a("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"區間:",-1),Le={class:"col-md-auto px-0"},Se=a("option",{selected:"",disabled:""},"請選擇",-1),Me=a("option",{value:"all_day"},"全天",-1),Ae=a("option",{value:"6_to_24_hour"},"6-24點",-1),Te=[Se,Me,Ae],je=a("div",{class:"row mx-0 ms-md-0 align-items-center col-md-auto col-12"},[a("label",{class:"col-md-auto ms-md-0 col-form-label px-0 px-md-2 fw-bolder"},"類型:")],-1),ze={class:"row col-md-2 align-items-center mx-0 ps-md-0"},Be={class:"row ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Pe={__name:"LookcarReport",setup(Fe){const u=J().citys,b=m(!1),$=T("ischange"),F=T("$swal"),f=m("請選擇");async function p(l){F({icon:"error",title:`${l}`,showConfirmButton:!1})}let L=[];const S=m([]),w=m([]),h=m(),g=m("請選擇");function M(l){const t=new Date(l),n=new Date,e=new Date(n.getFullYear(),n.getMonth(),n.getDate()),d=new Date(e);d.setDate(e.getDate()-(e.getDay()||7)+1);const o=t.getDay();return t>=d||o!==1||t.getFullYear()<2024}M();let R=[{label:"無車",value:"無車"},{label:"無位",value:"無位"},{label:"見車率",value:"見車率"},{label:"見位率",value:"見位率"}],k=[],V="",U=[];const Y=(l,t,n)=>{if(k=[],U=[],V="",k=[...l],V=n,U=[...t],k.length){const e=D.book_new(),d=D.json_to_sheet(k);D.book_append_sheet(e,d,"sheet1"),D.sheet_add_aoa(d,[U],{origin:"A1"}),le(e,`${V}.xlsx`)}else return p("空資料不能匯出")};let C=[];function O(){C=[];function l(){const t=new Date(h.value),n=new Date(t);n.setDate(n.getDate()+6);function e(v){var P=v.getUTCFullYear(),G=("0"+(v.getUTCMonth()+1)).slice(-2),H=("0"+v.getUTCDate()).slice(-2);return P+"-"+G+"-"+H}const d=[];for(var o=t;o<=n;o.setDate(o.getDate()+1))d.push(e(new Date(o)));return d}C=["責任區","場站代號","站名","車位數","狀態",...l(),"總計"]}const W=async()=>{const l={station:x.value===!0?["all"]:_.value.map(o=>parseInt(o.split("-")[0])),dataset_id:"data_analysis",table_id:"weekly_empty_full_station",date:h.value,item:g.value,city:[f.value],status:w.value};b.value=!0;const t="https://report.youbike.com.tw/isauth/gcpfun",n=await B.get(t,{params:l});b.value=!1;const e=n.data.data;let d=[];e.forEach(o=>{let v=[];v={item1:o.responsible_area,item3:o.s_no,item4:o.s_name,item5:o.s_total,item6:o.status,item7:o.day1,item8:o.day2,item9:o.day3,item10:o.day4,item11:o.day5,item12:o.day6,item13:o.day7,item14:o.total},d.push({...v})}),S.value=[...d],O(),Y(S.value,C,`${g.value==="all_day"?"全天":"6-24點"}_見車率統計週報`)},q=async()=>{if(f.value==="請選擇"){p("請選擇城市");return}else if(_.value.length===0&&!x.value){p("請選擇場站");return}else if(g.value==="請選擇")p("請選擇區間");else if(w.value.length===0){p("請選擇類型");return}else if(h.value==null){p("請選擇日期");return}else try{await W()}catch(l){console.log(l)}},N=m([]),_=m([]),E=m(!1),x=m(!0);function A(l){if(l.length===0){N.value=[],_.value=[];return}E.value=!0,setTimeout(()=>{E.value=!1;const t=[];L.forEach(e=>{l.includes(e.city)&&t.push({label:e.s_name_tw,value:`${e.s_no}-${e.city}`})});const n=_.value.filter(e=>l.includes(e.split("-")[1]));_.value=[...n],N.value=[...t]},200)}K(f,l=>{A(l)});async function I(){const l="https://report.youbike.com.tw/isauth/gcpfun",t={dataset_id:"yb2",table_id:"station"};L=[...(await B.get(l,{params:t})).data.data]}return(async()=>await I())(),(l,t)=>{const n=X;return i(),c("div",ie,[y(s(ee),{active:b.value,"onUpdate:active":t[0]||(t[0]=e=>b.value=e),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),ce,a("form",{class:Z(["row mx-0",{"report-header":!s($),"report-header-dark":s($)}])},[a("div",ue,[re,a("div",de,[j(a("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e)},[me,s(u).includes(2)?(i(),c("option",_e," 台北市 ")):r("",!0),s(u).includes(3)?(i(),c("option",ve," 新北市 ")):r("",!0),s(u).includes(4)?(i(),c("option",pe," 桃園市 ")):r("",!0),s(u).includes(5)?(i(),c("option",ye," 新竹市 ")):r("",!0),s(u).includes(6)?(i(),c("option",fe," 新竹縣 ")):r("",!0),s(u).includes(20)?(i(),c("option",he,"竹科")):r("",!0),s(u).includes(7)?(i(),c("option",ge," 苗栗縣 ")):r("",!0),s(u).includes(8)?(i(),c("option",xe," 台中市 ")):r("",!0),s(u).includes(12)?(i(),c("option",be," 嘉義市 ")):r("",!0),s(u).includes(13)?(i(),c("option",we," 嘉義縣 ")):r("",!0),s(u).includes(14)?(i(),c("option",ke," 台南市 ")):r("",!0),s(u).includes(15)?(i(),c("option",De," 高雄市 ")):r("",!0),s(u).includes(16)?(i(),c("option",Ve," 屏東縣 ")):r("",!0),s(u).includes(19)?(i(),c("option",Ue," 台東縣 ")):r("",!0)],512),[[z,f.value]])])]),a("div",Ce,[y(s(ae),{checked:x.value,"onUpdate:checked":t[2]||(t[2]=e=>x.value=e),size:"large"},{default:Q(()=>[te("場站全選")]),_:1},8,["checked"])]),a("div",Ne,[y(n,{disabled:x.value,modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=e=>_.value=e),filterable:"",options:N.value,placeholder:"請選擇場站名稱","remote-method":A,loading:E.value,class:"text-light mt-3 mt-md-0 px-0 mt-md-1 w240",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",clearable:""},null,8,["disabled","modelValue","options","loading"])]),a("div",Ee,[$e,a("div",Le,[j(a("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[4]||(t[4]=e=>g.value=e)},Te,512),[[z,g.value]])])]),je,a("div",ze,[y(s(oe),{class:"px-0",value:w.value,"onUpdate:value":t[5]||(t[5]=e=>w.value=e),placeholder:"請選擇",multiple:"",options:s(R),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),a("div",Be,[y(s(se),{class:"px-0","formatted-value":h.value,"onUpdate:formattedValue":t[6]||(t[6]=e=>h.value=e),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"選擇星期一的日期","value-format":"yyyy-MM-dd","is-date-disabled":M},null,8,["formatted-value"])]),a("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[a("button",{type:"button",class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:q}," 搜尋匯出 ")])],2),y(s(ne),{class:"mt-5",status:"info",title:"此頁面只供下載EXCEL"})])}}};export{Pe as default};
