import{d0 as ne,d1 as oe,d2 as ie,ca as re,d3 as ae,bF as le,bD as $,ci as se,a4 as ue,bH as de,bI as _,c0 as ce,r as I,W as A,bc as fe,b$ as he,bR as pe,cl as W,ck as ge,ah as b,cm as ve,cn as me,co as be,H as ye,cy as Se,bU as we,ax as O,cz as xe,cb as z}from"./index-9437428c.js";import{N as Ie}from"./Input-3a828f95.js";const Te=t=>{const{boxShadow2:l}=t;return{menuBoxShadow:l}},Me=ne({name:"Mention",common:oe,peers:{InternalSelectMenu:ie,Input:re},self:Te}),Re=Me;function Ce(t,l={debug:!1,useSelectionEnd:!1,checkWidthOverflow:!0}){const T=t.selectionStart!==null?t.selectionStart:0,y=t.selectionEnd!==null?t.selectionEnd:0,f=l.useSelectionEnd?y:T,P=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],S=navigator.userAgent.toLowerCase().includes("firefox");if(!ae)throw new Error("textarea-caret-position#getCaretPosition should only be called in a browser");const d=l==null?void 0:l.debug;if(d){const c=document.querySelector("#input-textarea-caret-position-mirror-div");c!=null&&c.parentNode&&c.parentNode.removeChild(c)}const u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);const r=u.style,i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,h=t.nodeName==="INPUT";r.whiteSpace=h?"nowrap":"pre-wrap",h||(r.wordWrap="break-word"),r.position="absolute",d||(r.visibility="hidden"),P.forEach(c=>{if(h&&c==="lineHeight")if(i.boxSizing==="border-box"){const C=parseInt(i.height),F=parseInt(i.paddingTop)+parseInt(i.paddingBottom)+parseInt(i.borderTopWidth)+parseInt(i.borderBottomWidth),w=F+parseInt(i.lineHeight);C>w?r.lineHeight=`${C-F}px`:C===w?r.lineHeight=i.lineHeight:r.lineHeight="0"}else r.lineHeight=i.height;else r[c]=i[c]}),S?t.scrollHeight>parseInt(i.height)&&(r.overflowY="scroll"):r.overflow="hidden",u.textContent=t.value.substring(0,f),h&&u.textContent&&(u.textContent=u.textContent.replace(/\s/g,"Â "));const a=document.createElement("span");a.textContent=t.value.substring(f)||".",a.style.position="relative",a.style.left=`${-t.scrollLeft}px`,a.style.top=`${-t.scrollTop}px`,u.appendChild(a);const v={top:a.offsetTop+parseInt(i.borderTopWidth),left:a.offsetLeft+parseInt(i.borderLeftWidth),absolute:!1,height:parseInt(i.fontSize)*1.5};return d?a.style.backgroundColor="#aaa":document.body.removeChild(u),v.left>=t.clientWidth&&l.checkWidthOverflow&&(v.left=t.clientWidth),v}const Fe=le([$("mention","width: 100%; z-index: auto; position: relative;"),$("mention-menu",`
 box-shadow: var(--n-menu-box-shadow);
 `,[se({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),Be=Object.assign(Object.assign({},_.props),{to:W.propTo,autosize:[Boolean,Object],options:{type:Array,default:[]},type:{type:String,default:"text"},separator:{type:String,validator:t=>t.length!==1?(we("mention","`separator`'s length must be 1."),!1):!0,default:" "},bordered:{type:Boolean,default:void 0},disabled:Boolean,value:String,defaultValue:{type:String,default:""},loading:Boolean,prefix:{type:[String,Array],default:"@"},placeholder:{type:String,default:""},placement:{type:String,default:"bottom-start"},size:String,renderLabel:Function,status:String,"onUpdate:show":[Array,Function],onUpdateShow:[Array,Function],"onUpdate:value":[Array,Function],onUpdateValue:[Array,Function],onSearch:Function,onSelect:Function,onFocus:Function,onBlur:Function,internalDebug:Boolean}),Ve=ue({name:"Mention",props:Be,setup(t){const{namespaceRef:l,mergedClsPrefixRef:T,mergedBorderedRef:y,inlineThemeDisabled:f}=de(t),P=_("Mention","-mention",Fe,Re,t,T),S=ce(t),d=I(null),u=I(null),r=I(null),i=I("");let h=null,a=null,v=null;const c=A(()=>{const{value:e}=i;return t.options.filter(n=>e?typeof n.label=="string"?n.label.startsWith(e):typeof n.value=="string"?n.value.startsWith(e):!1:!0)}),C=A(()=>xe(c.value,{getKey:e=>e.value})),F=I(null),w=I(!1),L=I(t.defaultValue),j=fe(t,"value"),K=he(j,L),k=A(()=>{const{self:{menuBoxShadow:e}}=P.value;return{"--n-menu-box-shadow":e}}),M=f?pe("mention",void 0,k,t):void 0;function x(e){if(t.disabled)return;const{onUpdateShow:n,"onUpdate:show":o}=t;n&&z(n,e),o&&z(o,e),e||(h=null,a=null,v=null),w.value=e}function H(e){const{onUpdateValue:n,"onUpdate:value":o}=t,{nTriggerFormChange:s,nTriggerFormInput:p}=S;o&&z(o,e),n&&z(n,e),p(),s(),L.value=e}function U(){return t.type==="text"?d.value.inputElRef:d.value.textareaElRef}function D(){var e;const n=U();if(document.activeElement!==n){x(!1);return}const{selectionEnd:o}=n;if(o===null){x(!1);return}const s=n.value,{separator:p}=t,{prefix:R}=t,V=typeof R=="string"?[R]:R;for(let m=o-1;m>=0;--m){const g=s[m];if(g===p||g===`
`||g==="\r"){x(!1);return}if(V.includes(g)){const E=s.slice(m+1,o);x(!0),(e=t.onSearch)===null||e===void 0||e.call(t,E,g),i.value=E,h=g,a=m+1,v=o;return}}x(!1)}function Y(){const{value:e}=u;if(!e)return;const n=U(),o=Ce(n);o.left+=n.parentElement.offsetLeft,e.style.left=`${o.left}px`,e.style.top=`${o.top+o.height}px`}function q(){var e;w.value&&((e=r.value)===null||e===void 0||e.syncPosition())}function X(e){H(e),B()}function B(){setTimeout(()=>{Y(),D(),O().then(q)},0)}function G(e){var n,o;if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!((n=d.value)===null||n===void 0)&&n.isCompositing)return;B()}else if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Enter"){if(!((o=d.value)===null||o===void 0)&&o.isCompositing)return;const{value:s}=F;if(w.value){if(s)if(e.preventDefault(),e.key==="ArrowUp")s.prev();else if(e.key==="ArrowDown")s.next();else{const p=s.getPendingTmNode();p?N(p):x(!1)}}else B()}}function J(e){const{onFocus:n}=t;n==null||n(e);const{nTriggerFormFocus:o}=S;o(),B()}function Q(){var e;(e=d.value)===null||e===void 0||e.focus()}function Z(){var e;(e=d.value)===null||e===void 0||e.blur()}function ee(e){const{onBlur:n}=t;n==null||n(e);const{nTriggerFormBlur:o}=S;o(),x(!1)}function N(e){var n;if(h===null||a===null||v===null)return;const{rawNode:{value:o=""}}=e,s=U(),p=s.value,{separator:R}=t,V=p.slice(v),m=V.startsWith(R),g=`${o}${m?"":R}`;H(p.slice(0,a)+g+V),(n=t.onSelect)===null||n===void 0||n.call(t,e.rawNode,h);const E=a+g.length+(m?1:0);O().then(()=>{s.selectionStart=E,s.selectionEnd=E,D()})}function te(){t.disabled||B()}return{namespace:l,mergedClsPrefix:T,mergedBordered:y,mergedSize:S.mergedSizeRef,mergedStatus:S.mergedStatusRef,mergedTheme:P,treeMate:C,selectMenuInstRef:F,inputInstRef:d,cursorRef:u,followerRef:r,showMenu:w,adjustedTo:W(t),isMounted:ge(),mergedValue:K,handleInputFocus:J,handleInputBlur:ee,handleInputUpdateValue:X,handleInputKeyDown:G,handleSelect:N,handleInputMouseDown:te,focus:Q,blur:Z,cssVars:f?void 0:k,themeClass:M==null?void 0:M.themeClass,onRender:M==null?void 0:M.onRender}},render(){const{mergedTheme:t,mergedClsPrefix:l,$slots:T}=this;return b("div",{class:`${l}-mention`},b(Ie,{status:this.mergedStatus,themeOverrides:t.peerOverrides.Input,theme:t.peers.Input,size:this.mergedSize,autosize:this.autosize,type:this.type,ref:"inputInstRef",placeholder:this.placeholder,onMousedown:this.handleInputMouseDown,onUpdateValue:this.handleInputUpdateValue,onKeydown:this.handleInputKeyDown,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,bordered:this.mergedBordered,disabled:this.disabled,value:this.mergedValue}),b(ve,null,{default:()=>[b(me,null,{default:()=>b("div",{style:{position:"absolute",width:0,height:0},ref:"cursorRef"})}),b(be,{ref:"followerRef",placement:this.placement,show:this.showMenu,containerClass:this.namespace,to:this.adjustedTo,teleportDisabled:this.adjustedTo===W.tdkey},{default:()=>b(ye,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{const{mergedTheme:y,onRender:f}=this;return f==null||f(),this.showMenu?b(Se,{clsPrefix:l,theme:y.peers.InternalSelectMenu,themeOverrides:y.peerOverrides.InternalSelectMenu,autoPending:!0,ref:"selectMenuInstRef",class:[`${l}-mention-menu`,this.themeClass],loading:this.loading,treeMate:this.treeMate,virtualScroll:!1,style:this.cssVars,onToggle:this.handleSelect,renderLabel:this.renderLabel},T):null}})})]}))}});export{Ve as N};
