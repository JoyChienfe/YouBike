import{i as H,u as q,r as m,o as n,c as i,b as y,d as s,e as l,l as C,v as M,F as $,m as r,n as A,p as K,L as G,q as N,k as J}from"./index-b1051d8e.js";import{_ as O}from"./OutputExcel-c35b732d.js";import{N as Q}from"./DataTable-b529d137.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const R={class:"container-fluid px-0"},W=l("div",{class:"row mx-0"},[l("h1",{class:"report-h1 fw-bold"},"客服每日來電詢問內容")],-1),X={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Z=l("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1),I={class:"col-md-auto px-0"},ee=l("option",{selected:"",disabled:""},"請選擇",-1),te=l("option",{value:"1.0"},"1.0",-1),ae=l("option",{value:"2.0"},"2.0",-1),se=[ee,te,ae],oe={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},le=l("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:",-1),ne={class:"col-md-auto px-0"},ie=l("option",{selected:"",disabled:""},"請選擇",-1),re={key:0,value:"Newtaipei"},ue={key:1,value:"Taoyuan"},ce={key:2,value:"Miaoli"},de={key:0,value:"Taipei"},me={key:1,value:"Newtaipei"},pe={key:2,value:"Hsinchu"},ve={key:3,value:"Hsinchu_Country"},fe={key:4,value:"Miaoli"},_e={key:5,value:"Taichung"},he={key:6,value:"Chiayi"},ye={key:7,value:"Chiayi_Country"},ge={key:8,value:"Tainan"},De={key:9,value:"Kaohsiung"},be={key:10,value:"Pingtung"},ke={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},xe={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},we={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Ue={__name:"CostumdayContent",setup(Ce){const T=H("ischange"),S=H("$swal"),u=q().citys;async function g(o){S({icon:"error",title:`${o}`,showConfirmButton:!1})}const v=m(),f=m(),D=m(!1),_=m([]),p=m("請選擇"),U=m(null),b=m([]),h=m("請選擇");let k=[],x="",w=[];const V=(o,t,a)=>{k=[],x="",w=[],k=[...o],x=a,t.forEach(e=>{w.push(e.title)})},E=o=>{const t=f.value,a=new Date;if(a.setHours(0,0,0,0),t){const e=new Date(t);e.setHours(0,0,0,0);const c=new Date(e);c.setDate(c.getDate()-30);const d=new Date(o);if(d.setHours(0,0,0,0),d<c||d>e||d>=a)return!0}else{const e=new Date(o);if(e.setHours(0,0,0,0),e>=a)return!0}},Y=o=>{const t=v.value,a=new Date;if(a.setHours(0,0,0,0),t){const e=new Date(t);if(e.setHours(0,0,0,0),e>a)return!0;const c=new Date(e);c.setDate(c.getDate()+30);const d=new Date(o);if(d.setHours(0,0,0,0),d<e||d>c||d>=a)return!0}else{const e=new Date(o);if(e.setHours(0,0,0,0),e>=a)return!0}};function B(o){const t=new Date(o),a=t.getUTCFullYear(),e=String(t.getUTCMonth()+1).padStart(2,"0"),c=String(t.getUTCDate()).padStart(2,"0");return`${a}-${e}-${c}`}const F=o=>{if(!o.length)b.value=[];else{let t=[{key:"item1",align:"center",title:""},{key:"item2",align:"center",title:""}];o.forEach((a,e)=>{t.push({key:`item${e+3}`,align:"center",title:B(a[0].date)})}),p.value==="1.0"?t[0].rowSpan=(a,e)=>{if(e===0)return 5;if(e===5)return 4;if(e===9)return 12;if(e===21)return 3;if(e===24)return 3;if(e===27)return 4;if(e===31)return 4;if(e===35)return 5}:t[0].rowSpan=(a,e)=>{if(e===0)return 3;if(e===3)return 5;if(e===8)return 12;if(e===20)return 3;if(e===23)return 3;if(e===26)return 2;if(e===28)return 5;if(e===33)return 3},b.value=[...t]}},L=o=>{if(!o[0])_.value=[];else{const t=[];o[0].forEach(a=>{t.push({item1:a.category,item2:a.service,item3:a.total})}),o.forEach((a,e)=>{e!==0&&a.forEach((c,d)=>{t[d][`item${e+3}`]=c.total})}),_.value=[...t]}},z=async()=>{const o="https://report.youbike.com.tw/isauth/gcpfun",t={dataset_id:"report",table_id:"CTI_daily_detail",begin_date:v.value,end_date:f.value,city:h.value,sys:p.value};D.value=!0;const e=(await J.get(o,{params:t})).data.data;F([...e]),L([...e]),V(_.value,b.value,"客服每日來電詢問內容"),D.value=!1},P=()=>{if(p.value==="請選擇"){g("請選擇系統別");return}else if(h.value==="請選擇"){g("請選擇城市");return}else if(v.value){if(!f.value)return g("請選擇結束時間")}else return g("請選擇開始時間");z()},j=()=>{v.value=null,f.value=null};return(o,t)=>(n(),i("div",R,[y(s(G),{active:D.value,"onUpdate:active":t[0]||(t[0]=a=>D.value=a),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),W,l("form",{class:A(["row mx-0",{"report-header":!s(T),"report-header-dark":s(T)}])},[l("div",X,[Z,l("div",I,[C(l("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a),onChange:t[2]||(t[2]=a=>h.value="請選擇")},se,544),[[M,p.value]])])]),l("div",oe,[le,l("div",ne,[C(l("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[3]||(t[3]=a=>h.value=a)},[ie,p.value==1?(n(),i($,{key:0},[s(u).includes(3)?(n(),i("option",re,"新北市")):r("",!0),s(u).includes(4)?(n(),i("option",ue,"桃園市")):r("",!0),s(u).includes(7)?(n(),i("option",ce,"苗栗縣")):r("",!0)],64)):p.value=="2.0"?(n(),i($,{key:1},[s(u).includes(2)?(n(),i("option",de,"台北市")):r("",!0),s(u).includes(3)?(n(),i("option",me,"新北市")):r("",!0),s(u).includes(5)?(n(),i("option",pe,"新竹市")):r("",!0),s(u).includes(6)?(n(),i("option",ve," 新竹縣 ")):r("",!0),s(u).includes(7)?(n(),i("option",fe,"苗栗縣")):r("",!0),s(u).includes(8)?(n(),i("option",_e,"台中市")):r("",!0),s(u).includes(12)?(n(),i("option",he,"嘉義市")):r("",!0),s(u).includes(13)?(n(),i("option",ye," 嘉義縣 ")):r("",!0),s(u).includes(14)?(n(),i("option",ge,"台南市")):r("",!0),s(u).includes(15)?(n(),i("option",De,"高雄市")):r("",!0),s(u).includes(16)?(n(),i("option",be,"屏東縣")):r("",!0)],64)):r("",!0)],512),[[M,h.value]])]),l("div",ke,[y(s(N),{class:"px-0","formatted-value":v.value,"onUpdate:formattedValue":t[4]||(t[4]=a=>v.value=a),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":E},null,8,["formatted-value"])]),l("div",xe,[y(s(N),{class:"px-0","formatted-value":f.value,"onUpdate:formattedValue":t[5]||(t[5]=a=>f.value=a),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":Y,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])])]),l("div",we,[l("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:j}," 清空日期 "),l("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:P}," 搜尋 "),y(O,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:s(k),name:s(x),header:s(w)},null,8,["data","name","header"])])],2),C(y(s(Q),{size:"small",data:_.value,ref_key:"dataTable",ref:U,columns:b.value,"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"]),[[K,_.value.length>0]])]))}};export{Ue as default};
