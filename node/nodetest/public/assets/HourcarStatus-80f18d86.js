import{u as j,i as S,r,o as P,c as q,b as d,d as o,e as s,n as A,l as K,p as O,L as G,y as C,q as N,k as I}from"./index-7b4e55c1.js";import{_ as J}from"./OutputExcel-bdbd0611.js";import{N as Q}from"./DataTable-48a84b8a.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const R={class:"container-fluid px-0"},W=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"每小時車輛狀態")],-1),X=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),Z={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},ee=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"時段:")],-1),te={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},ae={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},le={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},se={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},ne={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ve={__name:"HourcarStatus",setup(oe){const n=j().citys,k=S("ischange"),T=S("$swal");async function f(a){T({icon:"error",title:`${a}`,showConfirmButton:!1})}const m=r(),v=r(),b=r(!1),h=r(null),p=r([]);let D=[],x="",w=[];const V=(a,e,t)=>{D=[],x="",w=[],D=[...a],x=t,e.forEach(u=>{w.push(u.title)})},g=r([]);let M=[{label:"台北市",value:"Taipei",disabled:!n.includes(2)},{label:"新北市",value:"Newtaipei",disabled:!n.includes(3)},{label:"桃園市",value:"Taoyuan",disabled:!n.includes(4)},{label:"新竹市",value:"Hsinchu",disabled:!n.includes(5)},{label:"新竹縣",value:"Hsinchu_Country",disabled:!n.includes(6)},{label:"竹科",value:"HsinchuScience",disabled:!n.includes(20)},{label:"苗栗縣",value:"Miaoli",disabled:!n.includes(7)},{label:"台中市",value:"Taichung",disabled:!n.includes(8)},{label:"嘉義市",value:"Chiayi",disabled:!n.includes(12)},{label:"嘉義縣",value:"Chiayi_Country",disabled:!n.includes(13)},{label:"台南市",value:"Tainan",disabled:!n.includes(14)},{label:"高雄市",value:"Kaohsiung",disabled:!n.includes(15)},{label:"屏東縣",value:"Pingtung",disabled:!n.includes(16)}];const y=r([]);function U(){let a=[];for(let e=0;e<24;e++)a.push({label:e,value:e});return a}function z(a){const e=new Date(a),t=e.getFullYear(),u=(e.getMonth()+1).toString().padStart(2,"0"),_=e.getDate().toString().padStart(2,"0");return t+"-"+u+"-"+_}const B=a=>{const e=v.value,t=new Date;if(t.setHours(0,0,0,0),new Date(a).getFullYear()<2024)return!0;if(e){const l=new Date(e);l.setHours(0,0,0,0);const c=new Date(l);c.setDate(c.getDate()-30);const i=new Date(a);if(i.setHours(0,0,0,0),i<c||i>l||i>t)return!0}else{const l=new Date(a);if(l.setHours(0,0,0,0),l>t)return!0}},E=a=>{const e=m.value,t=new Date;if(t.setHours(0,0,0,0),new Date(a).getFullYear()<2024)return!0;if(e){const l=new Date(e);if(l.setHours(0,0,0,0),l>t)return!0;const c=new Date(l);c.setDate(c.getDate()+30);const i=new Date(a);if(i.setHours(0,0,0,0),i<l||i>c||i>t)return!0}else{const l=new Date(a);if(l.setHours(0,0,0,0),l>t)return!0}},$=()=>{m.value=null,v.value=null},H=r([{key:"item1",align:"center",title:"日期"},{key:"item2",align:"center",title:"時段"},{key:"item3",align:"center",title:"縣市"},{key:"item4",align:"center",title:"系統"},{key:"item5",align:"center",title:"在站"},{key:"item6",align:"center",title:"使用"},{key:"item7",align:"center",title:"維修"},{key:"item8",align:"center",title:"調度"},{key:"item9",align:"center",title:"合計"},{key:"item10",align:"center",title:"合約車輛數"},{key:"item11",align:"center",title:"境內車輛數占比"},{key:"item12",align:"center",title:"差異數"}]);function F(a){p.value=[],p.value=a.map(e=>({item1:z(e.date),item2:e.hour,item3:e.city,item4:e.sys,item5:e.in_station,item6:e.use,item7:e.repair,item8:e.dispatch,item9:e.total,item10:e.bike_number,item11:e.percentage,item12:e.different}))}const L=async()=>{const a="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"report",table_id:"bike_checklist_hour_report",begin_date:m.value,end_date:v.value,city:[...g.value],hour:y.value};try{b.value=!0;const t=await I.get(a,{params:e});console.log(t),b.value=!1;const u=t.data.data;F(u),h.value&&h.value.page(1),V(p.value,H.value,"每小時車輛狀態")}catch(t){console.log(t)}},Y=()=>{if(g.value.length===0){f("請選擇城市");return}else if(y.value.length===0){f("請選擇小時");return}else if(m.value){if(!v.value){f("請選擇結束日期");return}}else{f("請選擇開始日期");return}L()};return(a,e)=>(P(),q("div",R,[d(o(G),{active:b.value,"onUpdate:active":e[0]||(e[0]=t=>b.value=t),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),W,s("form",{class:A(["row mx-0",{"report-header":!o(k),"report-header-dark":o(k)}])},[X,s("div",Z,[d(o(C),{class:"px-0",value:g.value,"onUpdate:value":e[1]||(e[1]=t=>g.value=t),placeholder:"請選擇",multiple:"",options:o(M),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),ee,s("div",te,[d(o(C),{class:"px-0",value:y.value,"onUpdate:value":e[2]||(e[2]=t=>y.value=t),placeholder:"請選擇",multiple:"",options:U(),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",ae,[s("div",le,[d(o(N),{class:"px-0","formatted-value":m.value,"onUpdate:formattedValue":e[3]||(e[3]=t=>m.value=t),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,"default-time":"2023-06-20",placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":B},null,8,["formatted-value"])]),s("div",se,[d(o(N),{class:"px-0","formatted-value":v.value,"onUpdate:formattedValue":e[4]||(e[4]=t=>v.value=t),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":E,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])])]),s("div",ne,[s("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:$}," 清空日期 "),s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:Y}," 搜尋 "),d(J,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:o(D),name:o(x),header:o(w)},null,8,["data","name","header"])])],2),K(d(o(Q),{ref_key:"dataTable",ref:h,size:"small",columns:H.value,data:p.value,pagination:{pageSize:13},"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["columns","data"]),[[O,p.value.length>0]])]))}};export{ve as default};
