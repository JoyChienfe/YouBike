import{i as D,u as S,r as c,o as U,c as $,b as r,d as o,e as s,n as L,l as T,p as V,L as F,y as P,q as Y,k as j}from"./index-57300d61.js";import{_ as q}from"./OutputExcel-9882e099.js";import{N as A}from"./DataTable-6cdc6e71.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const R={class:"container-fluid px-0"},G=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"卡片騎乘天數(每月5號更新資料)")],-1),H=s("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:")],-1),I={class:"row col-md-2 align-items-center mx-0"},J={class:"row align-items-center col-md-2 col-12 mt-3 mt-md-0 pe-0"},K={class:"mx-0 mx-md-2 col-md-auto pe-0"},O={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},le={__name:"DaydayReportnext",setup(Q){const g=D("ischange"),l=S().citys,N=D("$swal");async function x(t){N({icon:"error",title:`${t}`,showConfirmButton:!1})}const i=c([]),u=c(!1),d=c([]),_=c(null),m=c(),E=()=>{let t=[];v.forEach(e=>{t.push(e.value)}),i.value=t};let v=[{label:"臺北",value:"1",disabled:!l.includes(2)},{label:"新北",value:"2",disabled:!l.includes(3)},{label:"桃園",value:"3",disabled:!l.includes(4)},{label:"新竹市+竹科",value:"5",disabled:!l.includes(5)},{label:"新竹縣",value:"4",disabled:!l.includes(6)},{label:"苗栗",value:"6",disabled:!l.includes(7)},{label:"臺中",value:"7",disabled:!l.includes(8)},{label:"嘉義",value:"9",disabled:!(l.includes(12)||l.includes(13))},{label:"台南",value:"11",disabled:!l.includes(14)},{label:"高雄",value:"10",disabled:!l.includes(15)},{label:"屏東",value:"12",disabled:!l.includes(16)}];(function(){let e=[];v.forEach(a=>{a.disabled||e.push(a)}),v=[...e]})();const C=t=>{const e=new Date(t),a=e.getFullYear(),n=e.getMonth()+1,h=new Date,y=h.getFullYear(),k=h.getMonth()+1;return a<2022||a>y||a===y&&n>=k||a===y&&n===k&&h.getDate()<2};let p=[],b="",f=[];const z=(t,e,a)=>{p=[],b="",f=[],p=[...t],b=a,e.forEach(n=>{f.push(n.title)})},w=c([{key:"city",align:"center",fixed:"left",title:"城市"},{key:"month",align:"center",title:"月份"},{key:"rideday",align:"center",title:"騎乘天數"},{key:"cardnum",align:"center",title:"卡片數量"}]),B=async()=>{try{u.value=!0,d.value=[];const t="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"data_analysis",table_id:"tan_tan_2",city:i.value,date:m.value},a=await j.get(t,{params:e});u.value=!1,_.value.page(1),a.data.data.forEach(n=>{d.value.push({city:n.city,month:n.date,rideday:n.times,cardnum:n.card_number})}),z(d.value,w.value,"卡片騎乘天數")}catch(t){console.log(t)}},M=()=>{if(i.value.length<=0)return x("請選擇城市");if(!m.value)return x("請選擇日期");B()};return(t,e)=>(U(),$("div",R,[r(o(F),{active:u.value,"onUpdate:active":e[0]||(e[0]=a=>u.value=a),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),G,s("form",{class:L(["row mx-0",{"report-header":!o(g),"report-header-dark":o(g)}])},[H,s("div",I,[r(o(P),{class:"px-0",value:i.value,"onUpdate:value":e[1]||(e[1]=a=>i.value=a),placeholder:"請選擇",multiple:"",options:o(v),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-2 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:E}," 城市全選 ")]),s("div",J,[s("div",K,[r(o(Y),{class:"px-0","formatted-value":m.value,"onUpdate:formattedValue":e[2]||(e[2]=a=>m.value=a),type:"month",actions:null,"update-value-on-close":"","is-date-disabled":C,"value-format":"yyyy-MM"},null,8,["formatted-value"])])]),s("div",O,[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:M}," 搜尋 "),r(q,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:o(p),name:o(b),header:o(f)},null,8,["data","name","header"])])],2),T(r(o(A),{ref_key:"dataTable",ref:_,size:"small",columns:w.value,data:d.value,pagination:{pageSize:17},"max-height":600,"scroll-x":400,bordered:!1,"single-line":!1,striped:""},null,8,["columns","data"]),[[V,d.value.length>0]])]))}};export{le as default};
