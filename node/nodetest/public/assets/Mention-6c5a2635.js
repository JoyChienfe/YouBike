import{b5 as ne,b6 as oe,b7 as ie,b8 as ae,b9 as re,I as se,G as N,aX as le,K as ue,M as de,O as _,aB as ce,r as I,T as U,Y as fe,am as he,a1 as pe,av as W,ba as ge,Q as b,bb as ve,bc as me,bd as be,a2 as ye,a9 as Se,f as we,a5 as xe,ac as $,ad as Ie,ab as z}from"./index-1377d8f9.js";const Te=t=>{const{boxShadow2:s}=t;return{menuBoxShadow:s}},Me=ne({name:"Mention",common:oe,peers:{InternalSelectMenu:ie,Input:ae},self:Te}),Re=Me;function Ce(t,s={debug:!1,useSelectionEnd:!1,checkWidthOverflow:!0}){const T=t.selectionStart!==null?t.selectionStart:0,y=t.selectionEnd!==null?t.selectionEnd:0,f=s.useSelectionEnd?y:T,P=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],S=navigator.userAgent.toLowerCase().includes("firefox");if(!re)throw new Error("textarea-caret-position#getCaretPosition should only be called in a browser");const d=s==null?void 0:s.debug;if(d){const c=document.querySelector("#input-textarea-caret-position-mirror-div");c!=null&&c.parentNode&&c.parentNode.removeChild(c)}const u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);const a=u.style,i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,h=t.nodeName==="INPUT";a.whiteSpace=h?"nowrap":"pre-wrap",h||(a.wordWrap="break-word"),a.position="absolute",d||(a.visibility="hidden"),P.forEach(c=>{if(h&&c==="lineHeight")if(i.boxSizing==="border-box"){const C=parseInt(i.height),B=parseInt(i.paddingTop)+parseInt(i.paddingBottom)+parseInt(i.borderTopWidth)+parseInt(i.borderBottomWidth),w=B+parseInt(i.lineHeight);C>w?a.lineHeight=`${C-B}px`:C===w?a.lineHeight=i.lineHeight:a.lineHeight="0"}else a.lineHeight=i.height;else a[c]=i[c]}),S?t.scrollHeight>parseInt(i.height)&&(a.overflowY="scroll"):a.overflow="hidden",u.textContent=t.value.substring(0,f),h&&u.textContent&&(u.textContent=u.textContent.replace(/\s/g,"Â "));const r=document.createElement("span");r.textContent=t.value.substring(f)||".",r.style.position="relative",r.style.left=`${-t.scrollLeft}px`,r.style.top=`${-t.scrollTop}px`,u.appendChild(r);const v={top:r.offsetTop+parseInt(i.borderTopWidth),left:r.offsetLeft+parseInt(i.borderLeftWidth),absolute:!1,height:parseInt(i.fontSize)*1.5};return d?r.style.backgroundColor="#aaa":document.body.removeChild(u),v.left>=t.clientWidth&&s.checkWidthOverflow&&(v.left=t.clientWidth),v}const Be=se([N("mention","width: 100%; z-index: auto; position: relative;"),N("mention-menu",`
 box-shadow: var(--n-menu-box-shadow);
 `,[le({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),Ee=Object.assign(Object.assign({},_.props),{to:W.propTo,autosize:[Boolean,Object],options:{type:Array,default:[]},type:{type:String,default:"text"},separator:{type:String,validator:t=>t.length!==1?(xe("mention","`separator`'s length must be 1."),!1):!0,default:" "},bordered:{type:Boolean,default:void 0},disabled:Boolean,value:String,defaultValue:{type:String,default:""},loading:Boolean,prefix:{type:[String,Array],default:"@"},placeholder:{type:String,default:""},placement:{type:String,default:"bottom-start"},size:String,renderLabel:Function,status:String,"onUpdate:show":[Array,Function],onUpdateShow:[Array,Function],"onUpdate:value":[Array,Function],onUpdateValue:[Array,Function],onSearch:Function,onSelect:Function,onFocus:Function,onBlur:Function,internalDebug:Boolean}),Pe=ue({name:"Mention",props:Ee,setup(t){const{namespaceRef:s,mergedClsPrefixRef:T,mergedBorderedRef:y,inlineThemeDisabled:f}=de(t),P=_("Mention","-mention",Be,Re,t,T),S=ce(t),d=I(null),u=I(null),a=I(null),i=I("");let h=null,r=null,v=null;const c=U(()=>{const{value:e}=i;return t.options.filter(n=>e?typeof n.label=="string"?n.label.startsWith(e):typeof n.value=="string"?n.value.startsWith(e):!1:!0)}),C=U(()=>Ie(c.value,{getKey:e=>e.value})),B=I(null),w=I(!1),L=I(t.defaultValue),j=fe(t,"value"),K=he(j,L),k=U(()=>{const{self:{menuBoxShadow:e}}=P.value;return{"--n-menu-box-shadow":e}}),M=f?pe("mention",void 0,k,t):void 0;function x(e){if(t.disabled)return;const{onUpdateShow:n,"onUpdate:show":o}=t;n&&z(n,e),o&&z(o,e),e||(h=null,r=null,v=null),w.value=e}function H(e){const{onUpdateValue:n,"onUpdate:value":o}=t,{nTriggerFormChange:l,nTriggerFormInput:p}=S;o&&z(o,e),n&&z(n,e),p(),l(),L.value=e}function A(){return t.type==="text"?d.value.inputElRef:d.value.textareaElRef}function O(){var e;const n=A();if(document.activeElement!==n){x(!1);return}const{selectionEnd:o}=n;if(o===null){x(!1);return}const l=n.value,{separator:p}=t,{prefix:R}=t,V=typeof R=="string"?[R]:R;for(let m=o-1;m>=0;--m){const g=l[m];if(g===p||g===`
`||g==="\r"){x(!1);return}if(V.includes(g)){const F=l.slice(m+1,o);x(!0),(e=t.onSearch)===null||e===void 0||e.call(t,F,g),i.value=F,h=g,r=m+1,v=o;return}}x(!1)}function Y(){const{value:e}=u;if(!e)return;const n=A(),o=Ce(n);o.left+=n.parentElement.offsetLeft,e.style.left=`${o.left}px`,e.style.top=`${o.top+o.height}px`}function X(){var e;w.value&&((e=a.value)===null||e===void 0||e.syncPosition())}function q(e){H(e),E()}function E(){setTimeout(()=>{Y(),O(),$().then(X)},0)}function G(e){var n,o;if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!((n=d.value)===null||n===void 0)&&n.isCompositing)return;E()}else if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Enter"){if(!((o=d.value)===null||o===void 0)&&o.isCompositing)return;const{value:l}=B;if(w.value){if(l)if(e.preventDefault(),e.key==="ArrowUp")l.prev();else if(e.key==="ArrowDown")l.next();else{const p=l.getPendingTmNode();p?D(p):x(!1)}}else E()}}function Q(e){const{onFocus:n}=t;n==null||n(e);const{nTriggerFormFocus:o}=S;o(),E()}function J(){var e;(e=d.value)===null||e===void 0||e.focus()}function Z(){var e;(e=d.value)===null||e===void 0||e.blur()}function ee(e){const{onBlur:n}=t;n==null||n(e);const{nTriggerFormBlur:o}=S;o(),x(!1)}function D(e){var n;if(h===null||r===null||v===null)return;const{rawNode:{value:o=""}}=e,l=A(),p=l.value,{separator:R}=t,V=p.slice(v),m=V.startsWith(R),g=`${o}${m?"":R}`;H(p.slice(0,r)+g+V),(n=t.onSelect)===null||n===void 0||n.call(t,e.rawNode,h);const F=r+g.length+(m?1:0);$().then(()=>{l.selectionStart=F,l.selectionEnd=F,O()})}function te(){t.disabled||E()}return{namespace:s,mergedClsPrefix:T,mergedBordered:y,mergedSize:S.mergedSizeRef,mergedStatus:S.mergedStatusRef,mergedTheme:P,treeMate:C,selectMenuInstRef:B,inputInstRef:d,cursorRef:u,followerRef:a,showMenu:w,adjustedTo:W(t),isMounted:ge(),mergedValue:K,handleInputFocus:Q,handleInputBlur:ee,handleInputUpdateValue:q,handleInputKeyDown:G,handleSelect:D,handleInputMouseDown:te,focus:J,blur:Z,cssVars:f?void 0:k,themeClass:M==null?void 0:M.themeClass,onRender:M==null?void 0:M.onRender}},render(){const{mergedTheme:t,mergedClsPrefix:s,$slots:T}=this;return b("div",{class:`${s}-mention`},b(we,{status:this.mergedStatus,themeOverrides:t.peerOverrides.Input,theme:t.peers.Input,size:this.mergedSize,autosize:this.autosize,type:this.type,ref:"inputInstRef",placeholder:this.placeholder,onMousedown:this.handleInputMouseDown,onUpdateValue:this.handleInputUpdateValue,onKeydown:this.handleInputKeyDown,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,bordered:this.mergedBordered,disabled:this.disabled,value:this.mergedValue}),b(ve,null,{default:()=>[b(me,null,{default:()=>b("div",{style:{position:"absolute",width:0,height:0},ref:"cursorRef"})}),b(be,{ref:"followerRef",placement:this.placement,show:this.showMenu,containerClass:this.namespace,to:this.adjustedTo,teleportDisabled:this.adjustedTo===W.tdkey},{default:()=>b(ye,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{const{mergedTheme:y,onRender:f}=this;return f==null||f(),this.showMenu?b(Se,{clsPrefix:s,theme:y.peers.InternalSelectMenu,themeOverrides:y.peerOverrides.InternalSelectMenu,autoPending:!0,ref:"selectMenuInstRef",class:[`${s}-mention-menu`,this.themeClass],loading:this.loading,treeMate:this.treeMate,virtualScroll:!1,style:this.cssVars,onToggle:this.handleSelect,renderLabel:this.renderLabel},T):null}})})]}))}});export{Pe as N};
