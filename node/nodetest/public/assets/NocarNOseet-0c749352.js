import{i as R,r as d,u as me,o as E,c as H,b as p,d as v,e as o,l as L,v as W,F as j,m as ve,n as pe,L as fe,y as X,q as M,B as ye,k as ge}from"./index-e8db8460.js";import{u as N,w as be}from"./xlsx-bd534488.js";import{N as he}from"./Result-73181e64.js";import"./Warning-f4ecdd88.js";const _e={class:"container-fluid px-0"},we=o("div",{class:"row mx-0"},[o("h1",{class:"report-h1 fw-bold"},"無車無位統計")],-1),De={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},xe=o("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"類別:",-1),ke={class:"col-md-auto px-0"},Me=o("option",{selected:"",disabled:""},"請選擇",-1),Ve=o("option",{value:"day_empty_full"},"日報",-1),Fe=o("option",{value:"weekly_empty_full"},"週報",-1),Ye=o("option",{value:"monthly_empty_full"},"月報",-1),Ue=[Me,Ve,Fe,Ye],$e={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Ce=o("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1),Ee={class:"col-md-auto px-0"},He=o("option",{selected:"",disabled:""},"請選擇",-1),Ne=o("option",{value:"1.0"},"1.0",-1),Se=o("option",{value:"2.0"},"2.0+2.0E",-1),Be=[He,Ne,Se],Oe=o("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[o("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),Le={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},We={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},je=o("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"項目:",-1),ze={class:"col-md-auto px-0"},Ae=ye('<option selected disabled>請選擇</option><option value="無車5分鐘">無車5分鐘</option><option value="無車10分鐘">無車10分鐘</option><option value="無車20分鐘">無車20分鐘</option><option value="無車30分鐘">無車30分鐘</option><option value="無位5分鐘">無位5分鐘</option><option value="無位10分鐘">無位10分鐘</option><option value="無位20分鐘">無位20分鐘</option><option value="無位30分鐘">無位30分鐘</option>',9),Te=[Ae],qe=o("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[o("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"狀態:")],-1),Pe={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},Re={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Xe={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Ge={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Ie={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Je={class:"row mx-0 mx-md-2 align-items-center col-md-auto"},Ke={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Qe={class:"row mx-0 mx-md-2 align-items-center col-md-auto"},st={__name:"NocarNOseet",setup(Ze){const G=R("$swal");async function m(s){G({icon:"error",title:`${s}`,showConfirmButton:!1})}const z=R("ischange"),F=d(!1),A=d([]),w=d("請選擇"),c=d("請選擇"),Y=d("請選擇"),I=d([{key:"item1",align:"center",fixed:"left",title:"date",width:100},{key:"item2",align:"center",title:"責任區",width:60},{key:"item3",align:"center",title:"場站代號"},{key:"item4",align:"center",title:"站名",width:250},{key:"item5",align:"center",title:"狀態",width:60},{key:"item6",align:"center",title:"項目",width:70},{key:"item7",align:"center",title:"0"},{key:"item8",align:"center",title:"1"},{key:"item9",align:"center",title:"2"},{key:"item10",align:"center",title:"3"},{key:"item11",align:"center",title:"4"},{key:"item12",align:"center",title:"5"},{key:"item13",align:"center",title:"6"},{key:"item14",align:"center",title:"7"},{key:"item15",align:"center",title:"8"},{key:"item16",align:"center",title:"9"},{key:"item17",align:"center",title:"10"},{key:"item18",align:"center",title:"11"},{key:"item19",align:"center",title:"12"},{key:"item20",align:"center",title:"13"},{key:"item21",align:"center",title:"14"},{key:"item22",align:"center",title:"15"},{key:"item23",align:"center",title:"16"},{key:"item24",align:"center",title:"17"},{key:"item25",align:"center",title:"18"},{key:"item26",align:"center",title:"19"},{key:"item27",align:"center",title:"20"},{key:"item28",align:"center",title:"21"},{key:"item29",align:"center",title:"22"},{key:"item30",align:"center",title:"23"},{key:"item31",align:"center",title:"總計",width:50}]);let U=[],S="",B=[];const J=(s,e,t)=>{if(U=[],B=[],S="",U=[...s],S=t,e.forEach(a=>{B.push(a.title)}),U.length){const a=N.book_new(),n=N.json_to_sheet(U);N.book_append_sheet(a,n,"sheet1"),N.sheet_add_aoa(n,[B],{origin:"A1"}),be(a,`${S}.xlsx`)}else return m("空資料不能匯出")},D=d([]),u=me().citys,$=d([]),K=()=>{D.value=[],w.value==="1.0"?$.value=[{label:"新北市",value:"新北市",disabled:!u.includes(3)},{label:"桃園市",value:"桃園市",disabled:!u.includes(4)},{label:"苗栗縣",value:"苗栗縣",disabled:!u.includes(7)}]:w.value==="2.0"&&($.value=[{label:"台北市",value:"台北市",disabled:!u.includes(2)},{label:"新北市",value:"新北市",disabled:!u.includes(3)},{label:"桃園市",value:"桃園市",disabled:!u.includes(4)},{label:"新竹市",value:"新竹市",disabled:!u.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!u.includes(6)},{label:"竹科",value:"竹科",disabled:!u.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!u.includes(7)},{label:"台中市",value:"台中市",disabled:!u.includes(8)},{label:"嘉義市",value:"嘉義市",disabled:!u.includes(12)},{label:"台南市",value:"台南市",disabled:!u.includes(14)},{label:"高雄市",value:"高雄市",disabled:!u.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!u.includes(16)}])},Q=()=>{let s=[];$.value.forEach(e=>{e.disabled||s.push(e.value)}),D.value=s},Z=()=>{T(),q(),P()},x=d(),k=d(),T=()=>{x.value=null,k.value=null},ee=s=>{const e=k.value,t=new Date;if(t.setHours(0,0,0,0),e){const a=new Date(e);a.setHours(0,0,0,0);const n=new Date(a);n.setDate(n.getDate()-30);const i=new Date(s);if(i.setHours(0,0,0,0),i<n||i>a||i>=t)return!0}else{const a=new Date(s);if(a.setHours(0,0,0,0),a>=t)return!0}},te=s=>{const e=x.value,t=new Date;if(t.setHours(0,0,0,0),e){const a=new Date(e);if(a.setHours(0,0,0,0),a>t)return!0;const n=new Date(a);n.setDate(n.getDate()+30);const i=new Date(s);if(i.setHours(0,0,0,0),i<a||i>n||i>=t)return!0}else{const a=new Date(s);if(a.setHours(0,0,0,0),a>=t)return!0}},y=d(null),g=d(null),q=()=>{g.value=null,y.value=null},ae=s=>{const e=new Date(s),t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(a);n.setDate(a.getDate()-(a.getDay()||7)+1);const i=e.getDay();if(e>=n||i!==1||e.getFullYear()<2023)return!0;const l=new Date(g.value),r=new Date(l);return r.setDate(l.getDate()-27),!!(e<r||g.value&&e>=l)},le=s=>{const e=new Date(s);e.setHours(0,0,0,0);const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(a);n.setDate(a.getDate()-(a.getDay()||7)+1);const i=e.getDay();if(e>=n||i!==1||e.getFullYear()<2023)return!0;const l=new Date(y.value);l.setHours(0,0,0,0);const r=new Date(l);return r.setDate(l.getDate()+27),!!(y.value&&e>r||e.getTime()<l.getTime())},b=d(),h=d(),P=()=>{h.value=null,b.value=null},oe=s=>{const e=new Date(s),t=e.getFullYear(),a=e.getMonth()+1,n=new Date,i=n.getFullYear(),f=n.getMonth()+1,l=h.value;let r,_;if(l!==null){const V=new Date(l);r=V.getFullYear(),_=V.getMonth()+1}const O=(r-t)*12+(_-a);return t<2023||t>i||t===i&&a>=f||r!==void 0&&(t>r||t===r&&a>_)||O>=12},se=s=>{const e=new Date(s),t=e.getFullYear(),a=e.getMonth()+1,n=new Date,i=n.getFullYear(),f=n.getMonth()+1,l=b.value;let r,_;if(l!==null){const V=new Date(l);r=V.getFullYear(),_=V.getMonth()+1}const O=(t-r)*12+(a-_);return t<2023||t>i||t===i&&a>=f||r!==void 0&&(t<r||t===r&&a<_)||O>=12},ne=s=>{const e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=a<10?`0${a}`:a;`${t}-${n}`!==s&&(b.value=s)},ie=s=>{const e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=a<10?`0${a}`:a;`${t}-${n}`!==s&&(h.value=s)};function re(s){var e=new Date(s),t=e.getFullYear(),a=("0"+(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2),i=t+"-"+a+"-"+n;return i}const ue=async()=>{try{let s=null,e=null;c.value==="day_empty_full"?(s=x.value,e=k.value):c.value==="weekly_empty_full"?(s=y.value,e=g.value):c.value==="monthly_empty_full"&&(s=`${b.value}-01`,e=`${h.value}-01`),F.value=!0;const t="https://report.youbike.com.tw/isauth/gcpfun",a={dataset_id:"data_analysis",table_id:c.value,begin_date:s,end_date:e,city:D.value,item:Y.value,status:C.value,sys:w.value},i=(await ge.get(t,{params:a})).data.data;console.log(i);let f=[];i.forEach(l=>{let r=[];r={item1:re(l.date),item2:l.responsible_area,item3:l.s_no,item4:l.s_name,item5:l.status,item6:l.item,item7:l.r0,item8:l.r1,item9:l.r2,item10:l.r3,item11:l.r4,item12:l.r5,item13:l.r6,item14:l.r7,item15:l.r8,item16:l.r9,item17:l.r10,item18:l.r11,item19:l.r12,item20:l.r13,item21:l.r14,item22:l.r15,item23:l.r16,item24:l.r17,item25:l.r18,item26:l.r19,item27:l.r20,item28:l.r21,item29:l.r22,item30:l.r23,item31:l.total},f.push({...r})}),A.value=[...f],J(A.value,I.value,"無車無位統計"),F.value=!1}catch(s){console.log(s)}},C=d([]),de=[{label:"分鐘",value:"分鐘"},{label:"次數",value:"次數"}],ce=()=>{if(c.value==="請選擇")return m("請選擇類別");if(w.value==="請選擇")return m("請選擇系統別");if(D.value.length===0)return m("請選擇城市");if(Y.value==="請選擇")return m("請選擇項目");if(C.value.length===0)return m("請選擇狀態");if(c.value==="day_empty_full")if(x.value){if(!k.value)return m("請選擇結束日期")}else return m("請選擇開始日期");else if(c.value==="weekly_empty_full")if(y.value){if(!g.value)return m("請選擇結束日期")}else return m("請選擇開始日期");else if(c.value==="monthly_empty_full")if(b.value){if(!h.value)return m("請選擇結束日期")}else return m("請選擇開始日期");ue()};return(s,e)=>(E(),H("div",_e,[p(v(fe),{active:F.value,"onUpdate:active":e[0]||(e[0]=t=>F.value=t),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),we,o("form",{class:pe(["row mx-0",{"report-header":!v(z),"report-header-dark":v(z)}])},[o("div",De,[xe,o("div",ke,[L(o("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),onChange:Z},Ue,544),[[W,c.value]])])]),o("div",$e,[Ce,o("div",Ee,[L(o("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),onChange:K},Be,544),[[W,w.value]])])]),Oe,o("div",Le,[p(v(X),{class:"px-0",value:D.value,"onUpdate:value":e[3]||(e[3]=t=>D.value=t),placeholder:"請選擇",multiple:"",options:$.value,"max-tag-count":1,size:"medium"},null,8,["value","options"])]),o("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:Q}," 城市全選 ")]),o("div",We,[je,o("div",ze,[L(o("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[4]||(e[4]=t=>Y.value=t)},Te,512),[[W,Y.value]])])]),qe,o("div",Pe,[p(v(X),{class:"px-0",value:C.value,"onUpdate:value":e[5]||(e[5]=t=>C.value=t),placeholder:"請選擇",multiple:"",options:de,"max-tag-count":1,size:"medium"},null,8,["value"])]),c.value==="day_empty_full"?(E(),H(j,{key:0},[o("div",Re,[p(v(M),{class:"px-0","formatted-value":x.value,"onUpdate:formattedValue":e[6]||(e[6]=t=>x.value=t),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd",clearable:"","is-date-disabled":ee},null,8,["formatted-value"])]),o("div",Xe,[p(v(M),{class:"px-0","formatted-value":k.value,"onUpdate:formattedValue":e[7]||(e[7]=t=>k.value=t),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":te,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd",clearable:""},null,8,["formatted-value"])]),o("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:T}," 清空日期 ")],64)):c.value==="weekly_empty_full"?(E(),H(j,{key:1},[o("div",Ge,[p(v(M),{class:"px-0","formatted-value":y.value,"onUpdate:formattedValue":e[8]||(e[8]=t=>y.value=t),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":ae,clearable:""},null,8,["formatted-value"])]),o("div",Ie,[p(v(M),{class:"px-0","formatted-value":g.value,"onUpdate:formattedValue":e[9]||(e[9]=t=>g.value=t),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":le,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])]),o("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:q}," 清空日期 ")],64)):c.value==="monthly_empty_full"?(E(),H(j,{key:2},[o("div",Je,[p(v(M),{class:"px-0","input-readonly":!0,"formatted-value":b.value,"onUpdate:formattedValue":e[10]||(e[10]=t=>b.value=t),type:"month",actions:null,"update-value-on-close":"",placeholder:"開始月份","is-date-disabled":oe,"value-format":"yyyy-MM","on-update:formatted-value":ne},null,8,["formatted-value"])]),o("div",Ke,[o("div",Qe,[p(v(M),{class:"px-0","input-readonly":!0,"formatted-value":h.value,"onUpdate:formattedValue":e[11]||(e[11]=t=>h.value=t),type:"month",actions:null,"update-value-on-close":"",placeholder:"結束月份","is-date-disabled":se,"value-format":"yyyy-MM","on-update:formatted-value":ie},null,8,["formatted-value"])])]),o("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:P}," 清空月份 ")],64)):ve("",!0),o("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[o("button",{type:"button",class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:ce}," 搜尋匯出 ")])],2),p(v(he),{class:"mt-5",status:"info",title:"此頁面只供下載EXCEL"})]))}};export{st as default};
