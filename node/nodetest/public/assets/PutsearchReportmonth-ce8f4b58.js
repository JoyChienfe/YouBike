import{i as M,r as u,u as H,o as O,c as P,b as v,d as r,e as o,k as R,v as Y,n as q,m as J,t as D,j as K}from"./index-3459458a.js";import{L as Q}from"./index-fcaa1a70.js";import{_ as W}from"./OutputExcel-14eb8bfa.js";import{N as X}from"./DataTable-83b67cc2.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";import"./Input-c173e393.js";import"./Forward-c5c87e0a.js";const Z={class:"container-fluid px-0"},ee=o("div",{class:"row mx-0"},[o("h1",{class:"report-h1 fw-bold"},"投保率分析月報")],-1),te={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},le=o("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"類別:",-1),ae={class:"col-md-auto px-0"},oe=o("option",{selected:"",disabled:""},"請選擇",-1),ne=o("option",{value:"monthly_report_ride_INSUR"},"騎乘投保率(月)",-1),ie=o("option",{value:"monthly_report_INSUR"},"保險加保統計",-1),se=o("option",{value:"monthly_report_MEBER"},"實名會員統計",-1),re=[oe,ne,ie,se],ce=o("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[o("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),me={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},de=o("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[o("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"日期:")],-1),ue={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},pe={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Se={__name:"PutsearchReportmonth",setup(_e){const U=M("ischange"),I=M("$swal");async function f(t){I({icon:"error",title:`${t}`,showConfirmButton:!1})}const h=u(!1),y=u(),n=H().citys,m=u("請選擇"),c=u([]),p=u([]),d=u([]),_=u([]);let x=[],k="",w=[];const S=(t,l,a)=>{x=[],k="",w=[],x=[...t],k=a,l.forEach(i=>{w.push(i.title)})};function $(){const t=new Date("2018-01-01"),l=new Date,a=[];let i=new Date(t);for(;i<l;){const s=i.getFullYear(),e=String(i.getMonth()+1).padStart(2,"0"),j=`${s}-${e}`,G=`${s}-${e}`;a.push({label:j,value:G}),i.setMonth(i.getMonth()+1)}if(a.length>0){const s=a[a.length-1].value,e=l.getFullYear()+"-"+String(l.getMonth()+1).padStart(2,"0");s===e&&a.reverse()}return a}let b=[{label:"全公司",value:"全公司"},{label:"台北市",value:"台北市",disabled:!n.includes(2)},{label:"新北市",value:"新北市",disabled:!n.includes(3)},{label:"桃園市",value:"桃園市",disabled:!n.includes(4)},{label:"新竹市+竹科",value:"新竹市+竹科",disabled:!n.includes(5)||!n.includes(20)},{label:"新竹市",value:"新竹市",disabled:!n.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!n.includes(6)},{label:"竹科",value:"竹科",disabled:!n.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!n.includes(7)},{label:"台中市",value:"台中市",disabled:!n.includes(8)},{label:"彰化縣",value:"彰化縣",disabled:!n.includes(9)},{label:"嘉義市",value:"嘉義市",disabled:!n.includes(12)},{label:"台南市",value:"台南市",disabled:!n.includes(14)},{label:"高雄市",value:"高雄市",disabled:!n.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!n.includes(16)}],N=[];(function(){let l=[];b.forEach(i=>{i.disabled||l.push(i)}),b=[...l];const a=$();a.shift(),N=[...a]})();const B=()=>{let t=[];b.forEach(l=>{t.push(l.value)}),p.value=t},C=()=>{let t=[];N.forEach(l=>{t.push(l.value)}),_.value=[...t]},F=[{key:"item1",align:"center",fixed:"left",title:"月份"},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"總會員卡數(A)"},{key:"item4",align:"center",title:"總騎乘次數(B)"},{key:"item5",align:"center",title:"有使用紀錄會員卡數(C)"},{key:"item6",align:"center",title:"註冊地卡數"},{key:"item7",align:"center",title:"非註冊地卡數"},{key:"item8",align:"center",title:"有使用記錄卡片占比(D=C/A)"},{key:"item9",align:"center",title:"有使用記錄卡片加保張數(E)"},{key:"item10",align:"center",title:"保險涵蓋率_卡片數(F=E/C)"},{key:"item11",align:"center",title:"有加保卡片的騎乘次數(G)"},{key:"item12",align:"center",title:"保險涵蓋率_使用次數(H=G/B)"}],A=[{key:"item1",align:"center",fixed:"left",title:"月份"},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"總加保數"},{key:"item4",align:"center",title:"總退保數"},{key:"item5",align:"center",title:"累積有效加保數"},{key:"item6",align:"center",title:"累積總會員卡片術"},{key:"item7",align:"center",title:"總會員加保率"}],z=[{key:"item1",align:"center",fixed:"left",title:"月份"},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"總會員數"},{key:"item4",align:"center",title:"實名會員數"},{key:"item5",align:"center",title:"非實名會員數"},{key:"item6",align:"center",title:"總會員卡片數"},{key:"item7",align:"center",title:"實名會員卡片數"},{key:"item8",align:"center",title:"非實名會員卡片數"}];function T(t){return t.map(l=>l.replace(/-/g,""))}function E(t){if(typeof t!="number")throw new Error("Input must be a number.");const l=Math.floor(t/100),a=t%100;return`${l}年${a.toString().padStart(2,"0")}月`}function g(t){return typeof t!="number"||Number.isNaN(t)||!Number.isFinite(t)||Number.isInteger(t)?t:(t*100).toFixed(1)+"%"}const L=async()=>{try{const t="https://report.youbike.com.tw/isauth/gcpfun",l={dataset_id:"report",table_id:m.value,date:T(_.value),city:p.value};h.value=!0;const a=await K.get(t,{params:l});h.value=!1;const i=a.data.data;let s=[];m.value==="monthly_report_ride_INSUR"?(i.forEach(e=>{s.push({item1:E(e.date),item2:e.city,item3:e.total_card,item4:e.ride_times,item5:e.ride_card,item6:e.ride_card_incity,item7:e.ride_card_nocity,item8:g(e.active_per),item9:e.ride_card_INSUR,item10:g(e.ride_card_INSUR_per),item11:e.ride_times_INSUR,item12:g(e.ride_times_INSUR_per)})}),d.value=[...F],c.value=[...s],S(c.value,d.value,"騎乘投保率(月)")):m.value==="monthly_report_INSUR"?(i.forEach(e=>{s.push({item1:E(e.date),item2:e.city,item3:e.total_add,item4:e.total_minus,item5:e.total_card_name,item6:e.total_card,item7:g(e.INSUR_rate)})}),d.value=[...A],c.value=[...s],S(c.value,d.value,"保險加保統計")):m.value==="monthly_report_MEBER"&&(i.forEach(e=>{s.push({item1:E(e.date),item2:e.city,item3:e.total_meber,item4:e.total_meber_name,item5:e.total_meber_no_name,item6:e.total_card,item7:e.total_card_name,item8:e.total_card_no_name})}),d.value=[...z],c.value=[...s],S(c.value,d.value,"實名會員統計")),y.value.page&&y.value.page(1)}catch(t){console.log(t)}},V=()=>{if(m.value==="請選擇")return f("請選擇系統別");if(p.value.length<=0)return f("請選擇城市");if(_.value.length<=0)return f("請選擇日期");L()};return(t,l)=>(O(),P("div",Z,[v(r(Q),{active:h.value,"onUpdate:active":l[0]||(l[0]=a=>h.value=a),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),ee,o("form",{class:q(["row mx-0",{"report-header":!r(U),"report-header-dark":r(U)}])},[o("div",te,[le,o("div",ae,[R(o("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":l[1]||(l[1]=a=>m.value=a)},re,512),[[Y,m.value]])])]),ce,o("div",me,[v(r(D),{value:p.value,"onUpdate:value":l[2]||(l[2]=a=>p.value=a),placeholder:"請選擇",multiple:"",options:r(b),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),o("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:B}," 城市全選 ")]),de,o("div",ue,[v(r(D),{value:_.value,"onUpdate:value":l[3]||(l[3]=a=>_.value=a),placeholder:"請選擇",multiple:"",options:r(N),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),o("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:C}," 日期全選 ")]),o("div",pe,[o("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:V}," 搜尋 "),v(W,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:r(x),name:r(k),header:r(w)},null,8,["data","name","header"])])],2),R(v(r(X),{ref_key:"dataTable",ref:y,data:c.value,columns:d.value,pagination:{pageSize:17},"max-height":600,"scroll-x":1e3,bordered:!1,size:"small","single-line":!1,striped:""},null,8,["data","columns"]),[[J,c.value.length>0]])]))}};export{Se as default};
