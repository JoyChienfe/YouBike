import{i as k,r as c,o as _,x as $,w as d,b as f,d as u,e as o,f as E,h as D,j as L,bh as z,k as B,u as S,z as T,P as F,c as N,F as I,b3 as R,bS as Y,bT as j}from"./index-c3eef9e5.js";import{a as A,N as U}from"./FormItem-229c4f60.js";const P={class:"fw-bold"},q={class:"row"},O={class:"col-12"},W={class:"row"},G={class:"col text-center"},H={__name:"SendComponent2",props:{maildata:{type:Array},city:{type:String}},setup(g){const p=g,b=k("$swal");async function l(t){b({icon:"success",title:`${t}`,showConfirmButton:!1})}const s=c({textareaValue:null}),a={textareaValue:{required:!0,validator(t,e){let n=!0,r=null;return e.split(`
`).forEach((x,C)=>{(x.charAt(x.length-1)!==","||x.indexOf("@")===-1)&&(r=C,n=!1)}),!n&&e?new Error(`第${r+1}行格式錯誤`):!0},trigger:["blur","input"]}};function v(){const r=s.value.textareaValue.split(`
`).map(V=>V.trim()).join(`
`);s.value.textareaValue=r}function y(t){let e="";return t.forEach((n,r)=>{r===t.length-1?e+=`${n.mail},`:e+=`${n.mail},
`}),e===","?null:e}const m=c(null);async function w(){try{return await m.value.validate(),"驗證成功"}catch{throw new Error("驗證失敗")}}const h=k("getData"),i=async()=>{try{await w();const t=s.value.textareaValue.split(",").filter(n=>n).map(n=>n.replace(/\n/g,"")),e="https://report.youbike.com.tw/mail/station/status";await B.put(e,{city:p.city,mailList:[...t]}),await l("儲存成功"),await h()}catch(t){console.log(t)}};return(async()=>s.value.textareaValue=y(p.maildata))(),(t,e)=>(_(),$(u(z),{size:"medium",preset:"dialog"},{default:d(()=>[f(u(A),{ref_key:"formRef",ref:m,model:s.value,rules:a},{default:d(()=>[o("div",P,[o("div",q,[o("div",O,[f(u(U),{path:"textareaValue",label:"Email","label-style":"font-weight: 700; font-size:16px",rules:"rules.textareaValue"},{default:d(()=>[f(u(E),{size:"large",value:s.value.textareaValue,"onUpdate:value":e[0]||(e[0]=n=>s.value.textareaValue=n),onChange:v,placeholder:`IloveYouBike@gmail.com,
YouLoveYouBike@gmail.com,
WeLoveYouBike@gmail.com,
`,type:"textarea"},null,8,["value"])]),_:1})])])]),o("div",W,[o("div",G,[f(u(D),{type:"info",class:"me-3",onClick:i},{default:d(()=>[L("儲存")]),_:1})])])]),_:1},8,["model"])]),_:1}))}},J={class:"contanier"},K=o("div",{class:"row mx-0"},[o("h1",{class:"report-h1 fw-bold"},"場站告警")],-1),Z={__name:"Sendmail2View",setup(g){const p={"min-width":"80px","font-weight":"900"},l=S().citys,s=c(null),a=c([]),v=c([]);function y(){l.includes(2)&&a.value.push("台北市"),l.includes(3)&&a.value.push("新北市"),l.includes(4)&&a.value.push("桃園市"),l.includes(5)&&a.value.push("新竹市"),l.includes(6)&&a.value.push("新竹縣"),l.includes(20)&&a.value.push("竹科"),l.includes(7)&&a.value.push("苗栗縣"),l.includes(8)&&a.value.push("台中市"),l.includes(12)&&a.value.push("嘉義市"),l.includes(13)&&a.value.push("嘉義縣"),l.includes(14)&&a.value.push("台南市"),l.includes(15)&&a.value.push("高雄市"),l.includes(16)&&a.value.push("屏東縣")}const m=c([]);function w(){m.value=v.value.filter(i=>i.city_name===s.value)}T(s,()=>{w()}),F("getData",h);async function h(){try{const i="https://report.youbike.com.tw/mail/mailcontent",t=await B.get(i);v.value=t.data.data.filter(e=>e.type_name==="場站告警")}catch(i){console.log(i)}}return(async()=>(y(),a.value.length!==0&&(await h(),s.value=a.value[0])))(),(i,t)=>(_(),N("div",J,[K,f(u(j),{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),type:"card","tab-style":p,size:"large"},{default:d(()=>[(_(!0),N(I,null,R(a.value,e=>(_(),$(u(Y),{key:e,name:e},{default:d(()=>[f(H,{maildata:m.value,city:s.value},null,8,["maildata","city"])]),_:2},1032,["name"]))),128))]),_:1},8,["value"])]))}};export{Z as default};
