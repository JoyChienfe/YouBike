import{i as k,r as u,u as Y,o as F,c as L,b as m,d as c,e as a,n as O,l as V,p as j,L as H,y as D,k as P}from"./index-e760d64d.js";import{_ as R}from"./OutputExcel-db8b34cf.js";import{N as q}from"./DataTable-243f741d.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const G={class:"container-fluid px-0"},I=a("div",{class:"row mx-0"},[a("h1",{class:"report-h1 fw-bold"},"騎乘次數明細比例")],-1),J=a("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[a("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),K={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},Q=a("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[a("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"日期:")],-1),W={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},X={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ne={__name:"PutsearchReportbike",setup(Z){const y=k("ischange"),N=k("$swal");async function _(t){N({icon:"error",title:`${t}`,showConfirmButton:!1})}const p=u(!1),M=u(),s=Y().citys,b=u([]),r=u([]),d=u([]);let h=[],f="",g=[];const S=(t,e,l)=>{h=[],f="",g=[],h=[...t],f=l,e.forEach(o=>{g.push(o.title)})};function $(){const t=new Date("2018-01-01"),e=new Date,l=[];let o=new Date(t);for(;o<e;){const i=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),T=`${i}-${n}`,U=`${i}-${n}`;l.push({label:T,value:U}),o.setMonth(o.getMonth()+1)}if(l.length>0){const i=l[l.length-1].value,n=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0");i===n&&l.reverse()}return l}let v=[{label:"台北市",value:"台北市",disabled:!s.includes(2)},{label:"新北市",value:"新北市",disabled:!s.includes(3)},{label:"桃園市",value:"桃園市",disabled:!s.includes(4)},{label:"新竹市+竹科",value:"新竹市+竹科",disabled:!s.includes(5)||!s.includes(20)},{label:"新竹市",value:"新竹市",disabled:!s.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!s.includes(6)},{label:"竹科",value:"竹科",disabled:!s.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!s.includes(7)},{label:"台中市",value:"台中市",disabled:!s.includes(8)},{label:"嘉義市",value:"嘉義市",disabled:!s.includes(12)},{label:"台南市",value:"台南市",disabled:!s.includes(14)},{label:"高雄市",value:"高雄市",disabled:!s.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!s.includes(16)}],x=[];(function(){let e=[];v.forEach(o=>{o.disabled||e.push(o)}),v=[...e];const l=$();l.shift(),x=[...l]})();const C=()=>{let t=[];v.forEach(e=>{t.push(e.value)}),d.value=t},E=()=>{let t=[];x.forEach(e=>{t.push(e.value)}),r.value=[...t]},w=[{key:"item1",align:"center",fixed:"left",title:"使用次數"},{key:"item2",align:"center",title:"未加保卡數"},{key:"item3",align:"center",title:"已加保卡數"},{key:"item4",align:"center",title:"卡數合計"},{key:"item5",align:"center",title:"未加保比例"},{key:"item6",align:"center",title:"已加保比例"}];function z(t){return t.map(e=>e.replace(/-/g,""))}const A=async()=>{try{const t="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"report",table_id:"alluse2",date:z(r.value),city:d.value};p.value=!0;const l=await P.get(t,{params:e});p.value=!1;const o=l.data.data;let i=[];o.forEach(n=>{i.push({item1:n.usetime,item2:n.N,item3:n.Y,item4:n.Card_CNT,item5:n.N_prop,item6:n.Y_prop})}),b.value=[...i],S(b.value,w,"騎乘次數明細比例")}catch(t){console.log(t)}},B=()=>{if(d.value.length===0)return _("請選擇城市");if(r.value.length===0)return _("請選擇每周一日期");A()};return(t,e)=>(F(),L("div",G,[m(c(H),{active:p.value,"onUpdate:active":e[0]||(e[0]=l=>p.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),I,a("form",{class:O(["row mx-0",{"report-header":!c(y),"report-header-dark":c(y)}])},[J,a("div",K,[m(c(D),{value:d.value,"onUpdate:value":e[1]||(e[1]=l=>d.value=l),placeholder:"請選擇",multiple:"",options:c(v),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),a("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[a("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:C}," 城市全選 ")]),Q,a("div",W,[m(c(D),{value:r.value,"onUpdate:value":e[2]||(e[2]=l=>r.value=l),placeholder:"請選擇",multiple:"",options:c(x),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),a("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[a("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:E}," 日期全選 ")]),a("div",X,[a("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:B}," 搜尋 "),m(R,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:c(h),name:c(f),header:c(g)},null,8,["data","name","header"])])],2),V(m(c(q),{ref_key:"dataTable",ref:M,data:b.value,columns:w,pagination:{pageSize:17},"max-height":600,"scroll-x":1e3,bordered:!1,size:"small","single-line":!1,striped:""},null,8,["data"]),[[j,b.value.length>0]])]))}};export{ne as default};
