import{i as x,r as c,o as m,c as f,b as $,d as p,e,n as M,b4 as C,F as z,b3 as P,m as R,k as i,L as S,l as q,bi as G}from"./index-1103b7f9.js";import{N as H}from"./Mention-dff68f30.js";const I={class:"container-fluid px-0"},J=e("div",{class:"row mx-0"},[e("h1",{class:"report-h1 fw-bold"},"帳號城市權限管理")],-1),K=e("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[e("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"帳號資料:")],-1),O={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12 px-0"},Q=e("hr",null,null,-1),T={key:0},W={class:"mt-2 fw-bold"},X=e("h3",{class:"mt-2 fw-bold"},"城市:",-1),Y=["id","onUpdate:modelValue"],Z=["for"],at={__name:"RolecityView",setup(tt){const _=x("ischange"),l=c(!1),n=c(),y=c([]),w=x("$swal");async function N(t){w({icon:"error",title:`${t}`,showConfirmButton:!1})}async function V(t){w({icon:"success",title:`${t}`,showConfirmButton:!1})}const B=c(null),E=async()=>{const t="http://127.0.0.1:3000/isauth/roles",s=(await i.get(t)).data.rows;B.value=[...s]},b=c([]);async function L(){l.value=!0,await E();const t=[],a="http://127.0.0.1:3000/isauth/userrole",s=await i.get(a);l.value=!1,b.value=[...s.data.rows],b.value.forEach(o=>{t.push({label:`${o.name}_${o.users_id}`,value:`${o.name}_${o.users_id}`})}),y.value=[...t]}(async function(){await L()})();const r=c([]),v=c(""),U=async()=>{try{let t="";n.value.includes("@")&&(t=n.value.replace("@","")),v.value=t;const s=`http://127.0.0.1:3000/isauth/usercity/${t.split("_")[1]}`,o="http://127.0.0.1:3000/isauth/citys";l.value=!0;const u=await Promise.all([await i.get(s),await i.get(o)]);l.value=!1;const A=u[0].data.rows,D=u[1].data.rows,F=A.map(h=>h.city_id),d=[];D.forEach((h,k)=>{d.push(h),F.includes(h.city_id)?d[k].isselect=!0:d[k].isselect=!1}),r.value=[...d]}catch{return l.value=!1,N("格式不正確")}},g=()=>{r.value=[]},j=async()=>{try{const t=v.value.split("_")[1].trim(),a=[];r.value.forEach(o=>{o.isselect&&a.push({users_id:t,city_id:o.city_id})});const s=`http://127.0.0.1:3000/isauth/role_citys/${t}`;g(),n.value="@",await V("成功修改"),await i.put(s,a)}catch(t){console.log(t)}};return(t,a)=>(m(),f("div",I,[$(p(S),{active:l.value,"onUpdate:active":a[0]||(a[0]=s=>l.value=s),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),J,e("form",{class:M(["row mx-0",{"report-header":!p(_),"report-header-dark":p(_)}])},[K,e("div",O,[$(p(H),{options:y.value,"default-value":"@",value:n.value,"onUpdate:value":a[1]||(a[1]=s=>n.value=s)},null,8,["options","value"])]),e("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[e("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:U}," 確定 ")])],2),Q,r.value.length>0?(m(),f("div",T,[e("h2",W,C(v.value),1),X,(m(!0),f(z,null,P(r.value,(s,o)=>(m(),f("div",{key:`${o}111`,class:"form-check form-check-inline"},[q(e("input",{class:"form-check-input",type:"checkbox",id:s.city_name,"onUpdate:modelValue":u=>s.isselect=u},null,8,Y),[[G,s.isselect]]),e("label",{class:"form-check-label fw-bold",for:s.city_name},C(s.city_name),9,Z)]))),128)),e("div",{style:{display:"flex","justify-content":"flex-start"},class:"mt-3"},[e("button",{type:"buttno",class:"btn btn-secondary me-3",onClick:g}," 取消 "),e("button",{type:"button",class:"btn btn-success",onClick:j}," 確定 ")])])):R("",!0)]))}};export{at as default};
