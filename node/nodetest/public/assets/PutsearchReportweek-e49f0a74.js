import{i as D,r as d,u as L,o as M,c as O,b as u,d as n,e as s,n as T,k as j,m as F,t as S,j as G}from"./index-3459458a.js";import{L as V}from"./index-fcaa1a70.js";import{_ as W}from"./OutputExcel-14eb8bfa.js";import{N as H}from"./DataTable-83b67cc2.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";import"./Input-c173e393.js";import"./Forward-c5c87e0a.js";const P={class:"container-fluid px-0"},Y=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"投保率分析週報")],-1),q=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),J={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},K=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"日期:")],-1),Q={class:"row mx-0 ms-md-2 align-items-center col-md-2 col-12 px-0 mt-md-0"},X={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},re={__name:"PutsearchReportweek",setup(Z){const y=D("ischange"),N=D("$swal");async function x(t){N({icon:"error",title:`${t}`,showConfirmButton:!1})}const m=d(!1),E=d(),l=L().citys,p=d([]),c=d([]),r=d([]);let v=[],g="",_=[];const U=(t,e,a)=>{v=[],g="",_=[],v=[...t],g=a,e.forEach(i=>{_.push(i.title)})};function C(){const t=new Date("2018-01-01"),e=new Date,a=[];let i=new Date(t);for(;i<=e;){if(i.getDay()===1){const o=i.getFullYear(),A=String(i.getMonth()+1).padStart(2,"0"),I=String(i.getDate()).padStart(2,"0"),w=`${o}-${A}-${I}`;a.push({label:w,value:w})}i.setDate(i.getDate()+1)}return a.reverse(),a}let b=[{label:"全公司",value:"全公司"},{label:"台北市",value:"台北市",disabled:!l.includes(2)},{label:"新北市",value:"新北市",disabled:!l.includes(3)},{label:"桃園市",value:"桃園市",disabled:!l.includes(4)},{label:"新竹市+竹科",value:"新竹市+竹科",disabled:!l.includes(5)||!l.includes(20)},{label:"新竹市",value:"新竹市",disabled:!l.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!l.includes(6)},{label:"竹科",value:"竹科",disabled:!l.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!l.includes(7)},{label:"台中市",value:"台中市",disabled:!l.includes(8)},{label:"彰化縣",value:"彰化縣",disabled:!l.includes(9)},{label:"嘉義市",value:"嘉義市",disabled:!l.includes(12)},{label:"台南市",value:"台南市",disabled:!l.includes(14)},{label:"高雄市",value:"高雄市",disabled:!l.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!l.includes(16)}],f=[];(function(){let e=[];b.forEach(i=>{i.disabled||e.push(i)}),b=[...e];const a=C();a.shift(),f=[...a]})();const $=()=>{let t=[];b.forEach(e=>{t.push(e.value)}),r.value=t},B=()=>{let t=[];f.forEach(e=>{t.push(e.value)}),c.value=[...t]},k=[{key:"item1",align:"center",fixed:"left",title:"週次",width:150},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"總會員卡數(A)"},{key:"item4",align:"center",title:"總騎乘次數(B)"},{key:"item5",align:"center",title:"有使用紀錄會員卡數(C)"},{key:"item6",align:"center",title:"註冊地卡數"},{key:"item7",align:"center",title:"非註冊地卡數"},{key:"item8",align:"center",title:"有使用記錄卡片占比(D=C/A)"},{key:"item9",align:"center",title:"有使用記錄卡片加保張數(E)"},{key:"item10",align:"center",title:"保險涵蓋率_卡片數(F=E/C)"},{key:"item11",align:"center",title:"有加保卡片的騎乘次數(G)"},{key:"item12",align:"center",title:"保險涵蓋率_使用次數(H=G/B)"}],R=async()=>{try{const t="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"report",table_id:"weekly_report_ride_INSUR",date:c.value,city:r.value};m.value=!0;const a=await G.get(t,{params:e});m.value=!1;const i=a.data.data;let h=[];i.forEach(o=>{h.push({item1:o.week_range,item2:o.city,item3:o.total_card,item4:o.ride_times,item5:o.ride_card,item6:o.ride_card_incity,item7:o.ride_card_nocity,item8:o.active_per,item9:o.ride_card_INSUR,item10:o.ride_card_INSUR_per,item11:o.ride_times_INSUR,item12:o.ride_times_INSUR_per})}),p.value=[...h],U(p.value,k,"投保率分析週報")}catch(t){console.log(t)}},z=()=>{if(r.value.length===0)return x("請選擇城市");if(c.value.length===0)return x("請選擇每周一日期");R()};return(t,e)=>(M(),O("div",P,[u(n(V),{active:m.value,"onUpdate:active":e[0]||(e[0]=a=>m.value=a),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),Y,s("form",{class:T(["row mx-0",{"report-header":!n(y),"report-header-dark":n(y)}])},[q,s("div",J,[u(n(S),{value:r.value,"onUpdate:value":e[1]||(e[1]=a=>r.value=a),placeholder:"請選擇",multiple:"",options:n(b),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:$}," 城市全選 ")]),K,s("div",Q,[u(n(S),{value:c.value,"onUpdate:value":e[2]||(e[2]=a=>c.value=a),placeholder:"請選擇日期",multiple:"",options:n(f),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:B}," 日期全選 ")]),s("div",X,[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:z}," 搜尋 "),u(W,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:n(v),name:n(g),header:n(_)},null,8,["data","name","header"])])],2),j(u(n(H),{ref_key:"dataTable",ref:E,data:p.value,columns:k,pagination:{pageSize:17},"max-height":600,"scroll-x":1e3,bordered:!1,size:"small","single-line":!1,striped:""},null,8,["data"]),[[F,p.value.length>0]])]))}};export{re as default};
