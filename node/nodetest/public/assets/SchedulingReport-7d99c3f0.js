import{i as M,u as K,r as m,o as l,c as n,b as g,d as e,e as s,k as V,v as E,F as U,l as u,n as R,m as G,j as I}from"./index-9437428c.js";import{L as J}from"./index-181255ed.js";import{_ as O}from"./OutputExcel-f22009f0.js";import{N as S}from"./DatePicker-642088af.js";import{N as Q}from"./DataTable-d29f5e06.js";import"./xlsx-bd534488.js";import"./Forward-a46dd4c7.js";import"./Input-3a828f95.js";import"./get-slot-1efb97e5.js";const W={class:"container-fluid px-0"},X=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"調度日報")],-1),Y={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Z=s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1),ee={class:"col-md-auto px-0"},te=s("option",{selected:"",disabled:""},"請選擇",-1),ae=s("option",{value:"1"},"1.0",-1),oe=s("option",{value:"2"},"2.0+2.0E",-1),se=[te,ae,oe],le={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ne=s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:",-1),ie={class:"col-md-auto px-0"},ue=s("option",{selected:"",disabled:""},"請選擇",-1),ce={key:0,value:"Newtaipei"},re={key:1,value:"Taoyuan"},de={key:2,value:"Miaoli"},me={key:0,value:"TaipeiNewtaipei2"},pe={key:1,value:"Taipei2"},ve={key:2,value:"Newtaipei2"},_e={key:3,value:"Taoyuan2"},fe={key:4,value:"Hsinchu2"},he={key:5,value:"Hsinchu_Country2"},ye={key:6,value:"Miaoli2"},ge={key:7,value:"Taichung2"},xe={key:8,value:"Chiayi2"},be={key:9,value:"Tainan2"},De={key:10,value:"Kaohsiung2"},we={key:11,value:"Pingtung2"},ke={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Ne={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},He={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},Le={__name:"SchedulingReport",setup(Ce){const $=M("ischange"),B=M("$swal"),i=K().citys;async function x(c){B({icon:"error",title:`${c}`,showConfirmButton:!1})}const _=m(),f=m(),b=m(!1),D=m([]),h=m("請選擇"),w=m(null),k=m([]),y=m("請選擇");let N=[],H="",C=[];const j=(c,t,a)=>{N=[],H="",C=[],N=[...c],H=a,t.forEach(o=>{C.push(o.title)})},z=c=>{const t=f.value,a=new Date;if(a.setHours(0,0,0,0),t){const o=new Date(t);o.setHours(0,0,0,0);const r=new Date(o);r.setDate(r.getDate()-30);const d=new Date(c);if(d.setHours(0,0,0,0),d<r||d>o||d>=a)return!0}else{const o=new Date(c);if(o.setHours(0,0,0,0),o>=a)return!0}},L=c=>{const t=_.value,a=new Date;if(a.setHours(0,0,0,0),t){const o=new Date(t);if(o.setHours(0,0,0,0),o>a)return!0;const r=new Date(o);r.setDate(r.getDate()+30);const d=new Date(c);if(d.setHours(0,0,0,0),d<o||d>r||d>=a)return!0}else{const o=new Date(c);if(o.setHours(0,0,0,0),o>=a)return!0}},F=async()=>{const c="https://report.youbike.com.tw/isauth/gcpfun",t={dataset_id:"report",table_id:`daily_report_maintain_query${h.value}`,begin_date:_.value,end_date:f.value,city:y.value};b.value=!0;const o=(await I.get(c,{params:t})).data.data;let r=[];o.forEach((p,v)=>{r.length===0?r.push({key:`item${v+1}`,align:"center",fixed:"left",title:p[2],width:150}):r.push({key:`item${v+1}`,align:"center",title:p[2]})});const d=o[0].length-3,A=o.length;let T=[];for(let p=0;p<d;p++){T.push({});for(let v=1;v<=A;v++)T[p][`item${v}`]=o[v-1][p+3]}k.value=[...r],D.value=[...T],w.value.page&&w.value.page(1),j(D.value,k.value,"調度日報"),b.value=!1},P=()=>{if(h.value==="請選擇"){x("請選擇系統別");return}else if(y.value==="請選擇"){x("請選擇城市");return}else if(_.value){if(!f.value)return x("請選擇結束時間")}else return x("請選擇開始時間");F()},q=()=>{_.value=null,f.value=null};return(c,t)=>(l(),n("div",W,[g(e(J),{active:b.value,"onUpdate:active":t[0]||(t[0]=a=>b.value=a),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),X,s("form",{class:R(["row mx-0",{"report-header":!e($),"report-header-dark":e($)}])},[s("div",Y,[Z,s("div",ee,[V(s("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[1]||(t[1]=a=>h.value=a),onChange:t[2]||(t[2]=a=>y.value="請選擇")},se,544),[[E,h.value]])])]),s("div",le,[ne,s("div",ie,[V(s("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a)},[ue,h.value==1?(l(),n(U,{key:0},[e(i).includes(3)?(l(),n("option",ce," 新北市 ")):u("",!0),e(i).includes(4)?(l(),n("option",re," 桃園市 ")):u("",!0),e(i).includes(7)?(l(),n("option",de," 苗栗縣 ")):u("",!0)],64)):h.value=="2"?(l(),n(U,{key:1},[e(i).includes(2)&&e(i).includes(3)?(l(),n("option",me," 雙北 ")):u("",!0),e(i).includes(2)?(l(),n("option",pe," 台北市 ")):u("",!0),e(i).includes(3)?(l(),n("option",ve," 新北市 ")):u("",!0),e(i).includes(4)?(l(),n("option",_e," 桃園市 ")):u("",!0),e(i).includes(5)?(l(),n("option",fe," 新竹市 ")):u("",!0),e(i).includes(6)?(l(),n("option",he," 新竹縣 ")):u("",!0),e(i).includes(7)?(l(),n("option",ye," 苗栗縣 ")):u("",!0),e(i).includes(8)?(l(),n("option",ge," 台中市 ")):u("",!0),e(i).includes(12)?(l(),n("option",xe," 嘉義市 ")):u("",!0),e(i).includes(14)?(l(),n("option",be," 台南市 ")):u("",!0),e(i).includes(15)?(l(),n("option",De," 高雄市 ")):u("",!0),e(i).includes(16)?(l(),n("option",we," 屏東縣 ")):u("",!0)],64)):u("",!0)],512),[[E,y.value]])])]),s("div",ke,[g(e(S),{class:"px-0","formatted-value":_.value,"onUpdate:formattedValue":t[4]||(t[4]=a=>_.value=a),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":z},null,8,["formatted-value"])]),s("div",Ne,[g(e(S),{class:"px-0","formatted-value":f.value,"onUpdate:formattedValue":t[5]||(t[5]=a=>f.value=a),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":L,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])]),s("div",He,[s("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:q}," 清空日期 "),s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:P}," 搜尋 "),g(O,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:e(N),name:e(H),header:e(C)},null,8,["data","name","header"])])],2),V(g(e(Q),{size:"small",data:D.value,ref_key:"dataTable",ref:w,columns:k.value,pagination:{pageSize:18},"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"]),[[G,D.value.length>1]])]))}};export{Le as default};
