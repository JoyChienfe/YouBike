import{i as $,r,o as m,c as v,b as k,d as c,e,n as V,l as f,b2 as h,v as L,F as M,b3 as S,m as j,k as p,L as A,b4 as D}from"./index-1103b7f9.js";import{N as E}from"./Mention-dff68f30.js";const F={class:"container-fluid px-0"},z=e("div",{class:"row mx-0"},[e("h1",{class:"report-h1 fw-bold"},"帳號角色管理")],-1),T=e("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[e("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"帳號資料:")],-1),q={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12 px-0"},G=e("hr",null,null,-1),H={class:"row mx-auto px-0"},I={class:"col-md-3"},J=e("label",{for:"labelname",class:"form-label fw-bolder"},"姓名",-1),K={class:"col-md-3 mt-2 mt-md-0"},O=e("label",{for:"labelid",class:"form-label fw-bolder"},"公號",-1),P={class:"col-md-3 mt-2 mt-md-0"},Q=e("label",{for:"labelid",class:"form-label fw-bolder"},"目前角色",-1),R={class:"col-md-3 mt-2 mt-md-0"},W=e("label",{for:"",class:"form-label fw-bolder"},"修改成的角色",-1),X=e("option",{selected:"",disabled:""},"請選擇",-1),Y=["value"],ae={__name:"UsersView",setup(Z){const w=$("$swal");async function _(a){w({icon:"error",title:`${a}`,showConfirmButton:!1})}async function U(a){w({icon:"success",title:`${a}`,showConfirmButton:!1})}const d=$("ischange"),t=r(!1),o=r(null),b=r([]),u=r("請選擇"),x=r(null),C=async()=>{const a="http://127.0.0.1:3000/isauth/roles",l=(await p.get(a)).data.rows;x.value=[...l]},y=r([]);async function g(){t.value=!0,await C();const a=[],s="http://127.0.0.1:3000/isauth/userrole",l=await p.get(s);t.value=!1,y.value=[...l.data.rows],y.value.forEach(n=>{a.push({label:`${n.name}_${n.users_id}_${n.role_name}`,value:`${n.name}_${n.users_id}_${n.role_name}`})}),b.value=[...a],console.log(b.value)}(async function(){await g()})();const i=r(),N=async()=>{try{t.value=!0;let a="";i.value.includes("@")&&(a=i.value.replace("@",""));const l=`http://127.0.0.1:3000/isauth/role/${{name:a.split("_")[0],id:a.split("_")[1],role_name:a.split("_")[2]}.id}`,n=await p.get(l);o.value=n.data.rows[0],t.value=!1}catch{return t.value=!1,_("格式不正確")}},B=async()=>{try{if(t.value=!0,u.value=="請選擇")return t.value=!1,_("請選擇修正成的角色");const a=o.value.users_id,s={role:u.value},l=`http://127.0.0.1:3000/isauth/role/${a}`;await p.patch(l,s),await g(),o.value=null,u.value="請選擇",t.value=!1,i.value="@",U("修正成功")}catch{return t.value=!1,_("修正失敗")}};return(a,s)=>(m(),v("div",F,[k(c(A),{active:t.value,"onUpdate:active":s[0]||(s[0]=l=>t.value=l),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),z,e("form",{class:V(["row mx-0",{"report-header":!c(d),"report-header-dark":c(d)}])},[T,e("div",q,[k(c(E),{options:b.value,"default-value":"@",value:i.value,"onUpdate:value":s[1]||(s[1]=l=>i.value=l)},null,8,["options","value"])]),e("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[e("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:N}," 確定 ")])],2),G,o.value?(m(),v("form",{key:0,class:V(["row mx-0",{"report-header":!c(d),"report-header-dark":c(d)}])},[e("div",H,[e("div",I,[J,f(e("input",{type:"text",class:"form-control",id:"labelname","onUpdate:modelValue":s[2]||(s[2]=l=>o.value.name=l),disabled:""},null,512),[[h,o.value.name]])]),e("div",K,[O,f(e("input",{type:"text",class:"form-control",id:"labelid","onUpdate:modelValue":s[3]||(s[3]=l=>o.value.users_id=l),disabled:""},null,512),[[h,o.value.users_id]])]),e("div",P,[Q,f(e("input",{type:"text",class:"form-control",id:"labelid","onUpdate:modelValue":s[4]||(s[4]=l=>o.value.role_name=l),disabled:""},null,512),[[h,o.value.role_name]])]),e("div",R,[W,f(e("select",{class:"form-select","onUpdate:modelValue":s[5]||(s[5]=l=>u.value=l)},[X,(m(!0),v(M,null,S(x.value,l=>(m(),v("option",{key:l.role_name,value:l.role_id},D(l.role_name),9,Y))),128))],512),[[L,u.value]])]),e("div",{class:"col col-md-auto mt-3 d-flex flex-column justify-content-end"},[e("button",{type:"button",class:"btn btn-success",onClick:B}," 送出 ")])])],2)):j("",!0)]))}};export{ae as default};
