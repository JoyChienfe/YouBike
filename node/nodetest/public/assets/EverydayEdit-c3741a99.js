import{i as k,r as m,o as B,c as z,b as p,d as o,e as r,n as F,l as L,p as j,L as q,q as M,k as A}from"./index-1103b7f9.js";import{_ as P}from"./OutputExcel-6ed9633c.js";import{N as G}from"./DataTable-1e233750.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const I={class:"container-fluid px-0"},J=r("div",{class:"row mx-0"},[r("h1",{class:"report-h1 fw-bold"},"每日新增&刪減票卡數")],-1),K={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},O={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Q={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},R={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},se={__name:"EverydayEdit",setup(W){const _=k("ischange"),C=k("$swal");async function b(a){C({icon:"error",title:`${a}`,showConfirmButton:!1})}const u=m(),i=m(),f=m(!1),D=m(null),v=m([]),g=m();let h=[],y="",x=[];const H=(a,t,e)=>{h=[],y="",x=[],h=[...a],y=e,t.forEach(n=>{x.push(n.title)})},E=a=>{const t=i.value,e=new Date;e.setHours(0,0,0,0);const n=new Date(a),c=n.getFullYear(),w=n.getMonth()+1;if(c<2023||c===2023&&w<9)return!0;if(t){const s=new Date(t);s.setHours(0,0,0,0);const d=new Date(s);d.setDate(d.getDate()-30);const l=new Date(a);if(l.setHours(0,0,0,0),l<d||l>s||l>=e)return!0}else{const s=new Date(a);if(s.setHours(0,0,0,0),s>=e)return!0}},T=a=>{const t=u.value,e=new Date;e.setHours(0,0,0,0);const n=new Date(a),c=n.getFullYear(),w=n.getMonth()+1;if(c<2023||c===2023&&w<9)return!0;if(t){const s=new Date(t);if(s.setHours(0,0,0,0),s>e)return!0;const d=new Date(s);d.setDate(d.getDate()+30);const l=new Date(a);if(l.setHours(0,0,0,0),l<s||l>d||l>=e)return!0}else{const s=new Date(a);if(s.setHours(0,0,0,0),s>=e)return!0}};function Y(a){const t=new Date(a),e=t.getUTCFullYear(),n=(t.getUTCMonth()+1).toString().padStart(2,"0"),c=t.getUTCDate().toString().padStart(2,"0");return`${e}-${n}-${c}`}const $=()=>{u.value=null,i.value=null},N=()=>{let a=[{key:"item1",align:"center",title:"日期"},{key:"item2",align:"center",title:"縣市"},{key:"item3",align:"center",title:"刪減票卡數"},{key:"item4",align:"center",title:"增加票卡數"}];g.value=[...a]},S=a=>{let t=[];a.forEach(e=>{t.push({item1:Y(e.date),item2:e.city,item3:e.del_card,item4:e.add_card})}),v.value=[...t]},U=async()=>{const a="http://127.0.0.1:3000/isauth/gcpfun",t={dataset_id:"report",table_id:"add_del_card",begin_date:u.value,end_date:i.value};try{f.value=!0;const e=await A.get(a,{params:t});f.value=!1;const n=e.data.data;N(),S(n),D.value&&D.value.page(1),H(v.value,g.value,"每日新增&刪減票卡數")}catch(e){console.log(e)}},V=()=>{if(u.value){if(!i.value){b("請選擇結束日期");return}}else{b("請選擇開始日期");return}U()};return(a,t)=>(B(),z("div",I,[p(o(q),{active:f.value,"onUpdate:active":t[0]||(t[0]=e=>f.value=e),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),J,r("form",{class:F(["row mx-0",{"report-header":!o(_),"report-header-dark":o(_)}])},[r("div",K,[r("div",O,[p(o(M),{class:"px-0","formatted-value":u.value,"onUpdate:formattedValue":t[1]||(t[1]=e=>u.value=e),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,"default-time":"2023-06-20",placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":E},null,8,["formatted-value"])]),r("div",Q,[p(o(M),{class:"px-0","formatted-value":i.value,"onUpdate:formattedValue":t[2]||(t[2]=e=>i.value=e),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":T,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])])]),r("div",R,[r("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:$}," 清空日期 "),r("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:V}," 搜尋 "),p(P,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:o(h),name:o(y),header:o(x)},null,8,["data","name","header"])])],2),L(p(o(G),{ref_key:"dataTable",ref:D,size:"small",columns:g.value,data:v.value,pagination:{pageSize:13},"max-height":600,"scroll-x":500,bordered:!1,"single-line":!1,striped:""},null,8,["columns","data"]),[[j,v.value.length>0]])]))}};export{se as default};
