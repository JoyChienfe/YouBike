import{i as R,r,u as me,o as C,c as H,b as p,d as v,e as s,l as L,v as W,F as j,m as ve,n as pe,L as fe,y as X,q as M,B as ye,k as be}from"./index-b68f8f3e.js";import{u as N,w as ge}from"./xlsx-bd534488.js";import{N as he}from"./Result-d76326bf.js";import"./Warning-c30c2ba7.js";const _e={class:"container-fluid px-0"},we=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"無車無位統計")],-1),De={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},xe=s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"類別:",-1),ke={class:"col-md-auto px-0"},Me=s("option",{selected:"",disabled:""},"請選擇",-1),Ve=s("option",{value:"day_empty_full"},"日報",-1),Fe=s("option",{value:"weekly_empty_full"},"週報",-1),Ye=s("option",{value:"monthly_empty_full"},"月報",-1),Ue=[Me,Ve,Fe,Ye],Ee={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},$e=s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"系統別:",-1),Ce={class:"col-md-auto px-0"},He=s("option",{selected:"",disabled:""},"請選擇",-1),Ne=s("option",{value:"1.0"},"1.0",-1),Se=s("option",{value:"2.0"},"2.0+2.0E",-1),Be=[He,Ne,Se],Oe=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"城市:")],-1),Le={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},We={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},je=s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"項目:",-1),ze={class:"col-md-auto px-0"},Ae=ye('<option selected disabled>請選擇</option><option value="無車5分鐘">無車5分鐘</option><option value="無車10分鐘">無車10分鐘</option><option value="無車20分鐘">無車20分鐘</option><option value="無車30分鐘">無車30分鐘</option><option value="無位5分鐘">無位5分鐘</option><option value="無位10分鐘">無位10分鐘</option><option value="無位20分鐘">無位20分鐘</option><option value="無位30分鐘">無位30分鐘</option>',9),Te=[Ae],qe=s("div",{class:"row align-items-center col-md-auto col-12 pe-0"},[s("label",{class:"col-md-auto col-form-label fw-bolder pe-0"},"狀態:")],-1),Pe={class:"row mx-0 mx-md-2 align-items-center col-md-2 col-12"},Re={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Xe={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Ge={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Ie={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Je={class:"row mx-0 mx-md-2 align-items-center col-md-auto"},Ke={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},Qe={class:"row mx-0 mx-md-2 align-items-center col-md-auto"},ot={__name:"NocarNOseet",setup(Ze){const G=R("$swal");async function m(o){G({icon:"error",title:`${o}`,showConfirmButton:!1})}const z=R("ischange"),Y=r(!1),A=r([]),y=r("請選擇"),c=r("請選擇"),U=r("請選擇"),I=r([{key:"item1",align:"center",fixed:"left",title:"date",width:100},{key:"item2",align:"center",title:"責任區",width:60},{key:"item3",align:"center",title:"場站代號"},{key:"item4",align:"center",title:"站名",width:250},{key:"item5",align:"center",title:"狀態",width:60},{key:"item6",align:"center",title:"項目",width:70},{key:"item7",align:"center",title:"0"},{key:"item8",align:"center",title:"1"},{key:"item9",align:"center",title:"2"},{key:"item10",align:"center",title:"3"},{key:"item11",align:"center",title:"4"},{key:"item12",align:"center",title:"5"},{key:"item13",align:"center",title:"6"},{key:"item14",align:"center",title:"7"},{key:"item15",align:"center",title:"8"},{key:"item16",align:"center",title:"9"},{key:"item17",align:"center",title:"10"},{key:"item18",align:"center",title:"11"},{key:"item19",align:"center",title:"12"},{key:"item20",align:"center",title:"13"},{key:"item21",align:"center",title:"14"},{key:"item22",align:"center",title:"15"},{key:"item23",align:"center",title:"16"},{key:"item24",align:"center",title:"17"},{key:"item25",align:"center",title:"18"},{key:"item26",align:"center",title:"19"},{key:"item27",align:"center",title:"20"},{key:"item28",align:"center",title:"21"},{key:"item29",align:"center",title:"22"},{key:"item30",align:"center",title:"23"},{key:"item31",align:"center",title:"總計",width:50}]);let E=[],S="",B=[];const J=(o,e,t)=>{if(E=[],B=[],S="",E=[...o],S=t,e.forEach(l=>{B.push(l.title)}),E.length){const l=N.book_new(),i=N.json_to_sheet(E);N.book_append_sheet(l,i,"sheet1"),N.sheet_add_aoa(i,[B],{origin:"A1"}),ge(l,`${S}.xlsx`)}else return m("空資料不能匯出")},D=r([]),n=me().citys,V=r([]),K=()=>{D.value=[],y.value==="1.0"?V.value=[{label:"新北市",value:"新北市",disabled:!n.includes(3)},{label:"桃園市",value:"桃園市",disabled:!n.includes(4)},{label:"苗栗縣",value:"苗栗縣",disabled:!n.includes(7)}]:y.value==="2.0"?V.value=[{label:"台北市",value:"台北市",disabled:!n.includes(2)},{label:"新北市",value:"新北市",disabled:!n.includes(3)},{label:"桃園市",value:"桃園市",disabled:!n.includes(4)},{label:"新竹市",value:"新竹市",disabled:!n.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!n.includes(6)},{label:"竹科",value:"竹科",disabled:!n.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!n.includes(7)},{label:"台中市",value:"台中市",disabled:!n.includes(8)},{label:"嘉義市",value:"嘉義市",disabled:!n.includes(12)},{label:"嘉義縣",value:"嘉義縣",disabled:!n.includes(13)},{label:"台南市",value:"台南市",disabled:!n.includes(14)},{label:"高雄市",value:"高雄市",disabled:!n.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!n.includes(16)},{label:"台東縣",value:"台東縣",disabled:!n.includes(19)}]:y.value==="2.0+2.0E"&&(V.value=[{label:"台北市",value:"台北市",disabled:!n.includes(2)},{label:"新北市",value:"新北市",disabled:!n.includes(3)},{label:"桃園市",value:"桃園市",disabled:!n.includes(4)},{label:"新竹市",value:"新竹市",disabled:!n.includes(5)},{label:"新竹縣",value:"新竹縣",disabled:!n.includes(6)},{label:"竹科",value:"竹科",disabled:!n.includes(20)},{label:"苗栗縣",value:"苗栗縣",disabled:!n.includes(7)},{label:"台中市",value:"台中市",disabled:!n.includes(8)},{label:"嘉義市",value:"嘉義市",disabled:!n.includes(12)},{label:"嘉義縣",value:"嘉義縣",disabled:!n.includes(13)},{label:"台南市",value:"台南市",disabled:!n.includes(14)},{label:"高雄市",value:"高雄市",disabled:!n.includes(15)},{label:"屏東縣",value:"屏東縣",disabled:!n.includes(16)},{label:"台東縣",value:"台東縣",disabled:!n.includes(19)}])},Q=()=>{let o=[];V.value.forEach(e=>{e.disabled||o.push(e.value)}),D.value=o},Z=()=>{T(),q(),P()},x=r(),k=r(),T=()=>{x.value=null,k.value=null},ee=o=>{const e=k.value,t=new Date;if(t.setHours(0,0,0,0),e){const l=new Date(e);l.setHours(0,0,0,0);const i=new Date(l);i.setDate(i.getDate()-30);const u=new Date(o);if(u.setHours(0,0,0,0),u<i||u>l||u>=t)return!0}else{const l=new Date(o);if(l.setHours(0,0,0,0),l>=t)return!0}},te=o=>{const e=x.value,t=new Date;if(t.setHours(0,0,0,0),e){const l=new Date(e);if(l.setHours(0,0,0,0),l>t)return!0;const i=new Date(l);i.setDate(i.getDate()+30);const u=new Date(o);if(u.setHours(0,0,0,0),u<l||u>i||u>=t)return!0}else{const l=new Date(o);if(l.setHours(0,0,0,0),l>=t)return!0}},b=r(null),g=r(null),q=()=>{g.value=null,b.value=null},le=o=>{const e=new Date(o),t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(l);i.setDate(l.getDate()-(l.getDay()||7)+1);const u=e.getDay();if(e>=i||u!==1||e.getFullYear()<2023)return!0;const a=new Date(g.value),d=new Date(a);return d.setDate(a.getDate()-27),!!(e<d||g.value&&e>=a)},ae=o=>{const e=new Date(o);e.setHours(0,0,0,0);const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(l);i.setDate(l.getDate()-(l.getDay()||7)+1);const u=e.getDay();if(e>=i||u!==1||e.getFullYear()<2023)return!0;const a=new Date(b.value);a.setHours(0,0,0,0);const d=new Date(a);return d.setDate(a.getDate()+27),!!(b.value&&e>d||e.getTime()<a.getTime())},h=r(),_=r(),P=()=>{_.value=null,h.value=null},se=o=>{const e=new Date(o),t=e.getFullYear(),l=e.getMonth()+1,i=new Date,u=i.getFullYear(),f=i.getMonth()+1,a=_.value;let d,w;if(a!==null){const F=new Date(a);d=F.getFullYear(),w=F.getMonth()+1}const O=(d-t)*12+(w-l);return t<2023||t>u||t===u&&l>=f||d!==void 0&&(t>d||t===d&&l>w)||O>=12},oe=o=>{const e=new Date(o),t=e.getFullYear(),l=e.getMonth()+1,i=new Date,u=i.getFullYear(),f=i.getMonth()+1,a=h.value;let d,w;if(a!==null){const F=new Date(a);d=F.getFullYear(),w=F.getMonth()+1}const O=(t-d)*12+(l-w);return t<2023||t>u||t===u&&l>=f||d!==void 0&&(t<d||t===d&&l<w)||O>=12},ne=o=>{const e=new Date,t=e.getFullYear(),l=e.getMonth()+1,i=l<10?`0${l}`:l;`${t}-${i}`!==o&&(h.value=o)},ie=o=>{const e=new Date,t=e.getFullYear(),l=e.getMonth()+1,i=l<10?`0${l}`:l;`${t}-${i}`!==o&&(_.value=o)};function ue(o){var e=new Date(o),t=e.getFullYear(),l=("0"+(e.getMonth()+1)).slice(-2),i=("0"+e.getDate()).slice(-2),u=t+"-"+l+"-"+i;return u}const de=async()=>{try{let o=null,e=null;c.value==="day_empty_full"?(o=x.value,e=k.value):c.value==="weekly_empty_full"?(o=b.value,e=g.value):c.value==="monthly_empty_full"&&(o=`${h.value}-01`,e=`${_.value}-01`),Y.value=!0;const t="https://report.youbike.com.tw/isauth/gcpfun",l={dataset_id:"data_analysis",table_id:c.value,begin_date:o,end_date:e,city:D.value,item:U.value,status:$.value,sys:y.value},u=(await be.get(t,{params:l})).data.data;console.log(u);let f=[];u.forEach(a=>{let d=[];d={item1:ue(a.date),item2:a.responsible_area,item3:a.s_no,item4:a.s_name,item5:a.status,item6:a.item,item7:a.r0,item8:a.r1,item9:a.r2,item10:a.r3,item11:a.r4,item12:a.r5,item13:a.r6,item14:a.r7,item15:a.r8,item16:a.r9,item17:a.r10,item18:a.r11,item19:a.r12,item20:a.r13,item21:a.r14,item22:a.r15,item23:a.r16,item24:a.r17,item25:a.r18,item26:a.r19,item27:a.r20,item28:a.r21,item29:a.r22,item30:a.r23,item31:a.total},f.push({...d})}),A.value=[...f],J(A.value,I.value,"無車無位統計"),Y.value=!1}catch(o){console.log(o)}},$=r([]),re=[{label:"分鐘",value:"分鐘"},{label:"次數",value:"次數"}],ce=()=>{if(c.value==="請選擇")return m("請選擇類別");if(y.value==="請選擇")return m("請選擇系統別");if(D.value.length===0)return m("請選擇城市");if(U.value==="請選擇")return m("請選擇項目");if($.value.length===0)return m("請選擇狀態");if(c.value==="day_empty_full")if(x.value){if(!k.value)return m("請選擇結束日期")}else return m("請選擇開始日期");else if(c.value==="weekly_empty_full")if(b.value){if(!g.value)return m("請選擇結束日期")}else return m("請選擇開始日期");else if(c.value==="monthly_empty_full")if(h.value){if(!_.value)return m("請選擇結束日期")}else return m("請選擇開始日期");de()};return(o,e)=>(C(),H("div",_e,[p(v(fe),{active:Y.value,"onUpdate:active":e[0]||(e[0]=t=>Y.value=t),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),we,s("form",{class:pe(["row mx-0",{"report-header":!v(z),"report-header-dark":v(z)}])},[s("div",De,[xe,s("div",ke,[L(s("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),onChange:Z},Ue,544),[[W,c.value]])])]),s("div",Ee,[$e,s("div",Ce,[L(s("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),onChange:K},Be,544),[[W,y.value]])])]),Oe,s("div",Le,[p(v(X),{class:"px-0",value:D.value,"onUpdate:value":e[3]||(e[3]=t=>D.value=t),placeholder:"請選擇",multiple:"",options:V.value,"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-0 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:Q}," 城市全選 ")]),s("div",We,[je,s("div",ze,[L(s("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":e[4]||(e[4]=t=>U.value=t)},Te,512),[[W,U.value]])])]),qe,s("div",Pe,[p(v(X),{class:"px-0",value:$.value,"onUpdate:value":e[5]||(e[5]=t=>$.value=t),placeholder:"請選擇",multiple:"",options:re,"max-tag-count":1,size:"medium"},null,8,["value"])]),c.value==="day_empty_full"?(C(),H(j,{key:0},[s("div",Re,[p(v(M),{class:"px-0","formatted-value":x.value,"onUpdate:formattedValue":e[6]||(e[6]=t=>x.value=t),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd",clearable:"","is-date-disabled":ee},null,8,["formatted-value"])]),s("div",Xe,[p(v(M),{class:"px-0","formatted-value":k.value,"onUpdate:formattedValue":e[7]||(e[7]=t=>k.value=t),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":te,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd",clearable:""},null,8,["formatted-value"])]),s("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:T}," 清空日期 ")],64)):c.value==="weekly_empty_full"?(C(),H(j,{key:1},[s("div",Ge,[p(v(M),{class:"px-0","formatted-value":b.value,"onUpdate:formattedValue":e[8]||(e[8]=t=>b.value=t),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"開始日期","value-format":"yyyy-MM-dd","is-date-disabled":le,clearable:""},null,8,["formatted-value"])]),s("div",Ie,[p(v(M),{class:"px-0","formatted-value":g.value,"onUpdate:formattedValue":e[9]||(e[9]=t=>g.value=t),type:"date",actions:null,"input-readonly":!0,"is-date-disabled":ae,"update-value-on-close":!0,placeholder:"結束日期","value-format":"yyyy-MM-dd"},null,8,["formatted-value"])]),s("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:q}," 清空日期 ")],64)):c.value==="monthly_empty_full"?(C(),H(j,{key:2},[s("div",Je,[p(v(M),{class:"px-0","input-readonly":!0,"formatted-value":h.value,"onUpdate:formattedValue":e[10]||(e[10]=t=>h.value=t),type:"month",actions:null,"update-value-on-close":"",placeholder:"開始月份","is-date-disabled":se,"value-format":"yyyy-MM","on-update:formatted-value":ne},null,8,["formatted-value"])]),s("div",Ke,[s("div",Qe,[p(v(M),{class:"px-0","input-readonly":!0,"formatted-value":_.value,"onUpdate:formattedValue":e[11]||(e[11]=t=>_.value=t),type:"month",actions:null,"update-value-on-close":"",placeholder:"結束月份","is-date-disabled":oe,"value-format":"yyyy-MM","on-update:formatted-value":ie},null,8,["formatted-value"])])]),s("button",{type:"button",class:"btn btn-info text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:P}," 清空月份 ")],64)):ve("",!0),s("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[s("button",{type:"button",class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:ce}," 搜尋匯出 ")])],2),p(v(he),{class:"mt-5",status:"info",title:"此頁面只供下載EXCEL"})]))}};export{ot as default};
