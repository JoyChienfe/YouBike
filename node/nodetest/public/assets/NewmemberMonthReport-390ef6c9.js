import{i as y,r as c,o as B,c as C,b as d,d as s,e as l,n as E,l as L,p as S,L as z,q as F,k as T}from"./index-76324cc3.js";import{_ as V}from"./OutputExcel-fe0afde0.js";import{N as Y}from"./DataTable-02aab776.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const P={class:"container-fluid px-0"},U=l("div",{class:"row mx-0"},[l("h1",{class:"report-h1 fw-bold"},"每月新增會員投保數")],-1),j={class:"row mx-0 mx-md-2 align-items-center col-md-auto"},q={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},K={__name:"NewmemberMonthReport",setup(A){const v=y("ischange"),w=y("$swal");async function _(a){w({icon:"error",title:`${a}`,showConfirmButton:!1})}const f=c([]),i=c(!1),b=c(),m=c([]),u=c(D());let p=[],h="",g=[];const k=(a,t,e)=>{p=[],g=[],h="",p=[...a],h=e,t.forEach(n=>{g.push(n.title)})};function D(){const a=new Date;let t=a.getFullYear(),e=a.getMonth();return e===0?(t--,e=11):e--,e=(e+1).toString().padStart(2,"0"),`${t}-${e}`}const M=a=>{const t=new Date(a),e=t.getFullYear(),n=t.getMonth()+1,r=new Date,o=r.getFullYear(),x=r.getMonth()+1;return e<2023||e>o||e===o&&n>x||e===o&&n>=x};f.value=[{key:"item1",align:"center",title:"縣市"},{key:"item2",align:"center",title:"新增會員卡投保數"},{key:"item3",align:"center",title:"新增註冊卡數"},{key:"item4",align:"center",title:"投保率"}];const N=async()=>{try{i.value=!0;const a="https://report.youbike.com.tw/isauth/gcpfun";let t={dataset_id:"report",table_id:"month_insur",date:u.value};const n=(await T.get(a,{params:t})).data.data;let r=[];n.forEach(o=>{r.push({item1:o.city,item2:o.insur,item3:o.total,item4:o.percentage})}),m.value=[...r],k(m.value,f.value,"每月新增會員投保數"),i.value=!1}catch(a){console.log(a)}},$=()=>{if(!u.value){_("日期不能為空");return}N()};return(a,t)=>(B(),C("div",P,[d(s(z),{active:i.value,"onUpdate:active":t[0]||(t[0]=e=>i.value=e),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),U,l("form",{class:E(["row mx-0",{"report-header":!s(v),"report-header-dark":s(v)}])},[l("div",j,[d(s(F),{class:"px-0","formatted-value":u.value,"onUpdate:formattedValue":t[1]||(t[1]=e=>u.value=e),type:"month",actions:null,"update-value-on-close":"","is-date-disabled":M,"value-format":"yyyy-MM"},null,8,["formatted-value"])]),l("div",q,[l("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:$}," 搜尋 "),d(V,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:s(p),name:s(h),header:s(g)},null,8,["data","name","header"])])],2),L(d(s(Y),{ref_key:"dataTable",ref:b,data:m.value,columns:f.value,pagination:{pageSize:15},"max-height":500,"scroll-x":300,size:"small",bordered:!1,"single-line":!1,striped:""},null,8,["data","columns"]),[[S,m.value.length]])]))}};export{K as default};
