import{u as U,i as D,r as p,o as s,c as l,b as T,d as e,e as d,l as $,v as P,m as n,n as S,x as j,L as z,q as K,k as q}from"./index-ea6c04ee.js";import{_ as A}from"./OutputExcel-2cf49be6.js";import{N as F}from"./DataTable-bf5168e0.js";import"./xlsx-bd534488.js";import"./get-slot-1efb97e5.js";const Y={class:"container-fluid px-0"},G=d("div",{class:"row mx-0"},[d("h1",{class:"report-h1 fw-bold"},"遺失車報表")],-1),I={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},J=d("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:",-1),O={class:"col-md-auto px-0"},Q=d("option",{selected:"",disabled:""},"請選擇",-1),R={key:0,value:"Taipei+NewTaipei"},W={key:1,value:"Taipei"},X={key:2,value:"NewTaipei"},Z={key:3,value:"Taoyuan"},ee={key:4,value:"Hsinchu"},te={key:5,value:"Hsinchu_country"},ae={key:6,value:"Hsinchu_science"},se={key:7,value:"Mialoi"},oe={key:8,value:"Taichung"},le={key:9,value:"Chiayi"},ne={key:10,value:"Chiayi_country"},ie={key:11,value:"Tainan"},ce={key:12,value:"Kaohsiung"},ue={key:13,value:"Pingtung"},re={class:"row px-0 ps-md-4 mx-0 mx-md-2 align-items-center col-md-auto mt-3 mt-md-0"},de={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},we={__name:"LostcarView",setup(me){const o=U().citys,x=D("ischange"),H=D("$swal");async function N(u){H({icon:"error",title:`${u}`,showConfirmButton:!1})}const M=p(null),y=p("請選擇"),_=p(!1),f=p([]),h=p([]),v=p(),V=u=>{const i=new Date(u),r=new Date,t=new Date(r.getFullYear(),r.getMonth(),r.getDate()-1);return i<new Date(2023,7,30)||i>t};let w=[],g="",k=[];const B=(u,i,r)=>{w=[],g="",k=[],w=[...u],g=r,i.forEach(t=>{k.push(t.title)})},C=u=>{switch(u){case"Taipei":return"台北市";case"NewTaipei":return"新北市";case"Taoyuan":return"桃園市";case"Hsinchu":return"新竹市";case"Hsinchu_country":return"新竹縣";case"Hsinchu_science":return"竹科";case"Mialoi":return"苗栗縣";case"Taichung":return"台中市";case"Chiayi":return"嘉義市";case"Tainan":return"台南市";case"Kaohsiung":return"高雄市";case"Pingtung":return"屏東縣";default:return"未知城市"}},E=async()=>{try{const u="https://report.youbike.com.tw/isauth/gcpfun";let i={dataset_id:"report",table_id:"daily_lost",date:v.value,city:y.value==="Taipei+NewTaipei"?["Taipei","NewTaipei"]:[y.value]};_.value=!0;const t=(await q.get(u,{params:i})).data.data;_.value=!1;const m={one:null,two:null,twoe:null};t.forEach((c,a)=>{a!==0&&t[a].sys!==t[a-1].sys&&(m.one?m.two?m.twoe||(m.twoe=a):m.two=a+1:m.one=a+1)}),f.value=[{key:"item1",align:"center",title:"城市"},{key:"item2",align:"center",title:"系統"},{key:"item3",align:"center",title:"待協尋車輛數"},{key:"item4",align:"center",title:"狀態"},{key:"item5",align:"center",title:"車號"}];let b=[];t.forEach((c,a)=>{a===0?b.push({item1:C(c.city),item2:c.sys,item3:c.total,item4:c.status?c.status==="new_lost"?"新增報案車輛":"今日尋回車輛":null,item5:c.asset_no}):b.push({item1:t[a].city===t[a-1].city?"":C(c.city),item2:t[a].sys===t[a-1].sys&&t[a].city===t[a-1].city?"":c.sys,item3:t[a].total===t[a-1].total?"":c.total,item4:c.status?c.status==="new_lost"?"新增報案車輛":"今日尋回車輛":null,item5:c.asset_no})}),h.value=[...b],B(h.value,f.value,"遺失車報表")}catch(u){console.log(u)}},L=async()=>{if(y.value==="請選擇")return N("請選擇城市");if(!v.value)return N("請選擇日期");await E()};return(u,i)=>(s(),l("div",Y,[T(e(z),{active:_.value,"onUpdate:active":i[0]||(i[0]=r=>_.value=r),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),G,d("form",{class:S(["row mx-0",{"report-header":!e(x),"report-header-dark":e(x)}])},[d("div",I,[J,d("div",O,[$(d("select",{class:"form-select form-select-sm","aria-label":"car","onUpdate:modelValue":i[1]||(i[1]=r=>y.value=r)},[Q,e(o).includes(2)&&e(o).includes(3)?(s(),l("option",R," 雙北 ")):n("",!0),e(o).includes(2)?(s(),l("option",W," 台北市 ")):n("",!0),e(o).includes(3)?(s(),l("option",X," 新北市 ")):n("",!0),e(o).includes(4)?(s(),l("option",Z," 桃園市 ")):n("",!0),e(o).includes(5)?(s(),l("option",ee," 新竹市 ")):n("",!0),e(o).includes(6)?(s(),l("option",te," 新竹縣 ")):n("",!0),e(o).includes(20)?(s(),l("option",ae," 竹科 ")):n("",!0),e(o).includes(7)?(s(),l("option",se," 苗栗縣 ")):n("",!0),e(o).includes(8)?(s(),l("option",oe," 台中市 ")):n("",!0),e(o).includes(12)?(s(),l("option",le," 嘉義市 ")):n("",!0),e(o).includes(13)?(s(),l("option",ne," 嘉義縣 ")):n("",!0),e(o).includes(14)?(s(),l("option",ie," 台南市 ")):n("",!0),e(o).includes(15)?(s(),l("option",ce," 高雄市 ")):n("",!0),e(o).includes(16)?(s(),l("option",ue," 屏東縣 ")):n("",!0)],512),[[P,y.value]])]),d("div",re,[T(e(K),{class:"px-0","formatted-value":v.value,"onUpdate:formattedValue":i[2]||(i[2]=r=>v.value=r),type:"date",actions:null,"input-readonly":!0,"update-value-on-close":!0,placeholder:"請選擇日期","value-format":"yyyy-MM-dd","is-date-disabled":V},null,8,["formatted-value"])])]),d("div",de,[d("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:L}," 搜尋 "),T(A,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:e(w),name:e(g),header:e(k)},null,8,["data","name","header"])])],2),h.value.length>1?(s(),j(e(F),{key:0,ref_key:"dataTable",ref:M,size:"small",columns:f.value,data:h.value,"max-height":600,"scroll-x":1e3,bordered:!1,"single-line":!1,striped:""},null,8,["columns","data"])):n("",!0)]))}};export{we as default};
