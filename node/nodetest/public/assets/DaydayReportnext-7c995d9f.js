import{i as D,u as S,r as i,o as U,c as $,b as d,d as o,e as s,n as L,k as T,m as V,t as j,j as F}from"./index-3459458a.js";import{L as P}from"./index-fcaa1a70.js";import{_ as Y}from"./OutputExcel-14eb8bfa.js";import{N as A}from"./DatePicker-0f56cdd4.js";import{N as R}from"./DataTable-83b67cc2.js";import"./xlsx-bd534488.js";import"./Forward-c5c87e0a.js";import"./Input-c173e393.js";import"./get-slot-1efb97e5.js";const q={class:"container-fluid px-0"},G=s("div",{class:"row mx-0"},[s("h1",{class:"report-h1 fw-bold"},"卡片騎乘天數(每月5號更新資料)")],-1),H=s("div",{class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},[s("label",{class:"col-md-auto col-form-label px-0 px-md-2 fw-bolder"},"城市:")],-1),I={class:"row col-md-2 align-items-center mx-0"},J={class:"row align-items-center col-md-2 col-12 mt-3 mt-md-0 pe-0"},K={class:"mx-0 mx-md-2 col-md-auto pe-0"},O={class:"row mx-0 mx-md-2 align-items-center col-md-auto col-12"},ie={__name:"DaydayReportnext",setup(Q){const g=D("ischange"),l=S().citys,N=D("$swal");async function x(a){N({icon:"error",title:`${a}`,showConfirmButton:!1})}const c=i([]),u=i(!1),r=i([]),_=i(null),m=i(),E=()=>{let a=[];p.forEach(e=>{a.push(e.value)}),c.value=a};let p=[{label:"臺北",value:"1",disabled:!l.includes(2)},{label:"新北",value:"2",disabled:!l.includes(3)},{label:"桃園",value:"3",disabled:!l.includes(4)},{label:"新竹市+竹科",value:"5",disabled:!l.includes(5)},{label:"新竹縣",value:"4",disabled:!l.includes(6)},{label:"苗栗",value:"6",disabled:!l.includes(7)},{label:"臺中",value:"7",disabled:!l.includes(8)},{label:"嘉義",value:"9",disabled:!(l.includes(12)||l.includes(13))},{label:"台南",value:"11",disabled:!l.includes(14)},{label:"高雄",value:"10",disabled:!l.includes(15)},{label:"屏東",value:"12",disabled:!l.includes(16)}];(function(){let e=[];p.forEach(t=>{t.disabled||e.push(t)}),p=[...e]})();const C=a=>{const e=new Date(a),t=e.getFullYear(),n=e.getMonth()+1,h=new Date,y=h.getFullYear(),k=h.getMonth()+1;return t<2022||t>y||t===y&&n>=k||t===y&&n===k&&h.getDate()<2};let v=[],b="",f=[];const z=(a,e,t)=>{v=[],b="",f=[],v=[...a],b=t,e.forEach(n=>{f.push(n.title)})},w=i([{key:"city",align:"center",fixed:"left",title:"城市"},{key:"month",align:"center",title:"月份"},{key:"rideday",align:"center",title:"騎乘天數"},{key:"cardnum",align:"center",title:"卡片數量"}]),B=async()=>{try{u.value=!0,r.value=[];const a="https://report.youbike.com.tw/isauth/gcpfun",e={dataset_id:"data_analysis",table_id:"tan_tan_2",city:c.value,date:m.value},t=await F.get(a,{params:e});u.value=!1,_.value.page(1),t.data.data.forEach(n=>{r.value.push({city:n.city,month:n.date,rideday:n.times,cardnum:n.card_number})}),z(r.value,w.value,"卡片騎乘天數")}catch(a){console.log(a)}},M=()=>{if(c.value.length<=0)return x("請選擇城市");if(!m.value)return x("請選擇日期");B()};return(a,e)=>(U(),$("div",q,[d(o(P),{active:u.value,"onUpdate:active":e[0]||(e[0]=t=>u.value=t),"can-cancel":!1,"is-full-page":!0},null,8,["active"]),G,s("form",{class:L(["row mx-0",{"report-header":!o(g),"report-header-dark":o(g)}])},[H,s("div",I,[d(o(j),{class:"px-0",value:c.value,"onUpdate:value":e[1]||(e[1]=t=>c.value=t),placeholder:"請選擇",multiple:"",options:o(p),"max-tag-count":1,size:"medium"},null,8,["value","options"])]),s("div",{class:"row col-md-auto col-12 ps-md-2 pe-md-3 mx-auto mx-md-0"},[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0",onClick:E}," 城市全選 ")]),s("div",J,[s("div",K,[d(o(A),{class:"px-0","formatted-value":m.value,"onUpdate:formattedValue":e[2]||(e[2]=t=>m.value=t),type:"month",actions:null,"update-value-on-close":"","is-date-disabled":C,"value-format":"yyyy-MM"},null,8,["formatted-value"])])]),s("div",O,[s("button",{type:"button",class:"btn btn-success text-light mt-3 mt-md-0 col-md-auto mx-md-2",onClick:M}," 搜尋 "),d(Y,{class:"btn btn-primary text-light mt-3 mt-md-0 col-md-auto mx-md-2",data:o(v),name:o(b),header:o(f)},null,8,["data","name","header"])])],2),T(d(o(R),{ref_key:"dataTable",ref:_,size:"small",columns:w.value,data:r.value,pagination:{pageSize:17},"max-height":600,"scroll-x":400,bordered:!1,"single-line":!1,striped:""},null,8,["columns","data"]),[[V,r.value.length>0]])]))}};export{ie as default};
