/* empty css             *//* empty css                     *//* empty css                 *//* empty css                  */import{_ as G}from"./_plugin-vue_export-helper-30db3103.js";/* empty css                  *//* empty css                 *//* empty css               *//* empty css                *//* empty css                  */import{d as H,u as K,r as k,cj as J,cu as W,a3 as X,ac as Z,c as b,a,w as s,i as U,E as ee,o as i,e as c,a4 as y,ad as g,ae as h,h as $,g as te,af as ae,ag as le,ah as oe,ai as se,k as ue,j as ne,aj as re,ak as ce,cv as me,am as de,m as ie,l as ve,an as fe}from"./index-0bfd0be3.js";import{u as pe}from"./auth-00379faa.js";import{u as _e}from"./bikestest-a2ceefd7.js";const be=V=>(ae("data-v-704845a4"),V=V(),le(),V),ye={class:"container-fluid"},ke=be(()=>c("p",{class:"fs-1 mb-2 text-center"},"車輛檢驗",-1)),he={class:"row"},ge={class:"col-12 mb-1"},Ve={class:"col-12 mb-1"},De={class:"col-12 mb-1"},we={class:"col-12 mb-1"},qe={class:"col-12 mb-1"},Ae={class:"col-12 mb-1"},Ee={class:"col-12 mb-1"},xe={class:"col-12 mb-1"},Ue={class:"col-12 mb-1"},$e={class:"col-12 mb-1"},Ne={class:"col-12 mb-1"},Se={class:"col-12 mb-1"},Fe={class:"col-12 mb-1"},Be={class:"col-12 mb-1"},Te={class:"col-12 mb-1"},Ce={class:"col-12 mb-1"},Pe={class:"col-12 mb-1"},ze={class:"col-12 mb-1"},Ie={class:"col-12 mb-1"},Me={class:"col-12 mb-1"},Re={class:"col-12 mb-1"},Ye={class:"col-12 mb-1"},je=H({__name:"BiketestStepone",setup(V){const P=K(),N=()=>{window.scrollTo({top:0,behavior:"smooth"})},S=k(),F=r=>{const t=new Date,u=r,m=new Date(u);return t.getFullYear()===m.getFullYear()&&t.getMonth()===m.getMonth()&&t.getDate()===m.getDate()},B=k([""]),T=pe(),z=async()=>{const{account:r}=T.getUserid(),t=`https://simulation.youbike.com.tw/station/station1?id=${r}`,u=`https://simulation.youbike.com.tw/station/station2?id=${r}`;try{const m=await Promise.all([U.get(t),U.get(u)]),n=m[0].data.data,d=m[1].data.data,v=n.filter(f=>F(f.test_date)).map(f=>`${f.station_name}-${f.sys}`),p=d.filter(f=>F(f.test_date)).map(f=>`${f.station_name}-${f.sys}`),_=[...v,...p];B.value=[...new Set(_)]}catch(m){console.log(m)}};function I(r){if(!r)return!1;const t=new Date(r),u=new Date;return t.getDate()===u.getDate()&&t.getMonth()===u.getMonth()&&t.getFullYear()===u.getFullYear()}const{account:M}=T.getUserid();async function R(){const r=`https://simulation.youbike.com.tw/biketest/biketest?id=${M}`;return(await U(r)).data.data.filter(d=>{var v;return I((v=d==null?void 0:d.test_date)==null?void 0:v.split(" ")[0])}).map(d=>d.carnum)}const o=_e(),C=()=>{var t,u,m,n;const r=o.systum;r==="1.0"?(console.log("現在系統是1.0,賦予資料中..."),e.value.catequery=o.testfrom1.catequery,e.value.name=o.testfrom1.station_name,e.value.carnum=o.testfrom1.carnum,e.value.carnum2=o.testfrom1.carnum2,e.value.date=o.testfrom1.date,e.value.testman=o.testfrom1.testman,e.value.checkdata[1].ischeck=(t=o.testfrom1.一級檢修貼紙)==null?void 0:t.ischeck):r==="2.0"?(console.log("現在系統是2.0,賦予資料中..."),e.value.catequery=o.testfrom2.catequery,e.value.name=o.testfrom2.station_name,e.value.carnum=o.testfrom2.carnum,e.value.carnum2=o.testfrom2.carnum2,e.value.date=o.testfrom2.date,e.value.testman=o.testfrom2.testman,e.value.checkdata[1].ischeck=(u=o.testfrom2.一級檢修貼紙)==null?void 0:u.ischeck):r==="2.0E"?(console.log("teststore.testfrom3.catequery",o.testfrom3.catequery),console.log("現在系統是2.0E,賦予資料中..."),e.value.catequery=o.testfrom3.catequery,e.value.name=o.testfrom3.station_name,e.value.carnum=o.testfrom3.carnum,e.value.carnum2=o.testfrom3.carnum2,e.value.canusec=o.testfrom3.canusec,e.value.checkdata[0].ischeck=(m=o.testfrom3.電量)==null?void 0:m.ischeck,e.value.date=o.testfrom3.date,e.value.testman=o.testfrom3.testman,e.value.checkdata[1].ischeck=(n=o.testfrom3.一級檢修貼紙)==null?void 0:n.ischeck,console.log("ruleFormAll.value.catequery",e.value.catequery)):console.log("現在沒有系統")};(async()=>(await z(),S.value=[...await R()],N(),C()))();const D=k(),e=k({name:"",catequery:"",carnum:"",carnum2:"",date:"",testman:"",canusec:null,checkdata:[{title:"電量",ischeck:[],value:["無顯示/未持續顯示"]},{title:"一級檢修貼紙",ischeck:[],value:["無貼紙／無法辨識／資訊不完整","未撕除舊貼紙"]},{title:"一級檢修貼紙",ischeck:[],value:["無貼紙","無法辨識／資訊不完整","未撕除舊貼紙"]}]}),A=k([]);J(()=>e.value.name,()=>{e.value.catequery="";const r=e.value.name.split("-").length;e.value.name&&(e.value.name.split("-")[r-1]==="2.0+2.0E"||e.value.name.split("-")[r-1]==="2.0+2.0e"?A.value=["2.0","2.0E"]:A.value=["1.0"])});const Y=(r,t,u)=>{e.value.catequery==="1.0"?/^[HFK]\d{5}$/.test(t)?u():u(new Error("請輸入區碼＋５碼車號")):/^\d{7}$/.test(t)?e.value.catequery==="2.0"&&(t.charAt(2)==="6"||t.charAt(2)==="9")?u(new Error("2.0第三碼不能為6或9")):e.value.catequery==="2.0E"&&t.charAt(2)!=="6"&&t.charAt(2)!=="9"?u(new Error("2.0E第三碼必須為6或9")):u():u(new Error("請輸入7碼車號"))};W();const j=()=>{},L=k({name:[{required:!0,message:"場站名稱不能為空",trigger:"blur"}],catequery:[{required:!0,message:"車種別不能為空",trigger:"blur"}],carnum:[{required:!0,message:"車號不能為空",trigger:"blur"},{validator:Y,trigger:"blur"},{validator:(r,t,u)=>{S.value.includes(t)?u(new Error("此車號為今日已檢驗車號")):u()},trigger:"blur"}],carnum2:[{required:!0,message:"車柱柱號不能為空",trigger:"blur"},{validator:(r,t,u)=>{if(e.value.catequery==="1.0")if(!/^\d{2}[1-2]$/.test(t))u(new Error("請輸入３碼柱號，末位為１或２"));else return u();else/^\d{2}$/.test(t)?u():u(new Error("請輸入末２碼柱號"))},trigger:"blur"}],canusec:[{required:!0,message:"可用電量不能為空",trigger:"blur"},{validator:(r,t,u)=>{t<0||t>100?u(new Error("電量必須為0~100")):u()},trigger:"blur"}]});window.addEventListener("beforeunload",function(r){const t="您確定要離開此頁面嗎？您的未保存更改將丟失。";r.returnValue=t,confirm(t)||r.preventDefault()});const E=async r=>{if(r)try{await r.validate(),e.value.catequery==="1.0"?(o.systum=e.value.catequery,o.testfrom1.station_name=e.value.name,o.testfrom1.catequery=e.value.catequery,o.testfrom1.carnum=e.value.carnum,o.testfrom1.carnum2=e.value.carnum2,o.testfrom1.date=e.value.date,o.testfrom1.testman=e.value.testman,o.testfrom1.一級檢修貼紙=e.value.checkdata[1],console.log("送出1.0")):e.value.catequery==="2.0"?(o.systum=e.value.catequery,o.testfrom2.station_name=e.value.name,o.testfrom2.catequery=e.value.catequery,o.testfrom2.carnum=e.value.carnum,o.testfrom2.carnum2=e.value.carnum2,o.testfrom2.date=e.value.date,o.testfrom2.testman=e.value.testman,o.testfrom2.一級檢修貼紙=e.value.checkdata[2],console.log("送出2.0")):(o.systum=e.value.catequery,o.testfrom3.station_name=e.value.name,o.testfrom3.catequery=e.value.catequery,o.testfrom3.carnum=e.value.carnum,o.testfrom3.carnum2=e.value.carnum2,o.testfrom3.canusec=e.value.canusec,o.testfrom3.電量=e.value.checkdata[0],o.testfrom3.date=e.value.date,o.testfrom3.testman=e.value.testman,o.testfrom3.一級檢修貼紙=e.value.checkdata[2],console.log(o.testfrom3),console.log("送出2.0E")),o.step.step2=!0,P.push("/server/biketest/BiketestSteptwo"),console.log("表單驗證成功")}catch(t){console.log("驗證失敗",t)}};return X(()=>{N(),C()}),(r,t)=>{const u=oe,m=se,n=ue,d=ne,v=Z("QuestionFilled"),p=re,_=ce,f=me,w=fe,q=de,x=ie,O=ve,Q=ee;return i(),b("div",ye,[ke,a(Q,{"label-width":"120px",size:"large","label-position":"top",model:e.value,ref_key:"formRefAll",ref:D,rules:L.value},{default:s(()=>[c("div",he,[c("div",ge,[a(n,{label:"場站名稱",prop:"name"},{default:s(()=>[a(m,{placeholder:"請選擇場站",class:"col-12",modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.name=l)},{default:s(()=>[(i(!0),b(y,null,g(B.value,l=>(i(),h(u,{label:l,value:l,key:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),c("div",Ve,[a(n,{label:"車種別",prop:"catequery"},{default:s(()=>[a(m,{disabled:e.value.name==="",class:"col-12",modelValue:e.value.catequery,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.catequery=l),onChange:j},{default:s(()=>[e.value.name!==""&&A.value[0]==="1.0"?(i(),h(u,{key:0,label:"1.0",value:"1.0"})):(i(),b(y,{key:1},[a(u,{label:"2.0",value:"2.0"}),a(u,{label:"2.0E",value:"2.0E"})],64))]),_:1},8,["disabled","modelValue"])]),_:1})]),e.value.catequery==="1.0"?(i(),b(y,{key:0},[c("div",De,[a(n,{label:"車號",prop:"carnum"},{default:s(()=>[a(d,{placeholder:"請輸入車號",modelValue:e.value.carnum,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.carnum=l)},null,8,["modelValue"])]),_:1})]),c("div",we,[a(_,{class:"box-item",effect:"dark",content:"1-1 →011，22-1 →221",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:"車柱柱號",prop:"carnum2"},{default:s(()=>[a(d,{placeholder:"請輸入車柱柱號",modelValue:e.value.carnum2,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.carnum2=l),type:"number",inputmode:"numeric"},null,8,["modelValue"])]),_:1})]),c("div",qe,[a(n,{label:"一級檢修日期"},{default:s(()=>[a(f,{modelValue:e.value.date,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.date=l),style:{width:"100%"},type:"date",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1})]),c("div",Ae,[a(n,{label:"一級檢修人員"},{default:s(()=>[a(d,{placeholder:"請輸入一級檢修人員",modelValue:e.value.testman,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.testman=l)},null,8,["modelValue"])]),_:1})]),c("div",Ee,[a(_,{class:"box-item",effect:"dark",content:"勾選應拍照上傳",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:e.value.checkdata[1].title},{default:s(()=>[a(q,{modelValue:e.value.checkdata[1].ischeck,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.checkdata[1].ischeck=l)},{default:s(()=>[(i(!0),b(y,null,g(e.value.checkdata[1].value,l=>(i(),h(w,{key:l,label:l,name:l},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),c("div",xe,[a(n,null,{default:s(()=>[a(x,{type:"primary",plain:"",class:"col-12",onClick:t[7]||(t[7]=l=>E(D.value))},{default:s(()=>[$("下一步")]),_:1})]),_:1})])],64)):e.value.catequery==="2.0"?(i(),b(y,{key:1},[c("div",Ue,[a(n,{label:"車號",prop:"carnum"},{default:s(()=>[a(d,{modelValue:e.value.carnum,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.carnum=l),placeholder:"請輸入車號"},null,8,["modelValue"])]),_:1})]),c("div",$e,[a(_,{class:"box-item",effect:"dark",content:"01 →01，21 →21",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:"車柱柱號",prop:"carnum2"},{default:s(()=>[a(d,{placeholder:"請輸入車柱柱號",modelValue:e.value.carnum2,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.carnum2=l),type:"number",inputmode:"numeric"},null,8,["modelValue"])]),_:1})]),c("div",Ne,[a(n,{label:"一級檢修日期"},{default:s(()=>[a(f,{modelValue:e.value.date,"onUpdate:modelValue":t[10]||(t[10]=l=>e.value.date=l),style:{width:"100%"},type:"date",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1})]),c("div",Se,[a(n,{label:"一級檢修人員"},{default:s(()=>[a(d,{placeholder:"請輸入一級檢修人員",modelValue:e.value.testman,"onUpdate:modelValue":t[11]||(t[11]=l=>e.value.testman=l)},null,8,["modelValue"])]),_:1})]),c("div",Fe,[a(_,{class:"box-item",effect:"dark",content:"勾選應拍照上傳",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:e.value.checkdata[2].title},{default:s(()=>[a(q,{modelValue:e.value.checkdata[2].ischeck,"onUpdate:modelValue":t[12]||(t[12]=l=>e.value.checkdata[2].ischeck=l)},{default:s(()=>[(i(!0),b(y,null,g(e.value.checkdata[2].value,l=>(i(),h(w,{key:l,label:l,name:l},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),c("div",Be,[a(n,null,{default:s(()=>[a(x,{type:"primary",plain:"",class:"col-12",onClick:t[13]||(t[13]=l=>E(D.value))},{default:s(()=>[$("下一步")]),_:1})]),_:1})])],64)):e.value.catequery==="2.0E"?(i(),b(y,{key:2},[c("div",Te,[a(n,{label:"車號",prop:"carnum"},{default:s(()=>[a(d,{modelValue:e.value.carnum,"onUpdate:modelValue":t[14]||(t[14]=l=>e.value.carnum=l),placeholder:"請輸入車號"},null,8,["modelValue"])]),_:1})]),c("div",Ce,[a(_,{class:"box-item",effect:"dark",content:"01 →01，21 →21",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:"車柱柱號",prop:"carnum2"},{default:s(()=>[a(d,{placeholder:"請輸入車柱柱號",modelValue:e.value.carnum2,"onUpdate:modelValue":t[15]||(t[15]=l=>e.value.carnum2=l),type:"number",inputmode:"numeric"},null,8,["modelValue"])]),_:1})]),c("div",Pe,[a(_,{class:"box-item",effect:"dark",content:"無顯示電量、異常顯示填0",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(O,{title:"輸入電量低於15請拍照",type:"warning ",closable:!1,class:"my-1"}),a(n,{label:"可用電量",prop:"canusec"},{default:s(()=>[a(d,{min:0,max:100,placeholder:"請輸入可用電量",modelValue:e.value.canusec,"onUpdate:modelValue":t[16]||(t[16]=l=>e.value.canusec=l),modelModifiers:{number:!0},type:"number",inputmode:"numeric"},null,8,["modelValue"])]),_:1})]),c("div",ze,[a(_,{class:"box-item",effect:"dark",content:"借出即持續顯示電量至臨停或歸還",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:e.value.checkdata[0].title},{default:s(()=>[a(q,{modelValue:e.value.checkdata[0].ischeck,"onUpdate:modelValue":t[17]||(t[17]=l=>e.value.checkdata[0].ischeck=l)},{default:s(()=>[(i(!0),b(y,null,g(e.value.checkdata[0].value,l=>(i(),h(w,{key:l,label:l,name:l},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),c("div",Ie,[a(n,{label:"一級檢修日期"},{default:s(()=>[a(f,{modelValue:e.value.date,"onUpdate:modelValue":t[18]||(t[18]=l=>e.value.date=l),style:{width:"100%"},type:"date",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1})]),c("div",Me,[a(n,{label:"一級檢修人員"},{default:s(()=>[a(d,{placeholder:"請輸入一級檢修人員",modelValue:e.value.testman,"onUpdate:modelValue":t[19]||(t[19]=l=>e.value.testman=l)},null,8,["modelValue"])]),_:1})]),c("div",Re,[a(_,{class:"box-item",effect:"dark",content:"勾選應拍照上傳",placement:"top-start"},{default:s(()=>[a(p,{size:"20",color:"#ADADAD"},{default:s(()=>[a(v)]),_:1})]),_:1}),a(n,{label:e.value.checkdata[2].title},{default:s(()=>[a(q,{modelValue:e.value.checkdata[2].ischeck,"onUpdate:modelValue":t[20]||(t[20]=l=>e.value.checkdata[2].ischeck=l)},{default:s(()=>[(i(!0),b(y,null,g(e.value.checkdata[2].value,l=>(i(),h(w,{key:l,label:l,name:l},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),c("div",Ye,[a(n,null,{default:s(()=>[a(x,{type:"primary",plain:"",class:"col-12",onClick:t[21]||(t[21]=l=>E(D.value))},{default:s(()=>[$("下一步")]),_:1})]),_:1})])],64)):te("",!0)])]),_:1},8,["model","rules"])])}}});const ut=G(je,[["__scopeId","data-v-704845a4"]]);export{ut as default};
