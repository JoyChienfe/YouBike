import{i as U,r as _,z as B,u as L,o as N,c as R,e as t,b as a,w as l,d as c,k as $,bR as h,N as m,j as p}from"./index-a5eda168.js";import{A as w}from"./AlertCircle-768a2e3f.js";const j={class:"container-fluid"},F=t("div",{class:"row mx-0 mb-3"},[t("h1",{class:"report-h1 fw-bold"},"上傳檔案發送")],-1),T={class:"row fw-bold d-flex"},D={class:"col-auto mb-1 d-flex"},E={class:"my-auto"},z=t("span",{style:{"font-weight":"700"}},"請事先下載範例檔案，編輯好資料後直接上傳",-1),H=t("span",{class:"ms-1 text-info"},"上傳方式",-1),I={class:"col-auto mb-1 d-flex"},M={class:"my-auto"},P=t("span",{style:{"font-weight":"700"}},[p("1. 手機號碼&簡訊內容"),t("br"),p("2. 換行為資料與資料間的分隔符號")],-1),S=t("span",{class:"ms-1 text-info"},"上傳格式",-1),V={class:"row mb-3"},O={class:"col-auto mb-1"},J={__name:"sendFile",setup(W){const u=U("$swal");async function i(e){u({icon:"error",title:`${e}`,showConfirmButton:!1})}async function b(e){u({icon:"success",title:`${e}`,showConfirmButton:!1})}function v(){const e=`0912345678&好久不見，你好嗎?
0922104075&I love U
0960778857&忘了您的名字，真不好意思`,s=new Blob([e],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download="範例檔(請使用記事本開啟)",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}const r=_(""),f=_(null),x=async e=>{const s=e.target.files[0];if(!s||!s.name.toLowerCase().endsWith(".txt")){await i("請上傳txt文件"),d();return}const n=new FileReader;n.onload=function(o){const A=o.target.result;r.value=A},n.readAsText(s)};B(r,async e=>{await y(e)});function d(){f.value.value=null,r.value=null}async function y(e){if(e===null)return;const s=/^[0-9]{10}&.+$/,n=e.split(`
`);for(let o=0;o<n.length;o++)if(!s.test(n[o])){await i(`第${o+1}行資料格式錯誤`),d();return}}const g=L(),{userId:C}=g;async function k(){if(!r.value){await i("空資料不能發送");return}const e=r.value.split(`
`).map(s=>{const n=s.split("&");return{phone:n[0],yb_id:C,message:n[1]}});try{const s="https://report.youbike.com.tw/sms/sendMany";await $.post(s,{data:e,check:e.length>=5e3}),await b("發送成功"),d()}catch(s){console.log(s)}}return(e,s)=>(N(),R("div",j,[F,t("div",T,[t("div",D,[t("div",E,[a(c(m),{trigger:"hover"},{trigger:l(()=>[a(c(h),{size:"20",color:"#0DCAF0"},{default:l(()=>[a(c(w))]),_:1})]),default:l(()=>[z]),_:1}),H])]),t("div",I,[t("div",M,[a(c(m),{trigger:"hover"},{trigger:l(()=>[a(c(h),{size:"20",color:"#0DCAF0"},{default:l(()=>[a(c(w))]),_:1})]),default:l(()=>[P]),_:1}),S])]),t("div",{class:"col-auto ms-auto"},[t("button",{class:"btn btn-primary fw-bold",onClick:v}," 下載範例檔案 ")])]),t("div",V,[t("div",O,[t("input",{type:"file",class:"form-control",onChange:x,ref_key:"file",ref:f},null,544)])]),t("div",{class:"row d-flex justify-content-center"},[t("button",{class:"btn btn-danger btn-lg",style:{width:"200px"},onClick:k}," 發送 ")])]))}};export{J as default};
